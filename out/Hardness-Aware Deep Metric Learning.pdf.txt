Hardness-Aware Deep Metric Learning

Wenzhao Zheng1

2

,

,

3, Zhaodong Chen1, Jiwen Lu1

2

,

,

3

,

∗, Jie Zhou1

2

,

,

3

1Department of Automation, Tsinghua University, China

2State Key Lab of Intelligent Technologies and Systems, China

3Beijing National Research Center for Information Science and Technology, China

zhengwz18@mails.tsinghua.edu.cn; chenzd15@mails.tsinghua.edu.cn; lujiwen@tsinghua.edu.cn;

jzhou@tsinghua.edu.cn

Abstract

This paper presents a hardness-aware deep metric learn-
ing (HDML) framework. Most previous deep metric learn-
ing methods employ the hard negative mining strategy to
alleviate the lack of informative samples for training. How-
ever, this mining strategy only utilizes a subset of training
data, which may not be enough to characterize the global
geometry of the embedding space comprehensively. To ad-
dress this problem, we perform linear interpolation on em-
beddings to adaptively manipulate their hard levels and
generate corresponding label-preserving synthetics for re-
cycled training, so that information buried in all samples
can be fully exploited and the metric is always challenged
with proper difﬁculty. Our method achieves very com-
petitive performance on the widely used CUB-200-2011,
Cars196, and Stanford Online Products datasets. 1

1. Introduction

Deep metric learning methods aim to learn effective met-
rics to measure the similarities between data points accu-
rately and robustly. They take advantage of deep neural
networks [17, 27, 31, 11] to construct a mapping from the
data space to the embedding space so that the Euclidean
distance in the embedding space can reﬂect the actual se-
mantic distance between data points, i.e., a relatively large
distance between inter-class samples and a relatively small
distance between intra-class samples. Recently a variety of
deep metric learning methods have been proposed and have
demonstrated strong effectiveness in various tasks, such as
image retrieval [30, 23, 19, 5], person re-identiﬁcation [26,
37, 48, 2], and geo-localization [35, 14, 34].

∗Corresponding author
1Code: https://github.com/wzzheng/HDML

z<

z+

ˆz−

ez−

y+

z−

embedding
feature

y

ˆy−

y−

ey−

Figure 1. Illustration of our proposed hardness-aware feature syn-
thesis. A curve in the feature space represents a manifold near
which samples belong to one speciﬁc class concentrate. Points
with the same color in the feature space and embedding space
represent the same sample and points of the same shape denote
that they belong to the same class. The proposed hardness-aware
−. Then a label-
augmentation ﬁrst modiﬁes a sample y
− which is the
− on the manifold. The hardness of synthetic
− can be controlled adaptively and does not change the
original label so that the synthetic hardness-aware tuple can be fa-
vorably exploited for effective training. (Best viewed in color.)

and-hardness-preserving generator projects it to ey
negative ey

closest point to ˆy

− to ˆy

The overall training of a deep metric learning model can
be considered as using a loss weighted by the selected sam-
ples, which makes the sampling strategy a critical compo-

72

<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
A
g
1
e
E
Z
5
5
M
x
o
s
z
1
h
R
8
A
n
J
d
d
I
Q
j
k
k
=
"
>
A
A
A
C
A
X
i
c
b
Z
D
L
S
s
N
A
F
I
Y
n
X
m
u
9
R
d
0
I
b
o
J
F
c
G
N
J
R
N
R
l
w
Y
3
L
C
v
Y
C
T
S
y
T
y
U
k
7
d
D
I
J
M
x
M
l
h
L
j
x
V
d
y
4
U
M
S
t
b
+
H
O
t
3
H
S
d
q
G
t
P
w
x
8
/
O
c
c
5
p
z
f
T
x
i
V
y
r
a
/
j
Y
X
F
p
e
W
V
1
c
p
a
d
X
1
j
c
2
v
b
3
N
l
t
y
z
g
V
B
F
o
k
Z
r
H
o
+
l
g
C
o
x
x
a
i
i
o
G
3
U
Q
A
j
n
w
G
H
X
9
0
V
d
Y
7
9
y
A
k
j
f
m
t
y
h
L
w
I
j
z
g
N
K
Q
E
K
2
3
1
z
X
3
3
g
Q
a
g
K
A
s
g
d
y
O
s
h
n
6
Y
Z
0
V
x
d
9
I
3
a
3
b
d
H
s
u
a
B
2
c
K
N
T
R
V
s
2
9
+
u
U
F
M
0
g
i
4
I
g
x
L
2
X
P
s
R
H
k
5
F
o
o
S
B
k
X
V
T
S
U
k
m
I
z
w
A
H
o
a
O
Y
5
A
e
v
n
4
g
s
I
6
0
k
5
g
h
b
H
Q
j
y
t
r
7
P
6
e
y
H
E
k
Z
R
b
5
u
r
N
c
U
s
7
W
S
v
O
/
W
i
9
V
4
a
W
X
U
5
6
k
C
j
i
Z
f
B
S
m
z
F
K
x
V
c
Z
h
B
V
Q
A
U
S
z
T
g
I
m
g
e
l
e
L
D
L
H
A
R
O
n
Q
q
j
o
E
Z
/
b
k
e
W
i
f
1
h
3
N
N
2
e
1
x
v
k
0
j
g
o
6
Q
I
f
o
G
D
n
o
A
j
X
Q
N
W
q
i
F
i
L
o
E
T
2
j
V
/
R
m
P
B
k
v
x
r
v
x
M
W
l
d
M
K
Y
z
e
+
i
P
j
M
8
f
W
D
e
X
a
A
=
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
A
g
1
e
E
Z
5
5
M
x
o
s
z
1
h
R
8
A
n
J
d
d
I
Q
j
k
k
=
"
>
A
A
A
C
A
X
i
c
b
Z
D
L
S
s
N
A
F
I
Y
n
X
m
u
9
R
d
0
I
b
o
J
F
c
G
N
J
R
N
R
l
w
Y
3
L
C
v
Y
C
T
S
y
T
y
U
k
7
d
D
I
J
M
x
M
l
h
L
j
x
V
d
y
4
U
M
S
t
b
+
H
O
t
3
H
S
d
q
G
t
P
w
x
8
/
O
c
c
5
p
z
f
T
x
i
V
y
r
a
/
j
Y
X
F
p
e
W
V
1
c
p
a
d
X
1
j
c
2
v
b
3
N
l
t
y
z
g
V
B
F
o
k
Z
r
H
o
+
l
g
C
o
x
x
a
i
i
o
G
3
U
Q
A
j
n
w
G
H
X
9
0
V
d
Y
7
9
y
A
k
j
f
m
t
y
h
L
w
I
j
z
g
N
K
Q
E
K
2
3
1
z
X
3
3
g
Q
a
g
K
A
s
g
d
y
O
s
h
n
6
Y
Z
0
V
x
d
9
I
3
a
3
b
d
H
s
u
a
B
2
c
K
N
T
R
V
s
2
9
+
u
U
F
M
0
g
i
4
I
g
x
L
2
X
P
s
R
H
k
5
F
o
o
S
B
k
X
V
T
S
U
k
m
I
z
w
A
H
o
a
O
Y
5
A
e
v
n
4
g
s
I
6
0
k
5
g
h
b
H
Q
j
y
t
r
7
P
6
e
y
H
E
k
Z
R
b
5
u
r
N
c
U
s
7
W
S
v
O
/
W
i
9
V
4
a
W
X
U
5
6
k
C
j
i
Z
f
B
S
m
z
F
K
x
V
c
Z
h
B
V
Q
A
U
S
z
T
g
I
m
g
e
l
e
L
D
L
H
A
R
O
n
Q
q
j
o
E
Z
/
b
k
e
W
i
f
1
h
3
N
N
2
e
1
x
v
k
0
j
g
o
6
Q
I
f
o
G
D
n
o
A
j
X
Q
N
W
q
i
F
i
L
o
E
T
2
j
V
/
R
m
P
B
k
v
x
r
v
x
M
W
l
d
M
K
Y
z
e
+
i
P
j
M
8
f
W
D
e
X
a
A
=
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
A
g
1
e
E
Z
5
5
M
x
o
s
z
1
h
R
8
A
n
J
d
d
I
Q
j
k
k
=
"
>
A
A
A
C
A
X
i
c
b
Z
D
L
S
s
N
A
F
I
Y
n
X
m
u
9
R
d
0
I
b
o
J
F
c
G
N
J
R
N
R
l
w
Y
3
L
C
v
Y
C
T
S
y
T
y
U
k
7
d
D
I
J
M
x
M
l
h
L
j
x
V
d
y
4
U
M
S
t
b
+
H
O
t
3
H
S
d
q
G
t
P
w
x
8
/
O
c
c
5
p
z
f
T
x
i
V
y
r
a
/
j
Y
X
F
p
e
W
V
1
c
p
a
d
X
1
j
c
2
v
b
3
N
l
t
y
z
g
V
B
F
o
k
Z
r
H
o
+
l
g
C
o
x
x
a
i
i
o
G
3
U
Q
A
j
n
w
G
H
X
9
0
V
d
Y
7
9
y
A
k
j
f
m
t
y
h
L
w
I
j
z
g
N
K
Q
E
K
2
3
1
z
X
3
3
g
Q
a
g
K
A
s
g
d
y
O
s
h
n
6
Y
Z
0
V
x
d
9
I
3
a
3
b
d
H
s
u
a
B
2
c
K
N
T
R
V
s
2
9
+
u
U
F
M
0
g
i
4
I
g
x
L
2
X
P
s
R
H
k
5
F
o
o
S
B
k
X
V
T
S
U
k
m
I
z
w
A
H
o
a
O
Y
5
A
e
v
n
4
g
s
I
6
0
k
5
g
h
b
H
Q
j
y
t
r
7
P
6
e
y
H
E
k
Z
R
b
5
u
r
N
c
U
s
7
W
S
v
O
/
W
i
9
V
4
a
W
X
U
5
6
k
C
j
i
Z
f
B
S
m
z
F
K
x
V
c
Z
h
B
V
Q
A
U
S
z
T
g
I
m
g
e
l
e
L
D
L
H
A
R
O
n
Q
q
j
o
E
Z
/
b
k
e
W
i
f
1
h
3
N
N
2
e
1
x
v
k
0
j
g
o
6
Q
I
f
o
G
D
n
o
A
j
X
Q
N
W
q
i
F
i
L
o
E
T
2
j
V
/
R
m
P
B
k
v
x
r
v
x
M
W
l
d
M
K
Y
z
e
+
i
P
j
M
8
f
W
D
e
X
a
A
=
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
A
g
1
e
E
Z
5
5
M
x
o
s
z
1
h
R
8
A
n
J
d
d
I
Q
j
k
k
=
"
>
A
A
A
C
A
X
i
c
b
Z
D
L
S
s
N
A
F
I
Y
n
X
m
u
9
R
d
0
I
b
o
J
F
c
G
N
J
R
N
R
l
w
Y
3
L
C
v
Y
C
T
S
y
T
y
U
k
7
d
D
I
J
M
x
M
l
h
L
j
x
V
d
y
4
U
M
S
t
b
+
H
O
t
3
H
S
d
q
G
t
P
w
x
8
/
O
c
c
5
p
z
f
T
x
i
V
y
r
a
/
j
Y
X
F
p
e
W
V
1
c
p
a
d
X
1
j
c
2
v
b
3
N
l
t
y
z
g
V
B
F
o
k
Z
r
H
o
+
l
g
C
o
x
x
a
i
i
o
G
3
U
Q
A
j
n
w
G
H
X
9
0
V
d
Y
7
9
y
A
k
j
f
m
t
y
h
L
w
I
j
z
g
N
K
Q
E
K
2
3
1
z
X
3
3
g
Q
a
g
K
A
s
g
d
y
O
s
h
n
6
Y
Z
0
V
x
d
9
I
3
a
3
b
d
H
s
u
a
B
2
c
K
N
T
R
V
s
2
9
+
u
U
F
M
0
g
i
4
I
g
x
L
2
X
P
s
R
H
k
5
F
o
o
S
B
k
X
V
T
S
U
k
m
I
z
w
A
H
o
a
O
Y
5
A
e
v
n
4
g
s
I
6
0
k
5
g
h
b
H
Q
j
y
t
r
7
P
6
e
y
H
E
k
Z
R
b
5
u
r
N
c
U
s
7
W
S
v
O
/
W
i
9
V
4
a
W
X
U
5
6
k
C
j
i
Z
f
B
S
m
z
F
K
x
V
c
Z
h
B
V
Q
A
U
S
z
T
g
I
m
g
e
l
e
L
D
L
H
A
R
O
n
Q
q
j
o
E
Z
/
b
k
e
W
i
f
1
h
3
N
N
2
e
1
x
v
k
0
j
g
o
6
Q
I
f
o
G
D
n
o
A
j
X
Q
N
W
q
i
F
i
L
o
E
T
2
j
V
/
R
m
P
B
k
v
x
r
v
x
M
W
l
d
M
K
Y
z
e
+
i
P
j
M
8
f
W
D
e
X
a
A
=
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
Y
P
l
X
C
P
J
n
H
b
7
b
h
p
p
g
w
+
B
d
k
V
i
M
c
l
U
=
"
>
A
A
A
B
8
3
i
c
b
V
D
L
S
g
M
x
F
L
3
x
W
e
u
r
6
t
J
N
s
A
h
u
L
D
M
i
6
r
L
g
x
m
U
F
+
4
D
O
W
D
J
p
p
g
3
N
Z
I
Y
k
I
w
x
D
f
8
O
N
C
0
X
c
+
j
P
u
/
B
s
z
7
S
y
0
9
U
D
g
c
M
6
9
3
J
M
T
J
I
J
r
4
z
j
f
a
G
V
1
b
X
1
j
s
7
J
V
3
d
7
Z
3
d
u
v
H
R
x
2
d
J
w
q
y
t
o
0
F
r
H
q
B
U
Q
z
w
S
V
r
G
2
4
E
6
y
W
K
k
S
g
Q
r
B
t
M
b
g
u
/
+
8
S
U
5
r
F
8
M
F
n
C
/
I
i
M
J
A
8
5
J
c
Z
K
n
h
c
R
M
w
7
C
P
J
s
+
n
g
9
q
d
a
f
h
z
I
C
X
i
V
u
S
O
p
R
o
D
W
p
f
3
j
C
m
a
c
S
k
o
Y
J
o
3
X
e
d
x
P
g
5
U
Y
Z
T
w
a
Z
V
L
9
U
s
I
X
R
C
R
q
x
v
q
S
Q
R
0
3
4
+
y
z
z
F
p
1
Y
Z
4
j
B
W
9
k
m
D
Z
+
r
v
j
Z
x
E
W
m
d
R
Y
C
e
L
j
H
r
R
K
8
T
/
v
H
5
q
w
h
s
/
5
z
J
J
D
Z
N
0
f
i
h
M
B
T
Y
x
L
g
r
A
Q
6
4
Y
N
S
K
z
h
F
D
F
b
V
Z
M
x
0
Q
R
a
m
x
N
V
V
u
C
u
/
j
l
Z
d
K
5
a
L
i
W
3
1
/
W
m
1
d
l
H
R
U
4
h
h
M
4
A
x
e
u
o
Q
l
3
0
I
I
2
U
E
j
g
G
V
7
h
D
a
X
o
B
b
2
j
j
/
n
o
C
i
p
3
j
u
A
P
0
O
c
P
I
L
i
R
s
A
=
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
Y
P
l
X
C
P
J
n
H
b
7
b
h
p
p
g
w
+
B
d
k
V
i
M
c
l
U
=
"
>
A
A
A
B
8
3
i
c
b
V
D
L
S
g
M
x
F
L
3
x
W
e
u
r
6
t
J
N
s
A
h
u
L
D
M
i
6
r
L
g
x
m
U
F
+
4
D
O
W
D
J
p
p
g
3
N
Z
I
Y
k
I
w
x
D
f
8
O
N
C
0
X
c
+
j
P
u
/
B
s
z
7
S
y
0
9
U
D
g
c
M
6
9
3
J
M
T
J
I
J
r
4
z
j
f
a
G
V
1
b
X
1
j
s
7
J
V
3
d
7
Z
3
d
u
v
H
R
x
2
d
J
w
q
y
t
o
0
F
r
H
q
B
U
Q
z
w
S
V
r
G
2
4
E
6
y
W
K
k
S
g
Q
r
B
t
M
b
g
u
/
+
8
S
U
5
r
F
8
M
F
n
C
/
I
i
M
J
A
8
5
J
c
Z
K
n
h
c
R
M
w
7
C
P
J
s
+
n
g
9
q
d
a
f
h
z
I
C
X
i
V
u
S
O
p
R
o
D
W
p
f
3
j
C
m
a
c
S
k
o
Y
J
o
3
X
e
d
x
P
g
5
U
Y
Z
T
w
a
Z
V
L
9
U
s
I
X
R
C
R
q
x
v
q
S
Q
R
0
3
4
+
y
z
z
F
p
1
Y
Z
4
j
B
W
9
k
m
D
Z
+
r
v
j
Z
x
E
W
m
d
R
Y
C
e
L
j
H
r
R
K
8
T
/
v
H
5
q
w
h
s
/
5
z
J
J
D
Z
N
0
f
i
h
M
B
T
Y
x
L
g
r
A
Q
6
4
Y
N
S
K
z
h
F
D
F
b
V
Z
M
x
0
Q
R
a
m
x
N
V
V
u
C
u
/
j
l
Z
d
K
5
a
L
i
W
3
1
/
W
m
1
d
l
H
R
U
4
h
h
M
4
A
x
e
u
o
Q
l
3
0
I
I
2
U
E
j
g
G
V
7
h
D
a
X
o
B
b
2
j
j
/
n
o
C
i
p
3
j
u
A
P
0
O
c
P
I
L
i
R
s
A
=
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
Y
P
l
X
C
P
J
n
H
b
7
b
h
p
p
g
w
+
B
d
k
V
i
M
c
l
U
=
"
>
A
A
A
B
8
3
i
c
b
V
D
L
S
g
M
x
F
L
3
x
W
e
u
r
6
t
J
N
s
A
h
u
L
D
M
i
6
r
L
g
x
m
U
F
+
4
D
O
W
D
J
p
p
g
3
N
Z
I
Y
k
I
w
x
D
f
8
O
N
C
0
X
c
+
j
P
u
/
B
s
z
7
S
y
0
9
U
D
g
c
M
6
9
3
J
M
T
J
I
J
r
4
z
j
f
a
G
V
1
b
X
1
j
s
7
J
V
3
d
7
Z
3
d
u
v
H
R
x
2
d
J
w
q
y
t
o
0
F
r
H
q
B
U
Q
z
w
S
V
r
G
2
4
E
6
y
W
K
k
S
g
Q
r
B
t
M
b
g
u
/
+
8
S
U
5
r
F
8
M
F
n
C
/
I
i
M
J
A
8
5
J
c
Z
K
n
h
c
R
M
w
7
C
P
J
s
+
n
g
9
q
d
a
f
h
z
I
C
X
i
V
u
S
O
p
R
o
D
W
p
f
3
j
C
m
a
c
S
k
o
Y
J
o
3
X
e
d
x
P
g
5
U
Y
Z
T
w
a
Z
V
L
9
U
s
I
X
R
C
R
q
x
v
q
S
Q
R
0
3
4
+
y
z
z
F
p
1
Y
Z
4
j
B
W
9
k
m
D
Z
+
r
v
j
Z
x
E
W
m
d
R
Y
C
e
L
j
H
r
R
K
8
T
/
v
H
5
q
w
h
s
/
5
z
J
J
D
Z
N
0
f
i
h
M
B
T
Y
x
L
g
r
A
Q
6
4
Y
N
S
K
z
h
F
D
F
b
V
Z
M
x
0
Q
R
a
m
x
N
V
V
u
C
u
/
j
l
Z
d
K
5
a
L
i
W
3
1
/
W
m
1
d
l
H
R
U
4
h
h
M
4
A
x
e
u
o
Q
l
3
0
I
I
2
U
E
j
g
G
V
7
h
D
a
X
o
B
b
2
j
j
/
n
o
C
i
p
3
j
u
A
P
0
O
c
P
I
L
i
R
s
A
=
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
Y
P
l
X
C
P
J
n
H
b
7
b
h
p
p
g
w
+
B
d
k
V
i
M
c
l
U
=
"
>
A
A
A
B
8
3
i
c
b
V
D
L
S
g
M
x
F
L
3
x
W
e
u
r
6
t
J
N
s
A
h
u
L
D
M
i
6
r
L
g
x
m
U
F
+
4
D
O
W
D
J
p
p
g
3
N
Z
I
Y
k
I
w
x
D
f
8
O
N
C
0
X
c
+
j
P
u
/
B
s
z
7
S
y
0
9
U
D
g
c
M
6
9
3
J
M
T
J
I
J
r
4
z
j
f
a
G
V
1
b
X
1
j
s
7
J
V
3
d
7
Z
3
d
u
v
H
R
x
2
d
J
w
q
y
t
o
0
F
r
H
q
B
U
Q
z
w
S
V
r
G
2
4
E
6
y
W
K
k
S
g
Q
r
B
t
M
b
g
u
/
+
8
S
U
5
r
F
8
M
F
n
C
/
I
i
M
J
A
8
5
J
c
Z
K
n
h
c
R
M
w
7
C
P
J
s
+
n
g
9
q
d
a
f
h
z
I
C
X
i
V
u
S
O
p
R
o
D
W
p
f
3
j
C
m
a
c
S
k
o
Y
J
o
3
X
e
d
x
P
g
5
U
Y
Z
T
w
a
Z
V
L
9
U
s
I
X
R
C
R
q
x
v
q
S
Q
R
0
3
4
+
y
z
z
F
p
1
Y
Z
4
j
B
W
9
k
m
D
Z
+
r
v
j
Z
x
E
W
m
d
R
Y
C
e
L
j
H
r
R
K
8
T
/
v
H
5
q
w
h
s
/
5
z
J
J
D
Z
N
0
f
i
h
M
B
T
Y
x
L
g
r
A
Q
6
4
Y
N
S
K
z
h
F
D
F
b
V
Z
M
x
0
Q
R
a
m
x
N
V
V
u
C
u
/
j
l
Z
d
K
5
a
L
i
W
3
1
/
W
m
1
d
l
H
R
U
4
h
h
M
4
A
x
e
u
o
Q
l
3
0
I
I
2
U
E
j
g
G
V
7
h
D
a
X
o
B
b
2
j
j
/
n
o
C
i
p
3
j
u
A
P
0
O
c
P
I
L
i
R
s
A
=
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
V
B
b
w
6
H
Q
3
u
2
M
c
e
T
u
Z
n
3
H
O
k
W
y
I
X
x
0
=
"
>
A
A
A
B
8
3
i
c
b
V
D
L
S
g
M
x
F
L
3
x
W
e
u
r
6
t
J
N
s
A
i
C
U
G
Z
E
1
G
X
B
j
c
s
K
9
g
G
d
s
W
T
S
T
B
u
a
y
Q
x
J
R
h
i
G
/
o
Y
b
F
4
q
4
9
W
f
c
+
T
d
m
2
l
l
o
6
4
H
A
4
Z
x
7
u
S
c
n
S
A
T
X
x
n
G
+
0
c
r
q
2
v
r
G
Z
m
W
r
u
r
2
z
u
7
d
f
O
z
j
s
6
D
h
V
l
L
V
p
L
G
L
V
C
4
h
m
g
k
v
W
N
t
w
I
1
k
s
U
I
1
E
g
W
D
e
Y
3
B
Z
+
9
4
k
p
z
W
P
5
Y
L
K
E
+
R
E
Z
S
R
5
y
S
o
y
V
P
C
8
i
Z
h
y
E
e
T
Z
9
P
B
/
U
6
k
7
D
m
Q
E
v
E
7
c
k
d
S
j
R
G
t
S
+
v
G
F
M
0
4
h
J
Q
w
X
R
u
u
8
6
i
f
F
z
o
g
y
n
g
k
2
r
X
q
p
Z
Q
u
i
E
j
F
j
f
U
k
k
i
p
v
1
8
l
n
m
K
T
6
0
y
x
G
G
s
7
J
M
G
z
9
T
f
G
z
m
J
t
M
6
i
w
E
4
W
G
f
W
i
V
4
j
/
e
f
3
U
h
D
d
+
z
m
W
S
G
i
b
p
/
F
C
Y
C
m
x
i
X
B
S
A
h
1
w
x
a
k
R
m
C
a
G
K
2
6
y
Y
j
o
k
i
1
N
i
a
q
r
Y
E
d
/
H
L
y
6
R
z
0
X
A
t
v
7
+
s
N
6
/
K
O
i
p
w
D
C
d
w
B
i
5
c
Q
x
P
u
o
A
V
t
o
J
D
A
M
7
z
C
G
0
r
R
C
3
p
H
H
/
P
R
F
V
T
u
H
M
E
f
o
M
8
f
H
b
C
R
r
g
=
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
V
B
b
w
6
H
Q
3
u
2
M
c
e
T
u
Z
n
3
H
O
k
W
y
I
X
x
0
=
"
>
A
A
A
B
8
3
i
c
b
V
D
L
S
g
M
x
F
L
3
x
W
e
u
r
6
t
J
N
s
A
i
C
U
G
Z
E
1
G
X
B
j
c
s
K
9
g
G
d
s
W
T
S
T
B
u
a
y
Q
x
J
R
h
i
G
/
o
Y
b
F
4
q
4
9
W
f
c
+
T
d
m
2
l
l
o
6
4
H
A
4
Z
x
7
u
S
c
n
S
A
T
X
x
n
G
+
0
c
r
q
2
v
r
G
Z
m
W
r
u
r
2
z
u
7
d
f
O
z
j
s
6
D
h
V
l
L
V
p
L
G
L
V
C
4
h
m
g
k
v
W
N
t
w
I
1
k
s
U
I
1
E
g
W
D
e
Y
3
B
Z
+
9
4
k
p
z
W
P
5
Y
L
K
E
+
R
E
Z
S
R
5
y
S
o
y
V
P
C
8
i
Z
h
y
E
e
T
Z
9
P
B
/
U
6
k
7
D
m
Q
E
v
E
7
c
k
d
S
j
R
G
t
S
+
v
G
F
M
0
4
h
J
Q
w
X
R
u
u
8
6
i
f
F
z
o
g
y
n
g
k
2
r
X
q
p
Z
Q
u
i
E
j
F
j
f
U
k
k
i
p
v
1
8
l
n
m
K
T
6
0
y
x
G
G
s
7
J
M
G
z
9
T
f
G
z
m
J
t
M
6
i
w
E
4
W
G
f
W
i
V
4
j
/
e
f
3
U
h
D
d
+
z
m
W
S
G
i
b
p
/
F
C
Y
C
m
x
i
X
B
S
A
h
1
w
x
a
k
R
m
C
a
G
K
2
6
y
Y
j
o
k
i
1
N
i
a
q
r
Y
E
d
/
H
L
y
6
R
z
0
X
A
t
v
7
+
s
N
6
/
K
O
i
p
w
D
C
d
w
B
i
5
c
Q
x
P
u
o
A
V
t
o
J
D
A
M
7
z
C
G
0
r
R
C
3
p
H
H
/
P
R
F
V
T
u
H
M
E
f
o
M
8
f
H
b
C
R
r
g
=
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
V
B
b
w
6
H
Q
3
u
2
M
c
e
T
u
Z
n
3
H
O
k
W
y
I
X
x
0
=
"
>
A
A
A
B
8
3
i
c
b
V
D
L
S
g
M
x
F
L
3
x
W
e
u
r
6
t
J
N
s
A
i
C
U
G
Z
E
1
G
X
B
j
c
s
K
9
g
G
d
s
W
T
S
T
B
u
a
y
Q
x
J
R
h
i
G
/
o
Y
b
F
4
q
4
9
W
f
c
+
T
d
m
2
l
l
o
6
4
H
A
4
Z
x
7
u
S
c
n
S
A
T
X
x
n
G
+
0
c
r
q
2
v
r
G
Z
m
W
r
u
r
2
z
u
7
d
f
O
z
j
s
6
D
h
V
l
L
V
p
L
G
L
V
C
4
h
m
g
k
v
W
N
t
w
I
1
k
s
U
I
1
E
g
W
D
e
Y
3
B
Z
+
9
4
k
p
z
W
P
5
Y
L
K
E
+
R
E
Z
S
R
5
y
S
o
y
V
P
C
8
i
Z
h
y
E
e
T
Z
9
P
B
/
U
6
k
7
D
m
Q
E
v
E
7
c
k
d
S
j
R
G
t
S
+
v
G
F
M
0
4
h
J
Q
w
X
R
u
u
8
6
i
f
F
z
o
g
y
n
g
k
2
r
X
q
p
Z
Q
u
i
E
j
F
j
f
U
k
k
i
p
v
1
8
l
n
m
K
T
6
0
y
x
G
G
s
7
J
M
G
z
9
T
f
G
z
m
J
t
M
6
i
w
E
4
W
G
f
W
i
V
4
j
/
e
f
3
U
h
D
d
+
z
m
W
S
G
i
b
p
/
F
C
Y
C
m
x
i
X
B
S
A
h
1
w
x
a
k
R
m
C
a
G
K
2
6
y
Y
j
o
k
i
1
N
i
a
q
r
Y
E
d
/
H
L
y
6
R
z
0
X
A
t
v
7
+
s
N
6
/
K
O
i
p
w
D
C
d
w
B
i
5
c
Q
x
P
u
o
A
V
t
o
J
D
A
M
7
z
C
G
0
r
R
C
3
p
H
H
/
P
R
F
V
T
u
H
M
E
f
o
M
8
f
H
b
C
R
r
g
=
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
V
B
b
w
6
H
Q
3
u
2
M
c
e
T
u
Z
n
3
H
O
k
W
y
I
X
x
0
=
"
>
A
A
A
B
8
3
i
c
b
V
D
L
S
g
M
x
F
L
3
x
W
e
u
r
6
t
J
N
s
A
i
C
U
G
Z
E
1
G
X
B
j
c
s
K
9
g
G
d
s
W
T
S
T
B
u
a
y
Q
x
J
R
h
i
G
/
o
Y
b
F
4
q
4
9
W
f
c
+
T
d
m
2
l
l
o
6
4
H
A
4
Z
x
7
u
S
c
n
S
A
T
X
x
n
G
+
0
c
r
q
2
v
r
G
Z
m
W
r
u
r
2
z
u
7
d
f
O
z
j
s
6
D
h
V
l
L
V
p
L
G
L
V
C
4
h
m
g
k
v
W
N
t
w
I
1
k
s
U
I
1
E
g
W
D
e
Y
3
B
Z
+
9
4
k
p
z
W
P
5
Y
L
K
E
+
R
E
Z
S
R
5
y
S
o
y
V
P
C
8
i
Z
h
y
E
e
T
Z
9
P
B
/
U
6
k
7
D
m
Q
E
v
E
7
c
k
d
S
j
R
G
t
S
+
v
G
F
M
0
4
h
J
Q
w
X
R
u
u
8
6
i
f
F
z
o
g
y
n
g
k
2
r
X
q
p
Z
Q
u
i
E
j
F
j
f
U
k
k
i
p
v
1
8
l
n
m
K
T
6
0
y
x
G
G
s
7
J
M
G
z
9
T
f
G
z
m
J
t
M
6
i
w
E
4
W
G
f
W
i
V
4
j
/
e
f
3
U
h
D
d
+
z
m
W
S
G
i
b
p
/
F
C
Y
C
m
x
i
X
B
S
A
h
1
w
x
a
k
R
m
C
a
G
K
2
6
y
Y
j
o
k
i
1
N
i
a
q
r
Y
E
d
/
H
L
y
6
R
z
0
X
A
t
v
7
+
s
N
6
/
K
O
i
p
w
D
C
d
w
B
i
5
c
Q
x
P
u
o
A
V
t
o
J
D
A
M
7
z
C
G
0
r
R
C
3
p
H
H
/
P
R
F
V
T
u
H
M
E
f
o
M
8
f
H
b
C
R
r
g
=
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
4
w
N
E
g
9
T
E
u
5
Z
s
n
s
V
P
L
A
S
I
w
i
c
s
+
4
I
=
"
>
A
A
A
B
8
X
i
c
b
V
D
L
S
s
N
A
F
L
2
p
r
1
p
f
V
Z
d
u
B
o
v
g
q
i
Q
i
6
r
L
g
x
m
U
F
+
8
A
2
l
M
n
0
p
h
0
6
m
Y
S
Z
i
R
B
C
/
8
K
N
C
0
X
c
+
j
f
u
/
B
u
n
b
R
b
a
e
m
D
g
c
M
6
9
z
L
k
n
S
A
T
X
x
n
W
/
n
d
L
a
+
s
b
m
V
n
m
7
s
r
O
7
t
3
9
Q
P
T
x
q
6
z
h
V
D
F
s
s
F
r
H
q
B
l
S
j
4
B
J
b
h
h
u
B
3
U
Q
h
j
Q
K
B
n
W
B
y
O
/
M
7
T
6
g
0
j
+
W
D
y
R
L
0
I
z
q
S
P
O
S
M
G
i
s
9
9
i
N
q
x
k
G
Y
Z
9
N
B
t
e
b
W
3
T
n
I
K
v
E
K
U
o
M
C
z
U
H
1
q
z
+
M
W
R
q
h
N
E
x
Q
r
X
u
e
m
x
g
/
p
8
p
w
J
n
B
a
6
a
c
a
E
8
o
m
d
I
Q
9
S
y
W
N
U
P
v
5
P
P
G
U
n
F
l
l
S
M
J
Y
2
S
c
N
m
a
u
/
N
3
I
a
a
Z
1
F
g
Z
2
c
J
d
T
L
3
k
z
8
z
+
u
l
J
r
z
x
c
y
6
T
1
K
B
k
i
4
/
C
V
B
A
T
k
9
n
5
Z
M
g
V
M
i
M
y
S
y
h
T
3
G
Y
l
b
E
w
V
Z
c
a
W
V
L
E
l
e
M
s
n
r
5
L
2
R
d
2
z
/
P
6
y
1
r
g
q
6
i
j
D
C
Z
z
C
O
X
h
w
D
Q
2
4
g
y
a
0
g
I
G
E
Z
3
i
F
N
0
c
7
L
8
6
7
8
7
E
Y
L
T
n
F
z
j
H
8
g
f
P
5
A
/
s
k
k
R
E
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
4
w
N
E
g
9
T
E
u
5
Z
s
n
s
V
P
L
A
S
I
w
i
c
s
+
4
I
=
"
>
A
A
A
B
8
X
i
c
b
V
D
L
S
s
N
A
F
L
2
p
r
1
p
f
V
Z
d
u
B
o
v
g
q
i
Q
i
6
r
L
g
x
m
U
F
+
8
A
2
l
M
n
0
p
h
0
6
m
Y
S
Z
i
R
B
C
/
8
K
N
C
0
X
c
+
j
f
u
/
B
u
n
b
R
b
a
e
m
D
g
c
M
6
9
z
L
k
n
S
A
T
X
x
n
W
/
n
d
L
a
+
s
b
m
V
n
m
7
s
r
O
7
t
3
9
Q
P
T
x
q
6
z
h
V
D
F
s
s
F
r
H
q
B
l
S
j
4
B
J
b
h
h
u
B
3
U
Q
h
j
Q
K
B
n
W
B
y
O
/
M
7
T
6
g
0
j
+
W
D
y
R
L
0
I
z
q
S
P
O
S
M
G
i
s
9
9
i
N
q
x
k
G
Y
Z
9
N
B
t
e
b
W
3
T
n
I
K
v
E
K
U
o
M
C
z
U
H
1
q
z
+
M
W
R
q
h
N
E
x
Q
r
X
u
e
m
x
g
/
p
8
p
w
J
n
B
a
6
a
c
a
E
8
o
m
d
I
Q
9
S
y
W
N
U
P
v
5
P
P
G
U
n
F
l
l
S
M
J
Y
2
S
c
N
m
a
u
/
N
3
I
a
a
Z
1
F
g
Z
2
c
J
d
T
L
3
k
z
8
z
+
u
l
J
r
z
x
c
y
6
T
1
K
B
k
i
4
/
C
V
B
A
T
k
9
n
5
Z
M
g
V
M
i
M
y
S
y
h
T
3
G
Y
l
b
E
w
V
Z
c
a
W
V
L
E
l
e
M
s
n
r
5
L
2
R
d
2
z
/
P
6
y
1
r
g
q
6
i
j
D
C
Z
z
C
O
X
h
w
D
Q
2
4
g
y
a
0
g
I
G
E
Z
3
i
F
N
0
c
7
L
8
6
7
8
7
E
Y
L
T
n
F
z
j
H
8
g
f
P
5
A
/
s
k
k
R
E
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
4
w
N
E
g
9
T
E
u
5
Z
s
n
s
V
P
L
A
S
I
w
i
c
s
+
4
I
=
"
>
A
A
A
B
8
X
i
c
b
V
D
L
S
s
N
A
F
L
2
p
r
1
p
f
V
Z
d
u
B
o
v
g
q
i
Q
i
6
r
L
g
x
m
U
F
+
8
A
2
l
M
n
0
p
h
0
6
m
Y
S
Z
i
R
B
C
/
8
K
N
C
0
X
c
+
j
f
u
/
B
u
n
b
R
b
a
e
m
D
g
c
M
6
9
z
L
k
n
S
A
T
X
x
n
W
/
n
d
L
a
+
s
b
m
V
n
m
7
s
r
O
7
t
3
9
Q
P
T
x
q
6
z
h
V
D
F
s
s
F
r
H
q
B
l
S
j
4
B
J
b
h
h
u
B
3
U
Q
h
j
Q
K
B
n
W
B
y
O
/
M
7
T
6
g
0
j
+
W
D
y
R
L
0
I
z
q
S
P
O
S
M
G
i
s
9
9
i
N
q
x
k
G
Y
Z
9
N
B
t
e
b
W
3
T
n
I
K
v
E
K
U
o
M
C
z
U
H
1
q
z
+
M
W
R
q
h
N
E
x
Q
r
X
u
e
m
x
g
/
p
8
p
w
J
n
B
a
6
a
c
a
E
8
o
m
d
I
Q
9
S
y
W
N
U
P
v
5
P
P
G
U
n
F
l
l
S
M
J
Y
2
S
c
N
m
a
u
/
N
3
I
a
a
Z
1
F
g
Z
2
c
J
d
T
L
3
k
z
8
z
+
u
l
J
r
z
x
c
y
6
T
1
K
B
k
i
4
/
C
V
B
A
T
k
9
n
5
Z
M
g
V
M
i
M
y
S
y
h
T
3
G
Y
l
b
E
w
V
Z
c
a
W
V
L
E
l
e
M
s
n
r
5
L
2
R
d
2
z
/
P
6
y
1
r
g
q
6
i
j
D
C
Z
z
C
O
X
h
w
D
Q
2
4
g
y
a
0
g
I
G
E
Z
3
i
F
N
0
c
7
L
8
6
7
8
7
E
Y
L
T
n
F
z
j
H
8
g
f
P
5
A
/
s
k
k
R
E
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
4
w
N
E
g
9
T
E
u
5
Z
s
n
s
V
P
L
A
S
I
w
i
c
s
+
4
I
=
"
>
A
A
A
B
8
X
i
c
b
V
D
L
S
s
N
A
F
L
2
p
r
1
p
f
V
Z
d
u
B
o
v
g
q
i
Q
i
6
r
L
g
x
m
U
F
+
8
A
2
l
M
n
0
p
h
0
6
m
Y
S
Z
i
R
B
C
/
8
K
N
C
0
X
c
+
j
f
u
/
B
u
n
b
R
b
a
e
m
D
g
c
M
6
9
z
L
k
n
S
A
T
X
x
n
W
/
n
d
L
a
+
s
b
m
V
n
m
7
s
r
O
7
t
3
9
Q
P
T
x
q
6
z
h
V
D
F
s
s
F
r
H
q
B
l
S
j
4
B
J
b
h
h
u
B
3
U
Q
h
j
Q
K
B
n
W
B
y
O
/
M
7
T
6
g
0
j
+
W
D
y
R
L
0
I
z
q
S
P
O
S
M
G
i
s
9
9
i
N
q
x
k
G
Y
Z
9
N
B
t
e
b
W
3
T
n
I
K
v
E
K
U
o
M
C
z
U
H
1
q
z
+
M
W
R
q
h
N
E
x
Q
r
X
u
e
m
x
g
/
p
8
p
w
J
n
B
a
6
a
c
a
E
8
o
m
d
I
Q
9
S
y
W
N
U
P
v
5
P
P
G
U
n
F
l
l
S
M
J
Y
2
S
c
N
m
a
u
/
N
3
I
a
a
Z
1
F
g
Z
2
c
J
d
T
L
3
k
z
8
z
+
u
l
J
r
z
x
c
y
6
T
1
K
B
k
i
4
/
C
V
B
A
T
k
9
n
5
Z
M
g
V
M
i
M
y
S
y
h
T
3
G
Y
l
b
E
w
V
Z
c
a
W
V
L
E
l
e
M
s
n
r
5
L
2
R
d
2
z
/
P
6
y
1
r
g
q
6
i
j
D
C
Z
z
C
O
X
h
w
D
Q
2
4
g
y
a
0
g
I
G
E
Z
3
i
F
N
0
c
7
L
8
6
7
8
7
E
Y
L
T
n
F
z
j
H
8
g
f
P
5
A
/
s
k
k
R
E
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
3
y
Y
n
y
3
X
s
O
8
a
s
4
m
I
S
7
s
N
J
k
+
3
T
E
/
M
=
"
>
A
A
A
B
+
3
i
c
b
V
D
L
S
s
N
A
F
L
2
p
r
1
p
f
s
S
7
d
D
B
b
B
j
S
U
R
U
Z
c
F
N
y
4
r
2
A
e
0
s
U
y
m
k
3
b
o
Z
B
J
m
J
m
I
N
+
R
U
3
L
h
R
x
6
4
+
4
8
2
+
c
t
F
l
o
6
4
G
B
w
z
n
3
c
s
8
c
P
+
Z
M
a
c
f
5
t
k
o
r
q
2
v
r
G
+
X
N
y
t
b
2
z
u
6
e
v
V
9
t
q
y
i
R
h
L
Z
I
x
C
P
Z
9
b
G
i
n
A
n
a
0
k
x
z
2
o
0
l
x
a
H
P
a
c
e
f
X
O
d
+
5
4
F
K
x
S
J
x
p
6
c
x
9
U
I
8
E
i
x
g
B
G
s
j
D
e
x
q
f
4
x
1
2
g
+
x
H
v
t
B
+
p
R
l
9
6
c
D
u
+
b
U
n
R
n
Q
M
n
E
L
U
o
M
C
z
Y
H
9
1
R
9
G
J
A
m
p
0
I
R
j
p
X
q
u
E
2
s
v
x
V
I
z
w
m
l
W
6
S
e
K
x
p
h
M
8
I
j
2
D
B
U
4
p
M
p
L
Z
9
k
z
d
G
y
U
I
Q
o
i
a
Z
7
Q
a
K
b
+
3
k
h
x
q
N
Q
0
9
M
1
k
H
l
I
t
e
r
n
4
n
9
d
L
d
H
D
l
p
U
z
E
i
a
a
C
z
A
8
F
C
U
c
6
Q
n
k
R
a
M
g
k
J
Z
p
P
D
c
F
E
M
p
M
V
k
T
G
W
m
G
h
T
V
8
W
U
4
C
5
+
e
Z
m
0
z
+
q
u
4
b
f
n
t
c
Z
F
U
U
c
Z
D
u
E
I
T
s
C
F
S
2
j
A
D
T
S
h
B
Q
Q
e
4
R
l
e
4
c
3
K
r
B
f
r
3
f
q
Y
j
5
a
s
Y
u
c
A
/
s
D
6
/
A
G
A
d
p
S
v
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
3
y
Y
n
y
3
X
s
O
8
a
s
4
m
I
S
7
s
N
J
k
+
3
T
E
/
M
=
"
>
A
A
A
B
+
3
i
c
b
V
D
L
S
s
N
A
F
L
2
p
r
1
p
f
s
S
7
d
D
B
b
B
j
S
U
R
U
Z
c
F
N
y
4
r
2
A
e
0
s
U
y
m
k
3
b
o
Z
B
J
m
J
m
I
N
+
R
U
3
L
h
R
x
6
4
+
4
8
2
+
c
t
F
l
o
6
4
G
B
w
z
n
3
c
s
8
c
P
+
Z
M
a
c
f
5
t
k
o
r
q
2
v
r
G
+
X
N
y
t
b
2
z
u
6
e
v
V
9
t
q
y
i
R
h
L
Z
I
x
C
P
Z
9
b
G
i
n
A
n
a
0
k
x
z
2
o
0
l
x
a
H
P
a
c
e
f
X
O
d
+
5
4
F
K
x
S
J
x
p
6
c
x
9
U
I
8
E
i
x
g
B
G
s
j
D
e
x
q
f
4
x
1
2
g
+
x
H
v
t
B
+
p
R
l
9
6
c
D
u
+
b
U
n
R
n
Q
M
n
E
L
U
o
M
C
z
Y
H
9
1
R
9
G
J
A
m
p
0
I
R
j
p
X
q
u
E
2
s
v
x
V
I
z
w
m
l
W
6
S
e
K
x
p
h
M
8
I
j
2
D
B
U
4
p
M
p
L
Z
9
k
z
d
G
y
U
I
Q
o
i
a
Z
7
Q
a
K
b
+
3
k
h
x
q
N
Q
0
9
M
1
k
H
l
I
t
e
r
n
4
n
9
d
L
d
H
D
l
p
U
z
E
i
a
a
C
z
A
8
F
C
U
c
6
Q
n
k
R
a
M
g
k
J
Z
p
P
D
c
F
E
M
p
M
V
k
T
G
W
m
G
h
T
V
8
W
U
4
C
5
+
e
Z
m
0
z
+
q
u
4
b
f
n
t
c
Z
F
U
U
c
Z
D
u
E
I
T
s
C
F
S
2
j
A
D
T
S
h
B
Q
Q
e
4
R
l
e
4
c
3
K
r
B
f
r
3
f
q
Y
j
5
a
s
Y
u
c
A
/
s
D
6
/
A
G
A
d
p
S
v
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
3
y
Y
n
y
3
X
s
O
8
a
s
4
m
I
S
7
s
N
J
k
+
3
T
E
/
M
=
"
>
A
A
A
B
+
3
i
c
b
V
D
L
S
s
N
A
F
L
2
p
r
1
p
f
s
S
7
d
D
B
b
B
j
S
U
R
U
Z
c
F
N
y
4
r
2
A
e
0
s
U
y
m
k
3
b
o
Z
B
J
m
J
m
I
N
+
R
U
3
L
h
R
x
6
4
+
4
8
2
+
c
t
F
l
o
6
4
G
B
w
z
n
3
c
s
8
c
P
+
Z
M
a
c
f
5
t
k
o
r
q
2
v
r
G
+
X
N
y
t
b
2
z
u
6
e
v
V
9
t
q
y
i
R
h
L
Z
I
x
C
P
Z
9
b
G
i
n
A
n
a
0
k
x
z
2
o
0
l
x
a
H
P
a
c
e
f
X
O
d
+
5
4
F
K
x
S
J
x
p
6
c
x
9
U
I
8
E
i
x
g
B
G
s
j
D
e
x
q
f
4
x
1
2
g
+
x
H
v
t
B
+
p
R
l
9
6
c
D
u
+
b
U
n
R
n
Q
M
n
E
L
U
o
M
C
z
Y
H
9
1
R
9
G
J
A
m
p
0
I
R
j
p
X
q
u
E
2
s
v
x
V
I
z
w
m
l
W
6
S
e
K
x
p
h
M
8
I
j
2
D
B
U
4
p
M
p
L
Z
9
k
z
d
G
y
U
I
Q
o
i
a
Z
7
Q
a
K
b
+
3
k
h
x
q
N
Q
0
9
M
1
k
H
l
I
t
e
r
n
4
n
9
d
L
d
H
D
l
p
U
z
E
i
a
a
C
z
A
8
F
C
U
c
6
Q
n
k
R
a
M
g
k
J
Z
p
P
D
c
F
E
M
p
M
V
k
T
G
W
m
G
h
T
V
8
W
U
4
C
5
+
e
Z
m
0
z
+
q
u
4
b
f
n
t
c
Z
F
U
U
c
Z
D
u
E
I
T
s
C
F
S
2
j
A
D
T
S
h
B
Q
Q
e
4
R
l
e
4
c
3
K
r
B
f
r
3
f
q
Y
j
5
a
s
Y
u
c
A
/
s
D
6
/
A
G
A
d
p
S
v
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
3
y
Y
n
y
3
X
s
O
8
a
s
4
m
I
S
7
s
N
J
k
+
3
T
E
/
M
=
"
>
A
A
A
B
+
3
i
c
b
V
D
L
S
s
N
A
F
L
2
p
r
1
p
f
s
S
7
d
D
B
b
B
j
S
U
R
U
Z
c
F
N
y
4
r
2
A
e
0
s
U
y
m
k
3
b
o
Z
B
J
m
J
m
I
N
+
R
U
3
L
h
R
x
6
4
+
4
8
2
+
c
t
F
l
o
6
4
G
B
w
z
n
3
c
s
8
c
P
+
Z
M
a
c
f
5
t
k
o
r
q
2
v
r
G
+
X
N
y
t
b
2
z
u
6
e
v
V
9
t
q
y
i
R
h
L
Z
I
x
C
P
Z
9
b
G
i
n
A
n
a
0
k
x
z
2
o
0
l
x
a
H
P
a
c
e
f
X
O
d
+
5
4
F
K
x
S
J
x
p
6
c
x
9
U
I
8
E
i
x
g
B
G
s
j
D
e
x
q
f
4
x
1
2
g
+
x
H
v
t
B
+
p
R
l
9
6
c
D
u
+
b
U
n
R
n
Q
M
n
E
L
U
o
M
C
z
Y
H
9
1
R
9
G
J
A
m
p
0
I
R
j
p
X
q
u
E
2
s
v
x
V
I
z
w
m
l
W
6
S
e
K
x
p
h
M
8
I
j
2
D
B
U
4
p
M
p
L
Z
9
k
z
d
G
y
U
I
Q
o
i
a
Z
7
Q
a
K
b
+
3
k
h
x
q
N
Q
0
9
M
1
k
H
l
I
t
e
r
n
4
n
9
d
L
d
H
D
l
p
U
z
E
i
a
a
C
z
A
8
F
C
U
c
6
Q
n
k
R
a
M
g
k
J
Z
p
P
D
c
F
E
M
p
M
V
k
T
G
W
m
G
h
T
V
8
W
U
4
C
5
+
e
Z
m
0
z
+
q
u
4
b
f
n
t
c
Z
F
U
U
c
Z
D
u
E
I
T
s
C
F
S
2
j
A
D
T
S
h
B
Q
Q
e
4
R
l
e
4
c
3
K
r
B
f
r
3
f
q
Y
j
5
a
s
Y
u
c
A
/
s
D
6
/
A
G
A
d
p
S
v
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
9
D
L
4
+
L
Y
h
D
j
t
W
E
A
D
x
/
K
d
E
+
w
t
j
1
2
s
=
"
>
A
A
A
B
+
3
i
c
b
V
D
L
S
s
N
A
F
L
3
x
W
e
u
r
1
q
W
b
w
S
K
4
s
S
Q
i
6
r
L
g
x
m
U
F
+
4
A
m
l
s
l
0
0
g
6
d
T
M
L
M
R
A
w
h
v
+
L
G
h
S
J
u
/
R
F
3
/
o
2
T
N
g
t
t
P
T
B
w
O
O
d
e
7
p
n
j
x
5
w
p
b
d
v
f
1
s
r
q
2
v
r
G
Z
m
W
r
u
r
2
z
u
7
d
f
O
6
h
3
V
Z
R
I
Q
j
s
k
4
p
H
s
+
1
h
R
z
g
T
t
a
K
Y
5
7
c
e
S
4
t
D
n
t
O
d
P
b
w
q
/
9
0
i
l
Y
p
G
4
1
2
l
M
v
R
C
P
B
Q
s
Y
w
d
p
I
w
1
r
d
n
W
C
d
u
S
H
W
E
z
/
I
0
j
x
/
O
B
v
W
G
n
b
T
n
g
E
t
E
6
c
k
D
S
j
R
H
t
a
+
3
F
F
E
k
p
A
K
T
T
h
W
a
u
D
Y
s
f
Y
y
L
D
U
j
n
O
Z
V
N
1
E
0
x
m
S
K
x
3
R
g
q
M
A
h
V
V
4
2
y
5
6
j
E
6
O
M
U
B
B
J
8
4
R
G
M
/
X
3
R
o
Z
D
p
d
L
Q
N
5
N
F
S
L
X
o
F
e
J
/
3
i
D
R
w
b
W
X
M
R
E
n
m
g
o
y
P
x
Q
k
H
O
k
I
F
U
W
g
E
Z
O
U
a
J
4
a
g
o
l
k
J
i
s
i
E
y
w
x
0
a
a
u
q
i
n
B
W
f
z
y
M
u
m
e
N
x
3
D
7
y
4
a
r
c
u
y
j
g
o
c
w
T
G
c
g
g
N
X
0
I
J
b
a
E
M
H
C
D
z
B
M
7
z
C
m
5
V
b
L
9
a
7
9
T
E
f
X
b
H
K
n
U
P
4
A
+
v
z
B
3
7
u
l
K
4
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
9
D
L
4
+
L
Y
h
D
j
t
W
E
A
D
x
/
K
d
E
+
w
t
j
1
2
s
=
"
>
A
A
A
B
+
3
i
c
b
V
D
L
S
s
N
A
F
L
3
x
W
e
u
r
1
q
W
b
w
S
K
4
s
S
Q
i
6
r
L
g
x
m
U
F
+
4
A
m
l
s
l
0
0
g
6
d
T
M
L
M
R
A
w
h
v
+
L
G
h
S
J
u
/
R
F
3
/
o
2
T
N
g
t
t
P
T
B
w
O
O
d
e
7
p
n
j
x
5
w
p
b
d
v
f
1
s
r
q
2
v
r
G
Z
m
W
r
u
r
2
z
u
7
d
f
O
6
h
3
V
Z
R
I
Q
j
s
k
4
p
H
s
+
1
h
R
z
g
T
t
a
K
Y
5
7
c
e
S
4
t
D
n
t
O
d
P
b
w
q
/
9
0
i
l
Y
p
G
4
1
2
l
M
v
R
C
P
B
Q
s
Y
w
d
p
I
w
1
r
d
n
W
C
d
u
S
H
W
E
z
/
I
0
j
x
/
O
B
v
W
G
n
b
T
n
g
E
t
E
6
c
k
D
S
j
R
H
t
a
+
3
F
F
E
k
p
A
K
T
T
h
W
a
u
D
Y
s
f
Y
y
L
D
U
j
n
O
Z
V
N
1
E
0
x
m
S
K
x
3
R
g
q
M
A
h
V
V
4
2
y
5
6
j
E
6
O
M
U
B
B
J
8
4
R
G
M
/
X
3
R
o
Z
D
p
d
L
Q
N
5
N
F
S
L
X
o
F
e
J
/
3
i
D
R
w
b
W
X
M
R
E
n
m
g
o
y
P
x
Q
k
H
O
k
I
F
U
W
g
E
Z
O
U
a
J
4
a
g
o
l
k
J
i
s
i
E
y
w
x
0
a
a
u
q
i
n
B
W
f
z
y
M
u
m
e
N
x
3
D
7
y
4
a
r
c
u
y
j
g
o
c
w
T
G
c
g
g
N
X
0
I
J
b
a
E
M
H
C
D
z
B
M
7
z
C
m
5
V
b
L
9
a
7
9
T
E
f
X
b
H
K
n
U
P
4
A
+
v
z
B
3
7
u
l
K
4
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
9
D
L
4
+
L
Y
h
D
j
t
W
E
A
D
x
/
K
d
E
+
w
t
j
1
2
s
=
"
>
A
A
A
B
+
3
i
c
b
V
D
L
S
s
N
A
F
L
3
x
W
e
u
r
1
q
W
b
w
S
K
4
s
S
Q
i
6
r
L
g
x
m
U
F
+
4
A
m
l
s
l
0
0
g
6
d
T
M
L
M
R
A
w
h
v
+
L
G
h
S
J
u
/
R
F
3
/
o
2
T
N
g
t
t
P
T
B
w
O
O
d
e
7
p
n
j
x
5
w
p
b
d
v
f
1
s
r
q
2
v
r
G
Z
m
W
r
u
r
2
z
u
7
d
f
O
6
h
3
V
Z
R
I
Q
j
s
k
4
p
H
s
+
1
h
R
z
g
T
t
a
K
Y
5
7
c
e
S
4
t
D
n
t
O
d
P
b
w
q
/
9
0
i
l
Y
p
G
4
1
2
l
M
v
R
C
P
B
Q
s
Y
w
d
p
I
w
1
r
d
n
W
C
d
u
S
H
W
E
z
/
I
0
j
x
/
O
B
v
W
G
n
b
T
n
g
E
t
E
6
c
k
D
S
j
R
H
t
a
+
3
F
F
E
k
p
A
K
T
T
h
W
a
u
D
Y
s
f
Y
y
L
D
U
j
n
O
Z
V
N
1
E
0
x
m
S
K
x
3
R
g
q
M
A
h
V
V
4
2
y
5
6
j
E
6
O
M
U
B
B
J
8
4
R
G
M
/
X
3
R
o
Z
D
p
d
L
Q
N
5
N
F
S
L
X
o
F
e
J
/
3
i
D
R
w
b
W
X
M
R
E
n
m
g
o
y
P
x
Q
k
H
O
k
I
F
U
W
g
E
Z
O
U
a
J
4
a
g
o
l
k
J
i
s
i
E
y
w
x
0
a
a
u
q
i
n
B
W
f
z
y
M
u
m
e
N
x
3
D
7
y
4
a
r
c
u
y
j
g
o
c
w
T
G
c
g
g
N
X
0
I
J
b
a
E
M
H
C
D
z
B
M
7
z
C
m
5
V
b
L
9
a
7
9
T
E
f
X
b
H
K
n
U
P
4
A
+
v
z
B
3
7
u
l
K
4
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
9
D
L
4
+
L
Y
h
D
j
t
W
E
A
D
x
/
K
d
E
+
w
t
j
1
2
s
=
"
>
A
A
A
B
+
3
i
c
b
V
D
L
S
s
N
A
F
L
3
x
W
e
u
r
1
q
W
b
w
S
K
4
s
S
Q
i
6
r
L
g
x
m
U
F
+
4
A
m
l
s
l
0
0
g
6
d
T
M
L
M
R
A
w
h
v
+
L
G
h
S
J
u
/
R
F
3
/
o
2
T
N
g
t
t
P
T
B
w
O
O
d
e
7
p
n
j
x
5
w
p
b
d
v
f
1
s
r
q
2
v
r
G
Z
m
W
r
u
r
2
z
u
7
d
f
O
6
h
3
V
Z
R
I
Q
j
s
k
4
p
H
s
+
1
h
R
z
g
T
t
a
K
Y
5
7
c
e
S
4
t
D
n
t
O
d
P
b
w
q
/
9
0
i
l
Y
p
G
4
1
2
l
M
v
R
C
P
B
Q
s
Y
w
d
p
I
w
1
r
d
n
W
C
d
u
S
H
W
E
z
/
I
0
j
x
/
O
B
v
W
G
n
b
T
n
g
E
t
E
6
c
k
D
S
j
R
H
t
a
+
3
F
F
E
k
p
A
K
T
T
h
W
a
u
D
Y
s
f
Y
y
L
D
U
j
n
O
Z
V
N
1
E
0
x
m
S
K
x
3
R
g
q
M
A
h
V
V
4
2
y
5
6
j
E
6
O
M
U
B
B
J
8
4
R
G
M
/
X
3
R
o
Z
D
p
d
L
Q
N
5
N
F
S
L
X
o
F
e
J
/
3
i
D
R
w
b
W
X
M
R
E
n
m
g
o
y
P
x
Q
k
H
O
k
I
F
U
W
g
E
Z
O
U
a
J
4
a
g
o
l
k
J
i
s
i
E
y
w
x
0
a
a
u
q
i
n
B
W
f
z
y
M
u
m
e
N
x
3
D
7
y
4
a
r
c
u
y
j
g
o
c
w
T
G
c
g
g
N
X
0
I
J
b
a
E
M
H
C
D
z
B
M
7
z
C
m
5
V
b
L
9
a
7
9
T
E
f
X
b
H
K
n
U
P
4
A
+
v
z
B
3
7
u
l
K
4
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
3
k
0
2
G
Q
M
y
/
g
+
z
n
8
P
/
w
T
L
s
S
1
9
4
2
c
w
=
"
>
A
A
A
C
A
X
i
c
b
Z
D
L
S
s
N
A
F
I
Y
n
9
V
b
r
L
e
p
G
c
B
M
s
g
h
t
L
I
q
I
u
C
2
5
c
V
r
A
X
a
G
K
Z
T
E
7
a
o
Z
N
J
m
J
k
o
N
c
S
N
r
+
L
G
h
S
J
u
f
Q
t
3
v
o
2
T
t
g
t
t
/
W
H
g
4
z
/
n
M
O
f
8
f
s
K
o
V
L
b
9
b
Z
Q
W
F
p
e
W
V
8
q
r
l
b
X
1
j
c
0
t
c
3
u
n
J
e
N
U
E
G
i
S
m
M
W
i
4
2
M
J
j
H
J
o
K
q
o
Y
d
B
I
B
O
P
I
Z
t
P
3
h
Z
V
F
v
3
4
G
Q
N
O
Y
3
a
p
S
A
F
+
E
+
p
y
E
l
W
G
m
r
Z
+
6
5
9
z
Q
A
R
V
k
A
m
R
t
h
N
f
D
D
7
C
H
P
b
4
9
7
Z
t
W
u
2
W
N
Z
8
+
B
M
o
Y
q
m
a
v
T
M
L
z
e
I
S
R
o
B
V
4
R
h
K
b
u
O
n
S
g
v
w
0
J
R
w
i
C
v
u
K
m
E
B
J
M
h
7
k
N
X
I
8
c
R
S
C
8
b
X
5
B
b
h
9
o
J
r
D
A
W
+
n
F
l
j
d
3
f
E
x
m
O
p
B
x
F
v
u
4
s
l
p
S
z
t
c
L
8
r
9
Z
N
V
X
j
h
Z
Z
Q
n
q
Q
J
O
J
h
+
F
K
b
N
U
b
B
V
x
W
A
E
V
Q
B
Q
b
a
c
B
E
U
L
2
r
R
Q
Z
Y
Y
K
J
0
a
B
U
d
g
j
N
7
8
j
y
0
T
m
q
O
5
u
v
T
a
v
1
s
G
k
c
Z
7
a
M
D
d
I
Q
c
d
I
7
q
6
A
o
1
U
B
M
R
9
I
i
e
0
S
t
6
M
5
6
M
F
+
P
d
+
J
i
0
l
o
z
p
z
C
7
6
I
+
P
z
B
1
m
/
l
2
k
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
3
k
0
2
G
Q
M
y
/
g
+
z
n
8
P
/
w
T
L
s
S
1
9
4
2
c
w
=
"
>
A
A
A
C
A
X
i
c
b
Z
D
L
S
s
N
A
F
I
Y
n
9
V
b
r
L
e
p
G
c
B
M
s
g
h
t
L
I
q
I
u
C
2
5
c
V
r
A
X
a
G
K
Z
T
E
7
a
o
Z
N
J
m
J
k
o
N
c
S
N
r
+
L
G
h
S
J
u
f
Q
t
3
v
o
2
T
t
g
t
t
/
W
H
g
4
z
/
n
M
O
f
8
f
s
K
o
V
L
b
9
b
Z
Q
W
F
p
e
W
V
8
q
r
l
b
X
1
j
c
0
t
c
3
u
n
J
e
N
U
E
G
i
S
m
M
W
i
4
2
M
J
j
H
J
o
K
q
o
Y
d
B
I
B
O
P
I
Z
t
P
3
h
Z
V
F
v
3
4
G
Q
N
O
Y
3
a
p
S
A
F
+
E
+
p
y
E
l
W
G
m
r
Z
+
6
5
9
z
Q
A
R
V
k
A
m
R
t
h
N
f
D
D
7
C
H
P
b
4
9
7
Z
t
W
u
2
W
N
Z
8
+
B
M
o
Y
q
m
a
v
T
M
L
z
e
I
S
R
o
B
V
4
R
h
K
b
u
O
n
S
g
v
w
0
J
R
w
i
C
v
u
K
m
E
B
J
M
h
7
k
N
X
I
8
c
R
S
C
8
b
X
5
B
b
h
9
o
J
r
D
A
W
+
n
F
l
j
d
3
f
E
x
m
O
p
B
x
F
v
u
4
s
l
p
S
z
t
c
L
8
r
9
Z
N
V
X
j
h
Z
Z
Q
n
q
Q
J
O
J
h
+
F
K
b
N
U
b
B
V
x
W
A
E
V
Q
B
Q
b
a
c
B
E
U
L
2
r
R
Q
Z
Y
Y
K
J
0
a
B
U
d
g
j
N
7
8
j
y
0
T
m
q
O
5
u
v
T
a
v
1
s
G
k
c
Z
7
a
M
D
d
I
Q
c
d
I
7
q
6
A
o
1
U
B
M
R
9
I
i
e
0
S
t
6
M
5
6
M
F
+
P
d
+
J
i
0
l
o
z
p
z
C
7
6
I
+
P
z
B
1
m
/
l
2
k
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
3
k
0
2
G
Q
M
y
/
g
+
z
n
8
P
/
w
T
L
s
S
1
9
4
2
c
w
=
"
>
A
A
A
C
A
X
i
c
b
Z
D
L
S
s
N
A
F
I
Y
n
9
V
b
r
L
e
p
G
c
B
M
s
g
h
t
L
I
q
I
u
C
2
5
c
V
r
A
X
a
G
K
Z
T
E
7
a
o
Z
N
J
m
J
k
o
N
c
S
N
r
+
L
G
h
S
J
u
f
Q
t
3
v
o
2
T
t
g
t
t
/
W
H
g
4
z
/
n
M
O
f
8
f
s
K
o
V
L
b
9
b
Z
Q
W
F
p
e
W
V
8
q
r
l
b
X
1
j
c
0
t
c
3
u
n
J
e
N
U
E
G
i
S
m
M
W
i
4
2
M
J
j
H
J
o
K
q
o
Y
d
B
I
B
O
P
I
Z
t
P
3
h
Z
V
F
v
3
4
G
Q
N
O
Y
3
a
p
S
A
F
+
E
+
p
y
E
l
W
G
m
r
Z
+
6
5
9
z
Q
A
R
V
k
A
m
R
t
h
N
f
D
D
7
C
H
P
b
4
9
7
Z
t
W
u
2
W
N
Z
8
+
B
M
o
Y
q
m
a
v
T
M
L
z
e
I
S
R
o
B
V
4
R
h
K
b
u
O
n
S
g
v
w
0
J
R
w
i
C
v
u
K
m
E
B
J
M
h
7
k
N
X
I
8
c
R
S
C
8
b
X
5
B
b
h
9
o
J
r
D
A
W
+
n
F
l
j
d
3
f
E
x
m
O
p
B
x
F
v
u
4
s
l
p
S
z
t
c
L
8
r
9
Z
N
V
X
j
h
Z
Z
Q
n
q
Q
J
O
J
h
+
F
K
b
N
U
b
B
V
x
W
A
E
V
Q
B
Q
b
a
c
B
E
U
L
2
r
R
Q
Z
Y
Y
K
J
0
a
B
U
d
g
j
N
7
8
j
y
0
T
m
q
O
5
u
v
T
a
v
1
s
G
k
c
Z
7
a
M
D
d
I
Q
c
d
I
7
q
6
A
o
1
U
B
M
R
9
I
i
e
0
S
t
6
M
5
6
M
F
+
P
d
+
J
i
0
l
o
z
p
z
C
7
6
I
+
P
z
B
1
m
/
l
2
k
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
3
k
0
2
G
Q
M
y
/
g
+
z
n
8
P
/
w
T
L
s
S
1
9
4
2
c
w
=
"
>
A
A
A
C
A
X
i
c
b
Z
D
L
S
s
N
A
F
I
Y
n
9
V
b
r
L
e
p
G
c
B
M
s
g
h
t
L
I
q
I
u
C
2
5
c
V
r
A
X
a
G
K
Z
T
E
7
a
o
Z
N
J
m
J
k
o
N
c
S
N
r
+
L
G
h
S
J
u
f
Q
t
3
v
o
2
T
t
g
t
t
/
W
H
g
4
z
/
n
M
O
f
8
f
s
K
o
V
L
b
9
b
Z
Q
W
F
p
e
W
V
8
q
r
l
b
X
1
j
c
0
t
c
3
u
n
J
e
N
U
E
G
i
S
m
M
W
i
4
2
M
J
j
H
J
o
K
q
o
Y
d
B
I
B
O
P
I
Z
t
P
3
h
Z
V
F
v
3
4
G
Q
N
O
Y
3
a
p
S
A
F
+
E
+
p
y
E
l
W
G
m
r
Z
+
6
5
9
z
Q
A
R
V
k
A
m
R
t
h
N
f
D
D
7
C
H
P
b
4
9
7
Z
t
W
u
2
W
N
Z
8
+
B
M
o
Y
q
m
a
v
T
M
L
z
e
I
S
R
o
B
V
4
R
h
K
b
u
O
n
S
g
v
w
0
J
R
w
i
C
v
u
K
m
E
B
J
M
h
7
k
N
X
I
8
c
R
S
C
8
b
X
5
B
b
h
9
o
J
r
D
A
W
+
n
F
l
j
d
3
f
E
x
m
O
p
B
x
F
v
u
4
s
l
p
S
z
t
c
L
8
r
9
Z
N
V
X
j
h
Z
Z
Q
n
q
Q
J
O
J
h
+
F
K
b
N
U
b
B
V
x
W
A
E
V
Q
B
Q
b
a
c
B
E
U
L
2
r
R
Q
Z
Y
Y
K
J
0
a
B
U
d
g
j
N
7
8
j
y
0
T
m
q
O
5
u
v
T
a
v
1
s
G
k
c
Z
7
a
M
D
d
I
Q
c
d
I
7
q
6
A
o
1
U
B
M
R
9
I
i
e
0
S
t
6
M
5
6
M
F
+
P
d
+
J
i
0
l
o
z
p
z
C
7
6
I
+
P
z
B
1
m
/
l
2
k
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
C
P
P
D
v
u
u
F
B
W
S
g
d
e
8
z
y
T
z
o
S
s
I
9
j
z
o
=
"
>
A
A
A
B
8
3
i
c
b
V
D
L
S
g
M
x
F
L
1
T
X
7
W
+
q
i
7
d
B
I
v
g
x
j
I
j
o
i
4
L
b
l
x
W
s
A
/
o
j
C
W
T
Z
t
r
Q
T
C
Y
k
G
a
E
O
/
Q
0
3
L
h
R
x
6
8
+
4
8
2
/
M
t
L
P
Q
1
g
O
B
w
z
n
3
c
k
9
O
K
D
n
T
x
n
W
/
n
d
L
K
6
t
r
6
R
n
m
z
s
r
W
9
s
7
t
X
3
T
9
o
6
y
R
V
h
L
Z
I
w
h
P
V
D
b
G
m
n
A
n
a
M
s
x
w
2
p
W
K
4
j
j
k
t
B
O
O
b
3
K
/
8
0
i
V
Z
o
m
4
N
x
N
J
g
x
g
P
B
Y
s
Y
w
c
Z
K
v
h
9
j
M
w
q
j
7
G
n
6
c
N
a
v
1
t
y
6
O
w
N
a
J
l
5
B
a
l
C
g
2
a
9
+
+
Y
O
E
p
D
E
V
h
n
C
s
d
c
9
z
p
Q
k
y
r
A
w
j
n
E
4
r
f
q
q
p
x
G
S
M
h
7
R
n
q
c
A
x
1
U
E
2
y
z
x
F
J
1
Y
Z
o
C
h
R
9
g
m
D
Z
u
r
v
j
Q
z
H
W
k
/
i
0
E
7
m
G
f
W
i
l
4
v
/
e
b
3
U
R
N
d
B
x
o
R
M
D
R
V
k
f
i
h
K
O
T
I
J
y
g
t
A
A
6
Y
o
M
X
x
i
C
S
a
K
2
a
y
I
j
L
D
C
x
N
i
a
K
r
Y
E
b
/
H
L
y
6
R
9
X
v
c
s
v
7
u
o
N
S
6
L
O
s
p
w
B
M
d
w
C
h
5
c
Q
Q
N
u
o
Q
k
t
I
C
D
h
G
V
7
h
z
U
m
d
F
+
f
d
+
Z
i
P
l
p
x
i
5
x
D
+
w
P
n
8
A
S
I
/
k
b
E
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
C
P
P
D
v
u
u
F
B
W
S
g
d
e
8
z
y
T
z
o
S
s
I
9
j
z
o
=
"
>
A
A
A
B
8
3
i
c
b
V
D
L
S
g
M
x
F
L
1
T
X
7
W
+
q
i
7
d
B
I
v
g
x
j
I
j
o
i
4
L
b
l
x
W
s
A
/
o
j
C
W
T
Z
t
r
Q
T
C
Y
k
G
a
E
O
/
Q
0
3
L
h
R
x
6
8
+
4
8
2
/
M
t
L
P
Q
1
g
O
B
w
z
n
3
c
k
9
O
K
D
n
T
x
n
W
/
n
d
L
K
6
t
r
6
R
n
m
z
s
r
W
9
s
7
t
X
3
T
9
o
6
y
R
V
h
L
Z
I
w
h
P
V
D
b
G
m
n
A
n
a
M
s
x
w
2
p
W
K
4
j
j
k
t
B
O
O
b
3
K
/
8
0
i
V
Z
o
m
4
N
x
N
J
g
x
g
P
B
Y
s
Y
w
c
Z
K
v
h
9
j
M
w
q
j
7
G
n
6
c
N
a
v
1
t
y
6
O
w
N
a
J
l
5
B
a
l
C
g
2
a
9
+
+
Y
O
E
p
D
E
V
h
n
C
s
d
c
9
z
p
Q
k
y
r
A
w
j
n
E
4
r
f
q
q
p
x
G
S
M
h
7
R
n
q
c
A
x
1
U
E
2
y
z
x
F
J
1
Y
Z
o
C
h
R
9
g
m
D
Z
u
r
v
j
Q
z
H
W
k
/
i
0
E
7
m
G
f
W
i
l
4
v
/
e
b
3
U
R
N
d
B
x
o
R
M
D
R
V
k
f
i
h
K
O
T
I
J
y
g
t
A
A
6
Y
o
M
X
x
i
C
S
a
K
2
a
y
I
j
L
D
C
x
N
i
a
K
r
Y
E
b
/
H
L
y
6
R
9
X
v
c
s
v
7
u
o
N
S
6
L
O
s
p
w
B
M
d
w
C
h
5
c
Q
Q
N
u
o
Q
k
t
I
C
D
h
G
V
7
h
z
U
m
d
F
+
f
d
+
Z
i
P
l
p
x
i
5
x
D
+
w
P
n
8
A
S
I
/
k
b
E
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
C
P
P
D
v
u
u
F
B
W
S
g
d
e
8
z
y
T
z
o
S
s
I
9
j
z
o
=
"
>
A
A
A
B
8
3
i
c
b
V
D
L
S
g
M
x
F
L
1
T
X
7
W
+
q
i
7
d
B
I
v
g
x
j
I
j
o
i
4
L
b
l
x
W
s
A
/
o
j
C
W
T
Z
t
r
Q
T
C
Y
k
G
a
E
O
/
Q
0
3
L
h
R
x
6
8
+
4
8
2
/
M
t
L
P
Q
1
g
O
B
w
z
n
3
c
k
9
O
K
D
n
T
x
n
W
/
n
d
L
K
6
t
r
6
R
n
m
z
s
r
W
9
s
7
t
X
3
T
9
o
6
y
R
V
h
L
Z
I
w
h
P
V
D
b
G
m
n
A
n
a
M
s
x
w
2
p
W
K
4
j
j
k
t
B
O
O
b
3
K
/
8
0
i
V
Z
o
m
4
N
x
N
J
g
x
g
P
B
Y
s
Y
w
c
Z
K
v
h
9
j
M
w
q
j
7
G
n
6
c
N
a
v
1
t
y
6
O
w
N
a
J
l
5
B
a
l
C
g
2
a
9
+
+
Y
O
E
p
D
E
V
h
n
C
s
d
c
9
z
p
Q
k
y
r
A
w
j
n
E
4
r
f
q
q
p
x
G
S
M
h
7
R
n
q
c
A
x
1
U
E
2
y
z
x
F
J
1
Y
Z
o
C
h
R
9
g
m
D
Z
u
r
v
j
Q
z
H
W
k
/
i
0
E
7
m
G
f
W
i
l
4
v
/
e
b
3
U
R
N
d
B
x
o
R
M
D
R
V
k
f
i
h
K
O
T
I
J
y
g
t
A
A
6
Y
o
M
X
x
i
C
S
a
K
2
a
y
I
j
L
D
C
x
N
i
a
K
r
Y
E
b
/
H
L
y
6
R
9
X
v
c
s
v
7
u
o
N
S
6
L
O
s
p
w
B
M
d
w
C
h
5
c
Q
Q
N
u
o
Q
k
t
I
C
D
h
G
V
7
h
z
U
m
d
F
+
f
d
+
Z
i
P
l
p
x
i
5
x
D
+
w
P
n
8
A
S
I
/
k
b
E
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
C
P
P
D
v
u
u
F
B
W
S
g
d
e
8
z
y
T
z
o
S
s
I
9
j
z
o
=
"
>
A
A
A
B
8
3
i
c
b
V
D
L
S
g
M
x
F
L
1
T
X
7
W
+
q
i
7
d
B
I
v
g
x
j
I
j
o
i
4
L
b
l
x
W
s
A
/
o
j
C
W
T
Z
t
r
Q
T
C
Y
k
G
a
E
O
/
Q
0
3
L
h
R
x
6
8
+
4
8
2
/
M
t
L
P
Q
1
g
O
B
w
z
n
3
c
k
9
O
K
D
n
T
x
n
W
/
n
d
L
K
6
t
r
6
R
n
m
z
s
r
W
9
s
7
t
X
3
T
9
o
6
y
R
V
h
L
Z
I
w
h
P
V
D
b
G
m
n
A
n
a
M
s
x
w
2
p
W
K
4
j
j
k
t
B
O
O
b
3
K
/
8
0
i
V
Z
o
m
4
N
x
N
J
g
x
g
P
B
Y
s
Y
w
c
Z
K
v
h
9
j
M
w
q
j
7
G
n
6
c
N
a
v
1
t
y
6
O
w
N
a
J
l
5
B
a
l
C
g
2
a
9
+
+
Y
O
E
p
D
E
V
h
n
C
s
d
c
9
z
p
Q
k
y
r
A
w
j
n
E
4
r
f
q
q
p
x
G
S
M
h
7
R
n
q
c
A
x
1
U
E
2
y
z
x
F
J
1
Y
Z
o
C
h
R
9
g
m
D
Z
u
r
v
j
Q
z
H
W
k
/
i
0
E
7
m
G
f
W
i
l
4
v
/
e
b
3
U
R
N
d
B
x
o
R
M
D
R
V
k
f
i
h
K
O
T
I
J
y
g
t
A
A
6
Y
o
M
X
x
i
C
S
a
K
2
a
y
I
j
L
D
C
x
N
i
a
K
r
Y
E
b
/
H
L
y
6
R
9
X
v
c
s
v
7
u
o
N
S
6
L
O
s
p
w
B
M
d
w
C
h
5
c
Q
Q
N
u
o
Q
k
t
I
C
D
h
G
V
7
h
z
U
m
d
F
+
f
d
+
Z
i
P
l
p
x
i
5
x
D
+
w
P
n
8
A
S
I
/
k
b
E
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
j
k
R
/
4
s
K
p
L
z
Z
5
8
J
k
E
n
7
D
e
v
w
P
o
d
Z
E
=
"
>
A
A
A
B
8
3
i
c
b
V
D
L
S
g
M
x
F
L
1
T
X
7
W
+
q
i
7
d
B
I
s
g
C
G
V
G
R
F
0
W
3
L
i
s
Y
B
/
Q
G
U
s
m
z
b
S
h
m
U
x
I
M
k
I
d
+
h
t
u
X
C
j
i
1
p
9
x
5
9
+
Y
a
W
e
h
r
Q
c
C
h
3
P
u
5
Z
6
c
U
H
K
m
j
e
t
+
O
6
W
V
1
b
X
1
j
f
J
m
Z
W
t
7
Z
3
e
v
u
n
/
Q
1
k
m
q
C
G
2
R
h
C
e
q
G
2
J
N
O
R
O
0
Z
Z
j
h
t
C
s
V
x
X
H
I
a
S
c
c
3
+
R
+
5
5
E
q
z
R
J
x
b
y
a
S
B
j
E
e
C
h
Y
x
g
o
2
V
f
D
/
G
Z
h
R
G
2
d
P
0
4
a
x
f
r
b
l
1
d
w
a
0
T
L
y
C
1
K
B
A
s
1
/
9
8
g
c
J
S
W
M
q
D
O
F
Y
6
5
7
n
S
h
N
k
W
B
l
G
O
J
1
W
/
F
R
T
i
c
k
Y
D
2
n
P
U
o
F
j
q
o
N
s
l
n
m
K
T
q
w
y
Q
F
G
i
7
B
M
G
z
d
T
f
G
x
m
O
t
Z
7
E
o
Z
3
M
M
+
p
F
L
x
f
/
8
3
q
p
i
a
6
D
j
A
m
Z
G
i
r
I
/
F
C
U
c
m
Q
S
l
B
e
A
B
k
x
R
Y
v
j
E
E
k
w
U
s
1
k
R
G
W
G
F
i
b
E
1
V
W
w
J
3
u
K
X
l
0
n
7
v
O
5
Z
f
n
d
R
a
1
w
W
d
Z
T
h
C
I
7
h
F
D
y
4
g
g
b
c
Q
h
N
a
Q
E
D
C
M
7
z
C
m
5
M
6
L
8
6
7
8
z
E
f
L
T
n
F
z
i
H
8
g
f
P
5
A
x
8
3
k
a
8
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
j
k
R
/
4
s
K
p
L
z
Z
5
8
J
k
E
n
7
D
e
v
w
P
o
d
Z
E
=
"
>
A
A
A
B
8
3
i
c
b
V
D
L
S
g
M
x
F
L
1
T
X
7
W
+
q
i
7
d
B
I
s
g
C
G
V
G
R
F
0
W
3
L
i
s
Y
B
/
Q
G
U
s
m
z
b
S
h
m
U
x
I
M
k
I
d
+
h
t
u
X
C
j
i
1
p
9
x
5
9
+
Y
a
W
e
h
r
Q
c
C
h
3
P
u
5
Z
6
c
U
H
K
m
j
e
t
+
O
6
W
V
1
b
X
1
j
f
J
m
Z
W
t
7
Z
3
e
v
u
n
/
Q
1
k
m
q
C
G
2
R
h
C
e
q
G
2
J
N
O
R
O
0
Z
Z
j
h
t
C
s
V
x
X
H
I
a
S
c
c
3
+
R
+
5
5
E
q
z
R
J
x
b
y
a
S
B
j
E
e
C
h
Y
x
g
o
2
V
f
D
/
G
Z
h
R
G
2
d
P
0
4
a
x
f
r
b
l
1
d
w
a
0
T
L
y
C
1
K
B
A
s
1
/
9
8
g
c
J
S
W
M
q
D
O
F
Y
6
5
7
n
S
h
N
k
W
B
l
G
O
J
1
W
/
F
R
T
i
c
k
Y
D
2
n
P
U
o
F
j
q
o
N
s
l
n
m
K
T
q
w
y
Q
F
G
i
7
B
M
G
z
d
T
f
G
x
m
O
t
Z
7
E
o
Z
3
M
M
+
p
F
L
x
f
/
8
3
q
p
i
a
6
D
j
A
m
Z
G
i
r
I
/
F
C
U
c
m
Q
S
l
B
e
A
B
k
x
R
Y
v
j
E
E
k
w
U
s
1
k
R
G
W
G
F
i
b
E
1
V
W
w
J
3
u
K
X
l
0
n
7
v
O
5
Z
f
n
d
R
a
1
w
W
d
Z
T
h
C
I
7
h
F
D
y
4
g
g
b
c
Q
h
N
a
Q
E
D
C
M
7
z
C
m
5
M
6
L
8
6
7
8
z
E
f
L
T
n
F
z
i
H
8
g
f
P
5
A
x
8
3
k
a
8
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
j
k
R
/
4
s
K
p
L
z
Z
5
8
J
k
E
n
7
D
e
v
w
P
o
d
Z
E
=
"
>
A
A
A
B
8
3
i
c
b
V
D
L
S
g
M
x
F
L
1
T
X
7
W
+
q
i
7
d
B
I
s
g
C
G
V
G
R
F
0
W
3
L
i
s
Y
B
/
Q
G
U
s
m
z
b
S
h
m
U
x
I
M
k
I
d
+
h
t
u
X
C
j
i
1
p
9
x
5
9
+
Y
a
W
e
h
r
Q
c
C
h
3
P
u
5
Z
6
c
U
H
K
m
j
e
t
+
O
6
W
V
1
b
X
1
j
f
J
m
Z
W
t
7
Z
3
e
v
u
n
/
Q
1
k
m
q
C
G
2
R
h
C
e
q
G
2
J
N
O
R
O
0
Z
Z
j
h
t
C
s
V
x
X
H
I
a
S
c
c
3
+
R
+
5
5
E
q
z
R
J
x
b
y
a
S
B
j
E
e
C
h
Y
x
g
o
2
V
f
D
/
G
Z
h
R
G
2
d
P
0
4
a
x
f
r
b
l
1
d
w
a
0
T
L
y
C
1
K
B
A
s
1
/
9
8
g
c
J
S
W
M
q
D
O
F
Y
6
5
7
n
S
h
N
k
W
B
l
G
O
J
1
W
/
F
R
T
i
c
k
Y
D
2
n
P
U
o
F
j
q
o
N
s
l
n
m
K
T
q
w
y
Q
F
G
i
7
B
M
G
z
d
T
f
G
x
m
O
t
Z
7
E
o
Z
3
M
M
+
p
F
L
x
f
/
8
3
q
p
i
a
6
D
j
A
m
Z
G
i
r
I
/
F
C
U
c
m
Q
S
l
B
e
A
B
k
x
R
Y
v
j
E
E
k
w
U
s
1
k
R
G
W
G
F
i
b
E
1
V
W
w
J
3
u
K
X
l
0
n
7
v
O
5
Z
f
n
d
R
a
1
w
W
d
Z
T
h
C
I
7
h
F
D
y
4
g
g
b
c
Q
h
N
a
Q
E
D
C
M
7
z
C
m
5
M
6
L
8
6
7
8
z
E
f
L
T
n
F
z
i
H
8
g
f
P
5
A
x
8
3
k
a
8
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
j
k
R
/
4
s
K
p
L
z
Z
5
8
J
k
E
n
7
D
e
v
w
P
o
d
Z
E
=
"
>
A
A
A
B
8
3
i
c
b
V
D
L
S
g
M
x
F
L
1
T
X
7
W
+
q
i
7
d
B
I
s
g
C
G
V
G
R
F
0
W
3
L
i
s
Y
B
/
Q
G
U
s
m
z
b
S
h
m
U
x
I
M
k
I
d
+
h
t
u
X
C
j
i
1
p
9
x
5
9
+
Y
a
W
e
h
r
Q
c
C
h
3
P
u
5
Z
6
c
U
H
K
m
j
e
t
+
O
6
W
V
1
b
X
1
j
f
J
m
Z
W
t
7
Z
3
e
v
u
n
/
Q
1
k
m
q
C
G
2
R
h
C
e
q
G
2
J
N
O
R
O
0
Z
Z
j
h
t
C
s
V
x
X
H
I
a
S
c
c
3
+
R
+
5
5
E
q
z
R
J
x
b
y
a
S
B
j
E
e
C
h
Y
x
g
o
2
V
f
D
/
G
Z
h
R
G
2
d
P
0
4
a
x
f
r
b
l
1
d
w
a
0
T
L
y
C
1
K
B
A
s
1
/
9
8
g
c
J
S
W
M
q
D
O
F
Y
6
5
7
n
S
h
N
k
W
B
l
G
O
J
1
W
/
F
R
T
i
c
k
Y
D
2
n
P
U
o
F
j
q
o
N
s
l
n
m
K
T
q
w
y
Q
F
G
i
7
B
M
G
z
d
T
f
G
x
m
O
t
Z
7
E
o
Z
3
M
M
+
p
F
L
x
f
/
8
3
q
p
i
a
6
D
j
A
m
Z
G
i
r
I
/
F
C
U
c
m
Q
S
l
B
e
A
B
k
x
R
Y
v
j
E
E
k
w
U
s
1
k
R
G
W
G
F
i
b
E
1
V
W
w
J
3
u
K
X
l
0
n
7
v
O
5
Z
f
n
d
R
a
1
w
W
d
Z
T
h
C
I
7
h
F
D
y
4
g
g
b
c
Q
h
N
a
Q
E
D
C
M
7
z
C
m
5
M
6
L
8
6
7
8
z
E
f
L
T
n
F
z
i
H
8
g
f
P
5
A
x
8
3
k
a
8
=
<
/
l
a
t
e
x
i
t
>
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
s
M
y
w
w
F
v
w
d
B
J
a
D
Q
f
3
5
9
/
w
K
z
W
3
M
/
Q
=
"
>
A
A
A
B
8
X
i
c
b
V
B
N
S
8
N
A
F
H
y
p
X
7
V
+
V
T
1
6
W
S
y
C
p
5
K
I
q
M
e
C
F
4
8
V
b
C
u
2
o
W
y
2
L
+
3
S
z
S
b
s
b
o
Q
a
+
i
+
8
e
F
D
E
q
/
/
G
m
/
/
G
T
Z
u
D
t
g
4
s
D
D
P
v
s
f
M
m
S
A
T
X
x
n
W
/
n
d
L
K
6
t
r
6
R
n
m
z
s
r
W
9
s
7
t
X
3
T
9
o
6
z
h
V
D
F
s
s
F
r
G
6
D
6
h
G
w
S
W
2
D
D
c
C
7
x
O
F
N
A
o
E
d
o
L
x
d
e
5
3
H
l
F
p
H
s
s
7
M
0
n
Q
j
+
h
Q
8
p
A
z
a
q
z
0
0
I
u
o
G
Q
V
h
9
j
T
t
V
2
t
u
3
Z
2
B
L
B
O
v
I
D
U
o
0
O
x
X
v
3
q
D
m
K
U
R
S
s
M
E
1
b
r
r
u
Y
n
x
M
6
o
M
Z
w
K
n
l
V
6
q
M
a
F
s
T
I
f
Y
t
V
T
S
C
L
W
f
z
R
J
P
y
Y
l
V
B
i
S
M
l
X
3
S
k
J
n
6
e
y
O
j
k
d
a
T
K
L
C
T
e
U
K
9
6
O
X
i
f
1
4
3
N
e
G
V
n
3
G
Z
p
A
Y
l
m
3
8
U
p
o
K
Y
m
O
T
n
k
w
F
X
y
I
y
Y
W
E
K
Z
4
j
Y
r
Y
S
O
q
K
D
O
2
p
I
o
t
w
V
s
8
e
Z
m
0
z
+
q
e
5
b
f
n
t
c
Z
F
U
U
c
Z
j
u
A
Y
T
s
G
D
S
2
j
A
D
T
S
h
B
Q
w
k
P
M
M
r
v
D
n
a
e
X
H
e
n
Y
/
5
a
M
k
p
d
g
7
h
D
5
z
P
H
/
y
p
k
R
I
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
s
M
y
w
w
F
v
w
d
B
J
a
D
Q
f
3
5
9
/
w
K
z
W
3
M
/
Q
=
"
>
A
A
A
B
8
X
i
c
b
V
B
N
S
8
N
A
F
H
y
p
X
7
V
+
V
T
1
6
W
S
y
C
p
5
K
I
q
M
e
C
F
4
8
V
b
C
u
2
o
W
y
2
L
+
3
S
z
S
b
s
b
o
Q
a
+
i
+
8
e
F
D
E
q
/
/
G
m
/
/
G
T
Z
u
D
t
g
4
s
D
D
P
v
s
f
M
m
S
A
T
X
x
n
W
/
n
d
L
K
6
t
r
6
R
n
m
z
s
r
W
9
s
7
t
X
3
T
9
o
6
z
h
V
D
F
s
s
F
r
G
6
D
6
h
G
w
S
W
2
D
D
c
C
7
x
O
F
N
A
o
E
d
o
L
x
d
e
5
3
H
l
F
p
H
s
s
7
M
0
n
Q
j
+
h
Q
8
p
A
z
a
q
z
0
0
I
u
o
G
Q
V
h
9
j
T
t
V
2
t
u
3
Z
2
B
L
B
O
v
I
D
U
o
0
O
x
X
v
3
q
D
m
K
U
R
S
s
M
E
1
b
r
r
u
Y
n
x
M
6
o
M
Z
w
K
n
l
V
6
q
M
a
F
s
T
I
f
Y
t
V
T
S
C
L
W
f
z
R
J
P
y
Y
l
V
B
i
S
M
l
X
3
S
k
J
n
6
e
y
O
j
k
d
a
T
K
L
C
T
e
U
K
9
6
O
X
i
f
1
4
3
N
e
G
V
n
3
G
Z
p
A
Y
l
m
3
8
U
p
o
K
Y
m
O
T
n
k
w
F
X
y
I
y
Y
W
E
K
Z
4
j
Y
r
Y
S
O
q
K
D
O
2
p
I
o
t
w
V
s
8
e
Z
m
0
z
+
q
e
5
b
f
n
t
c
Z
F
U
U
c
Z
j
u
A
Y
T
s
G
D
S
2
j
A
D
T
S
h
B
Q
w
k
P
M
M
r
v
D
n
a
e
X
H
e
n
Y
/
5
a
M
k
p
d
g
7
h
D
5
z
P
H
/
y
p
k
R
I
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
s
M
y
w
w
F
v
w
d
B
J
a
D
Q
f
3
5
9
/
w
K
z
W
3
M
/
Q
=
"
>
A
A
A
B
8
X
i
c
b
V
B
N
S
8
N
A
F
H
y
p
X
7
V
+
V
T
1
6
W
S
y
C
p
5
K
I
q
M
e
C
F
4
8
V
b
C
u
2
o
W
y
2
L
+
3
S
z
S
b
s
b
o
Q
a
+
i
+
8
e
F
D
E
q
/
/
G
m
/
/
G
T
Z
u
D
t
g
4
s
D
D
P
v
s
f
M
m
S
A
T
X
x
n
W
/
n
d
L
K
6
t
r
6
R
n
m
z
s
r
W
9
s
7
t
X
3
T
9
o
6
z
h
V
D
F
s
s
F
r
G
6
D
6
h
G
w
S
W
2
D
D
c
C
7
x
O
F
N
A
o
E
d
o
L
x
d
e
5
3
H
l
F
p
H
s
s
7
M
0
n
Q
j
+
h
Q
8
p
A
z
a
q
z
0
0
I
u
o
G
Q
V
h
9
j
T
t
V
2
t
u
3
Z
2
B
L
B
O
v
I
D
U
o
0
O
x
X
v
3
q
D
m
K
U
R
S
s
M
E
1
b
r
r
u
Y
n
x
M
6
o
M
Z
w
K
n
l
V
6
q
M
a
F
s
T
I
f
Y
t
V
T
S
C
L
W
f
z
R
J
P
y
Y
l
V
B
i
S
M
l
X
3
S
k
J
n
6
e
y
O
j
k
d
a
T
K
L
C
T
e
U
K
9
6
O
X
i
f
1
4
3
N
e
G
V
n
3
G
Z
p
A
Y
l
m
3
8
U
p
o
K
Y
m
O
T
n
k
w
F
X
y
I
y
Y
W
E
K
Z
4
j
Y
r
Y
S
O
q
K
D
O
2
p
I
o
t
w
V
s
8
e
Z
m
0
z
+
q
e
5
b
f
n
t
c
Z
F
U
U
c
Z
j
u
A
Y
T
s
G
D
S
2
j
A
D
T
S
h
B
Q
w
k
P
M
M
r
v
D
n
a
e
X
H
e
n
Y
/
5
a
M
k
p
d
g
7
h
D
5
z
P
H
/
y
p
k
R
I
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
s
M
y
w
w
F
v
w
d
B
J
a
D
Q
f
3
5
9
/
w
K
z
W
3
M
/
Q
=
"
>
A
A
A
B
8
X
i
c
b
V
B
N
S
8
N
A
F
H
y
p
X
7
V
+
V
T
1
6
W
S
y
C
p
5
K
I
q
M
e
C
F
4
8
V
b
C
u
2
o
W
y
2
L
+
3
S
z
S
b
s
b
o
Q
a
+
i
+
8
e
F
D
E
q
/
/
G
m
/
/
G
T
Z
u
D
t
g
4
s
D
D
P
v
s
f
M
m
S
A
T
X
x
n
W
/
n
d
L
K
6
t
r
6
R
n
m
z
s
r
W
9
s
7
t
X
3
T
9
o
6
z
h
V
D
F
s
s
F
r
G
6
D
6
h
G
w
S
W
2
D
D
c
C
7
x
O
F
N
A
o
E
d
o
L
x
d
e
5
3
H
l
F
p
H
s
s
7
M
0
n
Q
j
+
h
Q
8
p
A
z
a
q
z
0
0
I
u
o
G
Q
V
h
9
j
T
t
V
2
t
u
3
Z
2
B
L
B
O
v
I
D
U
o
0
O
x
X
v
3
q
D
m
K
U
R
S
s
M
E
1
b
r
r
u
Y
n
x
M
6
o
M
Z
w
K
n
l
V
6
q
M
a
F
s
T
I
f
Y
t
V
T
S
C
L
W
f
z
R
J
P
y
Y
l
V
B
i
S
M
l
X
3
S
k
J
n
6
e
y
O
j
k
d
a
T
K
L
C
T
e
U
K
9
6
O
X
i
f
1
4
3
N
e
G
V
n
3
G
Z
p
A
Y
l
m
3
8
U
p
o
K
Y
m
O
T
n
k
w
F
X
y
I
y
Y
W
E
K
Z
4
j
Y
r
Y
S
O
q
K
D
O
2
p
I
o
t
w
V
s
8
e
Z
m
0
z
+
q
e
5
b
f
n
t
c
Z
F
U
U
c
Z
j
u
A
Y
T
s
G
D
S
2
j
A
D
T
S
h
B
Q
w
k
P
M
M
r
v
D
n
a
e
X
H
e
n
Y
/
5
a
M
k
p
d
g
7
h
D
5
z
P
H
/
y
p
k
R
I
=
<
/
l
a
t
e
x
i
t
>
nent. A primary issue concerning the sampling strategy is
the lack of informative samples for training. A large frac-
tion of samples may satisfy the constraints imposed by the
loss function and provide no supervision information for the
training model. This motivates many deep metric learning
methods to develop efﬁcient hard negative mining strate-
gies [25, 13, 46, 10] for sampling. These strategies typically
under-sample the training set for hard informative samples
which produce gradients with large magnitude. However,
the hard negative mining strategy only selects among a sub-
set of samples, which may not be enough to characterize
the global geometry of the embedding space accurately. In
other words, some data points are sampled repeatedly while
others may never have the possibility to be sampled, re-
sulting in an embedding space over-ﬁtting near the over-
sampled data points and at the same time under-ﬁtting near
the under-sampled data points.

In this paper, we propose a hardness-aware deep metric
learning (HDML) framework as a solution. We sample all
data points in the training set uniformly while making the
best of the information contained in each point. Instead of
only using the original samples for training, we propose to
synthesize hardness-aware samples as complements to the
original ones.
In addition, we control the hard levels of
the synthetic samples according to the training status of the
model, so that the better-trained model is challenged with
harder synthetics. We employ an adaptive linear interpo-
lation method to effectively manipulate the hard levels of
the embeddings. Having obtained the augmented embed-
dings, we utilize a simultaneously trained generator to map
them back to the feature space while preserving the label
and augmented hardness. These synthetics contain more
information than original ones and can be used as com-
plements for recycled training, as shown in Figure 1. We
provide an ablation study to demonstrate the effectiveness
of each module of HDML. Extensive experiments on the
widely-used CUB-200-2011 [36], Cars196 [16], and Stan-
ford Online Products [30] datasets illustrate that our pro-
posed HDML framework can improve the performance of
existing deep metric learning models in both image cluster-
ing and retrieval tasks.

2. Related Work

Metric Learning: Conventional metric learning meth-
ods usually employ the Mahalanobis distance [8, 4, 41] or
kernel-based metric [6] to characterize the linear and non-
linear intrinsic correlations among data points. Contrastive
loss [9, 12] and triplet loss [38, 25, 3] are two conventional
measures which are widely used in most existing metric
learning methods. The contrastive loss is designed to sepa-
rate samples of different classes with a ﬁxed margin and pull
closer samples of the same category as near as possible. The
triplet loss is more ﬂexible since it only requires a certain

ranking within triplets. Furthermore, there are also some
works to explore the structure of quadruplets [18, 13, 2].

The losses used in recently proposed deep metric learn-
ing methods [30, 28, 32, 29, 39, 44] take into considera-
tion of higher order relationships or global information and
therefore achieve better performance. For example, Song et
al. [30] proposed a lifted structured loss function to consider
all the positive and negative pairs within a batch. Wang et
al. [39] improved the conventional triplet loss by exploit-
ing a third-order geometry relationship. These meticulously
designed losses showed great power in various tasks, yet
a more advanced sampling framework [42, 22, 7, 20] can
still boost their performance. For example, Wu et al. [42]
presented a distance-weighted sampling method to select
samples based on their relative distances. Another trend
is to incorporate ensemble technique in deep metric learn-
ing [23, 15, 43], which integrates several diverse embed-
dings to constitute a more informative representation.

Hard Negative Mining: Hard negative mining has been
employed in many machine learning tasks to enhance the
training efﬁciency and boost performance, like supervised
learning [25, 13, 46, 10, 45], exemplar based learning [21]
and unsupervised learning [40, 1]. This strategy aims at pro-
gressively selecting false positive samples that will beneﬁt
training the most. It is widely used in deep metric learning
methods because of the vast number of tuples that can be
formed for training. For example, Schroff et al. [25] pro-
posed to sample semi-hard triplets within a batch, which
avoids using too confusing triplets that may result from
noisy data. Harwood et al. [10] presented a smart min-
ing procedure utilizing approximate nearest neighbor search
methods to adaptively select more challenging samples for
training. The advantage of [46] and [10] lies in the selection
of samples with suitably hard level with the model. How-
ever, they can not control the hard level accurately and do
not exploit the information contained in the easy samples.

Recently proposed methods [5, 47] begin to consider
generating potential hard samples to fully train the model.
However, there are several drawbacks of the current meth-
ods. Firstly, the hard levels of the generated samples cannot
be controlled. Secondly, they all require an adversarial man-
ner to train the generator, rendering the model hard to be
learned end-to-end and the training process very unstable.
Differently, the proposed HDML framework can generate
synthetic hardness-aware label-preserving samples with ad-
equate information and adaptive hard levels, further boost-
ing the performance of current deep metric learning models.

3. Proposed Approach

In this section, we ﬁrst formulate the problem of deep
metric learning and then present the basic idea of the pro-
posed HDML framework. At last, we elaborate on the ap-
proach of deep metric learning under this framework.

73

(cid:55)(cid:85)(cid:68)(cid:76)(cid:81)(cid:76)(cid:81)(cid:74)

Metric

Metric

larity relations. The network parameters are learned by min-
imizing a speciﬁc loss function:

(cid:38)(cid:82)(cid:81)(cid:87)(cid:85)(cid:82)(cid:79)

(cid:38)(cid:82)(cid:81)(cid:87)(cid:85)(cid:82)(cid:79)

N

eN<
>eN<

(cid:43)(cid:68)(cid:85)(cid:71)(cid:72)(cid:85)

N

A

eN<
>eN<

P

A

P

Figure 2. Illustration of the proposed hardness-aware augmenta-
tion. Points with the same shape are from the same class. We
performs linear interpolation on the negative pair in the embedding
space to obtain a harder tuple, where the hard level is controlled by
the training status of the model. As the training proceeds, harder
and harder tuples are generated to train the metric more efﬁciently.
(Best viewed in color.)

3.1. Problem Formulation

Let XXX denote the data space where we sample a set of
data points X = [x1, x2, · · · , xN ]. Each point xi has a
label li ∈ {1, · · · , C} which constitutes the label set L =
f
[l1, l2, · · · , lN ]. Let f : XXX
−→ YYY be a mapping from the data
space to a feature space, where the extracted feature yi has
semantic characteristics of its corresponding data point xi.
The objective of metric learning is to learn a distance metric
in the feature space so that it can reﬂect the actual semantic
distance. The distance metric can be deﬁned as:

D(xi, xj) = m(θm; yi, yj) = m(θm; f (xi), f (xj)),

(1)

where m is a consistently positive symmetric function and
θm is the corresponding parameters.

Deep learning methods usually extract features using a
deep neural network. A standard procedure is to ﬁrst project
the features into an embedding space (or metric space) ZZZ
g
with a mapping g : YYY
−→ ZZZ, where the distance metric is
then a simple Euclidean distance. Since the projection can
be incorporated into the deep network, we can directly learn
a mapping h = g ◦ f : XXX h−→ ZZZ from the data space to the
embedding space, so that the whole model can be trained
end-to-end without explicit feature extraction. In this case,
the distance metric is deﬁned as:

D(xi, xj) = d(zi, zj) = d(θh; h(xi), h(xj)),

(2)

where d indicates the Euclidean distance d(zi, zj) = ||zi −
zj||2, z = g(y) = h(x) is the learned embedding, θf , θg
and θh are the parameters of mappings f , g and h respec-
tively, and θh = {θf , θg}.

Metric learning models are usually trained based on tu-
ples {Ti} composed of several samples with certain simi-

h = arg min
θ∗

θh

J(θh; {Ti}).

(3)

For example, the triplet loss [25] samples triplets con-
sisting of three examples, the anchor x, the positive x+ with
the same label with the anchor, and the negative x− with a
different label. The triplet loss forces the distance between
the anchor and the negative to be larger than the distance
between the anchor and the positive by a ﬁxed margin.

Furthermore, the N-pair Loss [28] samples tuples with
N positive pairs of distinctive classes, and attempts to push
away N − 1 negatives altogether.

3.2. Hardness Aware Augmentation

There may exist a great many tuples that can be used
during training, yet the vast majority of them actually lack
direct information and produce gradients that are approxi-
mately zero. To only select among the informative ones we
limit ourselves to a small set of tuples. However, this small
set may not be able to accurately characterize the global ge-
ometry of the embedding space, leading to a biased model.
To address the above limitations, we propose an adaptive
hardness-aware augmentation method, as shown in Figure
2. We modify and construct the hardness-aware tuples in
the embedding space, where manipulation of the distances
among samples will directly alter the hard level of the tu-
ple. A reduction in the distance between negative pairs will
create a rise of the hard level and vice versa.

Given a set we can usually form more negative pairs than
positive pairs, so for simplicity, we only manipulate the dis-
tances of negative pairs. For other samples in the tuple, we
perform no transformation, i.e., ˆz = z. Still, our model can
be easily extended to deal with positive pairs. Having ob-
tained the embeddings of a negative pair (an anchor z and
a negative z−), we construct an augmented harder negative

sampleez− by linear interpolation:

ˆz− = z + λ0(z− − z), λ0 ∈ [0, 1].

(4)

However, an example too close to the anchor is very likely
to share the label, thus no longer constitutes a negative pair.
d(z,z−) , 1],
Therefore, it is more reasonable to set λ0 ∈ (
where d+ is a reference distance that we use to determine
the scale of manipulation (e.g., the distance between a pos-
itive pair or a ﬁxed value), and d(z, z−) = ||z− − z||2. To
achieve this, we introduce a variable λ ∈ (0, 1] and set

d+

λ0 =( λ + (1 − λ)

1

d+

d(z,z−)

, if d(z, z−) > d+
, if d(z, z−) ≤ d+.

(5)

On condition that d(z, z−) > d+, the augmented negative

74

l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
o
K
T
V
Q
s
t
e
s
u
Y
7
8
s
M
D
r
e
U
y
r
W
m
L
/
W
8
=
"
>
A
A
A
B
9
H
i
c
b
Z
D
J
S
g
N
B
E
I
Z
r
X
G
P
c
o
h
6
9
N
A
b
B
U
5
j
x
o
j
c
D
e
v
A
k
E
c
w
C
y
R
B
6
e
m
q
S
J
j
2
L
3
T
2
R
M
O
Q
5
J
O
A
h
I
l
5
9
D
6
/
e
f
B
s
7
y
0
E
T
f
2
j
4
+
K
u
K
q
v
6
9
R
H
C
l
b
f
v
b
W
l
l
d
W
9
/
Y
z
G
3
l
t
3
d
2
9
/
Y
L
B
4
c
1
F
a
e
S
Y
Z
X
F
I
p
Y
N
j
y
o
U
P
M
K
q
5
l
p
g
I
5
F
I
Q
0
9
g
3
e
t
d
T
+
r
1
P
k
r
F
4
+
h
B
D
x
J
0
Q
9
q
J
e
M
A
Z
1
c
Z
y
W
0
/
c
R
8
2
F
j
9
n
d
s
F
0
o
2
i
V
7
K
r
I
M
z
h
y
K
V
5
+
j
0
R
g
A
K
u
3
C
V
8
u
P
W
R
p
i
p
J
m
g
S
j
U
d
O
9
F
u
R
q
X
m
T
O
A
w
3
0
o
V
J
p
T
1
a
A
e
b
B
i
M
a
o
n
K
z
6
d
F
D
c
m
o
c
n
w
S
x
N
C
/
S
Z
O
r
+
n
s
h
o
q
N
Q
g
9
E
x
n
S
H
V
X
L
d
Y
m
5
n
+
1
Z
q
q
D
S
z
f
j
U
Z
J
q
j
N
h
s
U
Z
A
K
o
m
M
y
S
Y
D
4
X
C
L
T
Y
m
C
A
M
s
n
N
r
Y
R
1
q
a
R
M
m
5
z
y
J
g
R
n
8
c
v
L
U
D
s
v
O
Y
b
v
n
W
L
5
B
m
b
K
w
T
G
c
w
B
k
4
c
A
F
l
u
I
U
K
V
I
H
B
I
z
z
D
G
F
6
t
v
v
V
i
v
V
n
v
s
9
Y
V
a
z
5
z
B
H
9
k
f
f
w
A
B
w
W
V
M
g
=
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
X
L
j
K
j
c
Y
h
D
Z
u
u
K
8
g
F
s
w
K
u
T
U
7
K
p
o
I
=
"
>
A
A
A
B
9
H
i
c
b
Z
A
9
S
w
N
B
E
I
b
n
4
l
e
M
X
1
F
L
m
8
U
g
W
I
U
7
G
y
0
D
W
l
h
J
B
P
M
B
y
R
H
2
9
i
b
J
k
r
2
9
c
3
c
v
E
o
7
8
D
h
s
L
R
W
z
9
M
X
b
+
G
z
f
J
F
Z
r
4
w
s
L
D
O
z
P
M
7
B
s
k
g
m
v
j
u
t
9
O
Y
W
1
9
Y
3
O
r
u
F
3
a
2
d
3
b
P
y
g
f
H
j
V
1
n
C
q
G
D
R
a
L
W
L
U
D
q
l
F
w
i
Q
3
D
j
c
B
2
o
p
B
G
g
c
B
W
M
L
q
e
1
V
t
j
V
J
r
H
8
s
F
M
E
v
Q
j
O
p
C
8
z
x
k
1
1
v
K
7
T
z
x
E
w
0
W
I
2
d
2
0
V
6
6
4
V
X
c
u
s
g
p
e
D
h
X
I
V
e
+
V
v
7
p
h
z
N
I
I
p
W
G
C
a
t
3
x
3
M
T
4
G
V
W
G
M
4
H
T
U
j
f
V
m
F
A
2
o
g
P
s
W
J
Q
0
Q
u
1
n
8
6
O
n
5
M
w
6
I
e
n
H
y
j
5
p
y
N
z
9
P
Z
H
R
S
O
t
J
F
N
j
O
i
J
q
h
X
q
7
N
z
P
9
q
n
d
T
0
r
/
y
M
y
y
Q
1
K
N
l
i
U
T
8
V
x
M
R
k
l
g
A
J
u
U
J
m
x
M
Q
C
Z
Y
r
b
W
w
k
b
U
k
W
Z
s
T
m
V
b
A
j
e
8
p
d
X
o
X
l
R
9
S
z
f
e
5
X
a
T
R
5
H
E
U
7
g
F
M
7
B
g
0
u
o
w
S
3
U
o
Q
E
M
H
u
E
Z
X
u
H
N
G
T
s
v
z
r
v
z
s
W
g
t
O
P
n
M
M
f
y
R
8
/
k
D
L
L
e
S
W
A
=
=
<
/
l
a
t
e
x
i
t
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
o
K
T
V
Q
s
t
e
s
u
Y
7
8
s
M
D
r
e
U
y
r
W
m
L
/
W
8
=
"
>
A
A
A
B
9
H
i
c
b
Z
D
J
S
g
N
B
E
I
Z
r
X
G
P
c
o
h
6
9
N
A
b
B
U
5
j
x
o
j
c
D
e
v
A
k
E
c
w
C
y
R
B
6
e
m
q
S
J
j
2
L
3
T
2
R
M
O
Q
5
J
O
A
h
I
l
5
9
D
6
/
e
f
B
s
7
y
0
E
T
f
2
j
4
+
K
u
K
q
v
6
9
R
H
C
l
b
f
v
b
W
l
l
d
W
9
/
Y
z
G
3
l
t
3
d
2
9
/
Y
L
B
4
c
1
F
a
e
S
Y
Z
X
F
I
p
Y
N
j
y
o
U
P
M
K
q
5
l
p
g
I
5
F
I
Q
0
9
g
3
e
t
d
T
+
r
1
P
k
r
F
4
+
h
B
D
x
J
0
Q
9
q
J
e
M
A
Z
1
c
Z
y
W
0
/
c
R
8
2
F
j
9
n
d
s
F
0
o
2
i
V
7
K
r
I
M
z
h
y
K
V
5
+
j
0
R
g
A
K
u
3
C
V
8
u
P
W
R
p
i
p
J
m
g
S
j
U
d
O
9
F
u
R
q
X
m
T
O
A
w
3
0
o
V
J
p
T
1
a
A
e
b
B
i
M
a
o
n
K
z
6
d
F
D
c
m
o
c
n
w
S
x
N
C
/
S
Z
O
r
+
n
s
h
o
q
N
Q
g
9
E
x
n
S
H
V
X
L
d
Y
m
5
n
+
1
Z
q
q
D
S
z
f
j
U
Z
J
q
j
N
h
s
U
Z
A
K
o
m
M
y
S
Y
D
4
X
C
L
T
Y
m
C
A
M
s
n
N
r
Y
R
1
q
a
R
M
m
5
z
y
J
g
R
n
8
c
v
L
U
D
s
v
O
Y
b
v
n
W
L
5
B
m
b
K
w
T
G
c
w
B
k
4
c
A
F
l
u
I
U
K
V
I
H
B
I
z
z
D
G
F
6
t
v
v
V
i
v
V
n
v
s
9
Y
V
a
z
5
z
B
H
9
k
f
f
w
A
B
w
W
V
M
g
=
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
X
L
j
K
j
c
Y
h
D
Z
u
u
K
8
g
F
s
w
K
u
T
U
7
K
p
o
I
=
"
>
A
A
A
B
9
H
i
c
b
Z
A
9
S
w
N
B
E
I
b
n
4
l
e
M
X
1
F
L
m
8
U
g
W
I
U
7
G
y
0
D
W
l
h
J
B
P
M
B
y
R
H
2
9
i
b
J
k
r
2
9
c
3
c
v
E
o
7
8
D
h
s
L
R
W
z
9
M
X
b
+
G
z
f
J
F
Z
r
4
w
s
L
D
O
z
P
M
7
B
s
k
g
m
v
j
u
t
9
O
Y
W
1
9
Y
3
O
r
u
F
3
a
2
d
3
b
P
y
g
f
H
j
V
1
n
C
q
G
D
R
a
L
W
L
U
D
q
l
F
w
i
Q
3
D
j
c
B
2
o
p
B
G
g
c
B
W
M
L
q
e
1
V
t
j
V
J
r
H
8
s
F
M
E
v
Q
j
O
p
C
8
z
x
k
1
1
v
K
7
T
z
x
E
w
0
W
I
2
d
2
0
V
6
6
4
V
X
c
u
s
g
p
e
D
h
X
I
V
e
+
V
v
7
p
h
z
N
I
I
p
W
G
C
a
t
3
x
3
M
T
4
G
V
W
G
M
4
H
T
U
j
f
V
m
F
A
2
o
g
P
s
W
J
Q
0
Q
u
1
n
8
6
O
n
5
M
w
6
I
e
n
H
y
j
5
p
y
N
z
9
P
Z
H
R
S
O
t
J
F
N
j
O
i
J
q
h
X
q
7
N
z
P
9
q
n
d
T
0
r
/
y
M
y
y
Q
1
K
N
l
i
U
T
8
V
x
M
R
k
l
g
A
J
u
U
J
m
x
M
Q
C
Z
Y
r
b
W
w
k
b
U
k
W
Z
s
T
m
V
b
A
j
e
8
p
d
X
o
X
l
R
9
S
z
f
e
5
X
a
T
R
5
H
E
U
7
g
F
M
7
B
g
0
u
o
w
S
3
U
o
Q
E
M
H
u
E
Z
X
u
H
N
G
T
s
v
z
r
v
z
s
W
g
t
O
P
n
M
M
f
y
R
8
/
k
D
L
L
e
S
W
A
=
=
<
/
l
a
t
e
x
i
t
>
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
o
K
T
V
Q
s
t
e
s
u
Y
7
8
s
M
D
r
e
U
y
r
W
m
L
/
W
8
=
"
>
A
A
A
B
9
H
i
c
b
Z
D
J
S
g
N
B
E
I
Z
r
X
G
P
c
o
h
6
9
N
A
b
B
U
5
j
x
o
j
c
D
e
v
A
k
E
c
w
C
y
R
B
6
e
m
q
S
J
j
2
L
3
T
2
R
M
O
Q
5
J
O
A
h
I
l
5
9
D
6
/
e
f
B
s
7
y
0
E
T
f
2
j
4
+
K
u
K
q
v
6
9
R
H
C
l
b
f
v
b
W
l
l
d
W
9
/
Y
z
G
3
l
t
3
d
2
9
/
Y
L
B
4
c
1
F
a
e
S
Y
Z
X
F
I
p
Y
N
j
y
o
U
P
M
K
q
5
l
p
g
I
5
F
I
Q
0
9
g
3
e
t
d
T
+
r
1
P
k
r
F
4
+
h
B
D
x
J
0
Q
9
q
J
e
M
A
Z
1
c
Z
y
W
0
/
c
R
8
2
F
j
9
n
d
s
F
0
o
2
i
V
7
K
r
I
M
z
h
y
K
V
5
+
j
0
R
g
A
K
u
3
C
V
8
u
P
W
R
p
i
p
J
m
g
S
j
U
d
O
9
F
u
R
q
X
m
T
O
A
w
3
0
o
V
J
p
T
1
a
A
e
b
B
i
M
a
o
n
K
z
6
d
F
D
c
m
o
c
n
w
S
x
N
C
/
S
Z
O
r
+
n
s
h
o
q
N
Q
g
9
E
x
n
S
H
V
X
L
d
Y
m
5
n
+
1
Z
q
q
D
S
z
f
j
U
Z
J
q
j
N
h
s
U
Z
A
K
o
m
M
y
S
Y
D
4
X
C
L
T
Y
m
C
A
M
s
n
N
r
Y
R
1
q
a
R
M
m
5
z
y
J
g
R
n
8
c
v
L
U
D
s
v
O
Y
b
v
n
W
L
5
B
m
b
K
w
T
G
c
w
B
k
4
c
A
F
l
u
I
U
K
V
I
H
B
I
z
z
D
G
F
6
t
v
v
V
i
v
V
n
v
s
9
Y
V
a
z
5
z
B
H
9
k
f
f
w
A
B
w
W
V
M
g
=
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
X
L
j
K
j
c
Y
h
D
Z
u
u
K
8
g
F
s
w
K
u
T
U
7
K
p
o
I
=
"
>
A
A
A
B
9
H
i
c
b
Z
A
9
S
w
N
B
E
I
b
n
4
l
e
M
X
1
F
L
m
8
U
g
W
I
U
7
G
y
0
D
W
l
h
J
B
P
M
B
y
R
H
2
9
i
b
J
k
r
2
9
c
3
c
v
E
o
7
8
D
h
s
L
R
W
z
9
M
X
b
+
G
z
f
J
F
Z
r
4
w
s
L
D
O
z
P
M
7
B
s
k
g
m
v
j
u
t
9
O
Y
W
1
9
Y
3
O
r
u
F
3
a
2
d
3
b
P
y
g
f
H
j
V
1
n
C
q
G
D
R
a
L
W
L
U
D
q
l
F
w
i
Q
3
D
j
c
B
2
o
p
B
G
g
c
B
W
M
L
q
e
1
V
t
j
V
J
r
H
8
s
F
M
E
v
Q
j
O
p
C
8
z
x
k
1
1
v
K
7
T
z
x
E
w
0
W
I
2
d
2
0
V
6
6
4
V
X
c
u
s
g
p
e
D
h
X
I
V
e
+
V
v
7
p
h
z
N
I
I
p
W
G
C
a
t
3
x
3
M
T
4
G
V
W
G
M
4
H
T
U
j
f
V
m
F
A
2
o
g
P
s
W
J
Q
0
Q
u
1
n
8
6
O
n
5
M
w
6
I
e
n
H
y
j
5
p
y
N
z
9
P
Z
H
R
S
O
t
J
F
N
j
O
i
J
q
h
X
q
7
N
z
P
9
q
n
d
T
0
r
/
y
M
y
y
Q
1
K
N
l
i
U
T
8
V
x
M
R
k
l
g
A
J
u
U
J
m
x
M
Q
C
Z
Y
r
b
W
w
k
b
U
k
W
Z
s
T
m
V
b
A
j
e
8
p
d
X
o
X
l
R
9
S
z
f
e
5
X
a
T
R
5
H
E
U
7
g
F
M
7
B
g
0
u
o
w
S
3
U
o
Q
E
M
H
u
E
Z
X
u
H
N
G
T
s
v
z
r
v
z
s
W
g
t
O
P
n
M
M
f
y
R
8
/
k
D
L
L
e
S
W
A
=
=
<
/
l
a
t
e
x
i
t
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
o
K
T
V
Q
s
t
e
s
u
Y
7
8
s
M
D
r
e
U
y
r
W
m
L
/
W
8
=
"
>
A
A
A
B
9
H
i
c
b
Z
D
J
S
g
N
B
E
I
Z
r
X
G
P
c
o
h
6
9
N
A
b
B
U
5
j
x
o
j
c
D
e
v
A
k
E
c
w
C
y
R
B
6
e
m
q
S
J
j
2
L
3
T
2
R
M
O
Q
5
J
O
A
h
I
l
5
9
D
6
/
e
f
B
s
7
y
0
E
T
f
2
j
4
+
K
u
K
q
v
6
9
R
H
C
l
b
f
v
b
W
l
l
d
W
9
/
Y
z
G
3
l
t
3
d
2
9
/
Y
L
B
4
c
1
F
a
e
S
Y
Z
X
F
I
p
Y
N
j
y
o
U
P
M
K
q
5
l
p
g
I
5
F
I
Q
0
9
g
3
e
t
d
T
+
r
1
P
k
r
F
4
+
h
B
D
x
J
0
Q
9
q
J
e
M
A
Z
1
c
Z
y
W
0
/
c
R
8
2
F
j
9
n
d
s
F
0
o
2
i
V
7
K
r
I
M
z
h
y
K
V
5
+
j
0
R
g
A
K
u
3
C
V
8
u
P
W
R
p
i
p
J
m
g
S
j
U
d
O
9
F
u
R
q
X
m
T
O
A
w
3
0
o
V
J
p
T
1
a
A
e
b
B
i
M
a
o
n
K
z
6
d
F
D
c
m
o
c
n
w
S
x
N
C
/
S
Z
O
r
+
n
s
h
o
q
N
Q
g
9
E
x
n
S
H
V
X
L
d
Y
m
5
n
+
1
Z
q
q
D
S
z
f
j
U
Z
J
q
j
N
h
s
U
Z
A
K
o
m
M
y
S
Y
D
4
X
C
L
T
Y
m
C
A
M
s
n
N
r
Y
R
1
q
a
R
M
m
5
z
y
J
g
R
n
8
c
v
L
U
D
s
v
O
Y
b
v
n
W
L
5
B
m
b
K
w
T
G
c
w
B
k
4
c
A
F
l
u
I
U
K
V
I
H
B
I
z
z
D
G
F
6
t
v
v
V
i
v
V
n
v
s
9
Y
V
a
z
5
z
B
H
9
k
f
f
w
A
B
w
W
V
M
g
=
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
X
L
j
K
j
c
Y
h
D
Z
u
u
K
8
g
F
s
w
K
u
T
U
7
K
p
o
I
=
"
>
A
A
A
B
9
H
i
c
b
Z
A
9
S
w
N
B
E
I
b
n
4
l
e
M
X
1
F
L
m
8
U
g
W
I
U
7
G
y
0
D
W
l
h
J
B
P
M
B
y
R
H
2
9
i
b
J
k
r
2
9
c
3
c
v
E
o
7
8
D
h
s
L
R
W
z
9
M
X
b
+
G
z
f
J
F
Z
r
4
w
s
L
D
O
z
P
M
7
B
s
k
g
m
v
j
u
t
9
O
Y
W
1
9
Y
3
O
r
u
F
3
a
2
d
3
b
P
y
g
f
H
j
V
1
n
C
q
G
D
R
a
L
W
L
U
D
q
l
F
w
i
Q
3
D
j
c
B
2
o
p
B
G
g
c
B
W
M
L
q
e
1
V
t
j
V
J
r
H
8
s
F
M
E
v
Q
j
O
p
C
8
z
x
k
1
1
v
K
7
T
z
x
E
w
0
W
I
2
d
2
0
V
6
6
4
V
X
c
u
s
g
p
e
D
h
X
I
V
e
+
V
v
7
p
h
z
N
I
I
p
W
G
C
a
t
3
x
3
M
T
4
G
V
W
G
M
4
H
T
U
j
f
V
m
F
A
2
o
g
P
s
W
J
Q
0
Q
u
1
n
8
6
O
n
5
M
w
6
I
e
n
H
y
j
5
p
y
N
z
9
P
Z
H
R
S
O
t
J
F
N
j
O
i
J
q
h
X
q
7
N
z
P
9
q
n
d
T
0
r
/
y
M
y
y
Q
1
K
N
l
i
U
T
8
V
x
M
R
k
l
g
A
J
u
U
J
m
x
M
Q
C
Z
Y
r
b
W
w
k
b
U
k
W
Z
s
T
m
V
b
A
j
e
8
p
d
X
o
X
l
R
9
S
z
f
e
5
X
a
T
R
5
H
E
U
7
g
F
M
7
B
g
0
u
o
w
S
3
U
o
Q
E
M
H
u
E
Z
X
u
H
N
G
T
s
v
z
r
v
z
s
W
g
t
O
P
n
M
M
f
y
R
8
/
k
D
L
L
e
S
W
A
=
=
<
/
l
a
t
e
x
i
t
>
(cid:48)(cid:72)(cid:87)(cid:85)(cid:76)(cid:70)

(cid:42)(cid:72)(cid:81)(cid:72)(cid:85)(cid:68)(cid:87)(cid:82)(cid:85)

(cid:45)(cid:86)(cid:82)(cid:73)(cid:87)

CNN

y

(cid:45)(cid:86)(cid:92)(cid:81)

ˆz<

z<

(cid:41)(cid:88)(cid:79)(cid:79)(cid:92)(cid:3)(cid:38)(cid:82)(cid:81)(cid:81)(cid:72)(cid:70)(cid:87)(cid:72)(cid:71)(cid:3)(cid:47)(cid:68)(cid:92)(cid:72)(cid:85)

(cid:36)(cid:88)(cid:74)(cid:80)(cid:72)(cid:81)(cid:87)(cid:82)(cid:85)

(cid:44)(cid:81)(cid:83)(cid:88)(cid:87)
(cid:47)(cid:82)(cid:86)(cid:86)

(cid:45)(cid:80)

Same

Category

eyey

(cid:45)(cid:85)(cid:72)(cid:70)(cid:82)(cid:81)

y0y0

Reconstruct

Figure 3. The overall network architecture of the our HDML framework. The red dashed arrow points from the part that the loss is
computed on, and to the module that the loss directly supervises. The metric model is a CNN network followed by a fully connected
layer. The augmentor is a linear manipulation of the input and the generator is composed of two fully connected layers with increasing
dimensions. Part of the metric and the following generator form a similar structure to the well-known autoencoder. (Best viewed in color.)

sample can be presented as:

3.3. Hardness and Label Preserving Synthesis

ˆz− = z + [λd(z, z−) + (1 − λ)d+]

z− − z
d(z, z−)

.

(6)

− α

Since the overall hardness of original tuples gradually
decreases during training, it’s reasonable to increase pro-
gressively the hardness of synthetic tuples for compensa-
tion. The hardness of a triplet increases when λ gets larger,
Javg , where Javg is the av-
so we can intuitively set λ to e
erage metric loss over the last epoch, and α is the pulling
factor used to balance the scale of Javg. We exploit the av-
erage metric loss to control the hard level since it is a good
indicator of the training process. The augmented negative
is closer to the anchor if a smaller average loss, leading to
harder tuples as training proceeds. The proposed hardness-
aware negative augmentation can be represented as:

ˆz

− =




z + [e

− α

Javg d(z, z

−) + (1 − e

−

z

− α

−

−z

d(z,z

Javg )d+] z
if d(z, z
if d(z, z

−)
−) > d+
−) ≤ d+.

The necessity of adaptive hardness-aware synthesis lies
in two aspects. Firstly, in the early stages of training, the
embedding space does not have an accurate semantic struc-
ture, so currently hard samples may not truly be informative
or meaningful, and hard synthetics in this situation may be
even inconsistent. Also, hard samples usually result in sig-
niﬁcant changes of the network parameters. Thus the use of
meaningless ones can easily damage the embedding space
structure, leading to a model that is trained in the wrong di-
rection from the beginning. On the other hand, as the train-
ing proceeds, the model is more tolerant of hard samples,
so harder and harder synthetics should be generated to keep
the learning efﬁciency at a high level.

Having obtained the hardness-aware tuple in the embed-
ding space, our objective is to map it back to the feature
space so they can be exploited for training. However, this
mapping is not trivial, since a negative sample constructed
following (7) may not necessarily beneﬁt the training pro-
cess: there is no guarantee that ˆz− shares the same label
with z−. To address this, we formulate this problem from
a manifold perspective, and propose a hardness-and-label-
preserving feature synthesis method.

As shown in Figure 1, the two curves in the feature space
represent two manifolds near which the original data points
belong to class l and l− concentrate respectively. Points
with the same color in the feature and embedding space rep-
resent the same example. So below we do not distinguish
operations acting on features and embeddings. yn is a real
data point of class ln, and we ﬁrst augment it to ˆy− follow-
ing (7). ˆy− is more likely to be outside and further from
the manifold compared with original data points since it is
close to y that belongs to another category. Intuitively, the
goal is to learn a generator that maps ˆy−, a data point away
from the manifold (less likely belonging to class l−), to a
data point that lies near the manifold (more likely belong-
ing to class l−). Moreover, to best preserve the hardness,
this mapped point should be close to ˆy− as much as pos-

(7)

which is the closest point to ˆy− on the manifold.

sible. These two conditions restrict the target point toey−,

We achieve this by learning a generator i : ZZZ i−→ YYY,
which maps the augmented embeddings of a tuple back
to the feature space for recycled training. Since a genera-
tor usually cannot perfectly map all the embeddings back
to the feature space, the synthetic features must lie in the
same space to provide meaningful information. Therefore,
we map not only the synthetic negative sample but also the

75

<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
D
P
N
i
z
g
A
+
o
p
O
B
j
8
0
l
w
I
S
v
V
i
4
T
i
C
g
=
"
>
A
A
A
B
8
X
i
c
b
V
D
L
S
s
N
A
F
L
2
p
r
1
p
f
V
Z
d
u
B
o
v
g
q
i
Q
i
6
L
L
g
x
m
U
F
+
9
A
2
l
M
l
0
0
g
6
d
T
M
L
M
j
R
B
C
/
8
K
N
C
0
X
c
+
j
f
u
/
B
s
n
b
R
f
a
e
m
D
g
c
M
6
9
z
L
k
n
S
K
Q
w
6
L
r
f
T
m
l
t
f
W
N
z
q
7
x
d
2
d
n
d
2
z
+
o
H
h
6
1
T
Z
x
q
x
l
s
s
l
r
H
u
B
t
R
w
K
R
R
v
o
U
D
J
u
4
n
m
N
A
o
k
7
w
S
T
m
8
L
v
P
H
F
t
R
K
z
u
M
U
u
4
H
9
G
R
E
q
F
g
F
K
3
0
2
I
8
o
j
o
M
w
z
6
a
D
a
s
2
t
u
z
O
Q
V
e
I
t
S
A
0
W
a
A
6
q
X
/
1
h
z
N
K
I
K
2
S
S
G
t
P
z
3
A
T
9
n
G
o
U
T
P
J
p
p
Z
8
a
n
l
A
2
o
S
P
e
s
1
T
R
i
B
s
/
n
y
W
e
k
j
O
r
D
E
k
Y
a
/
s
U
k
p
n
6
e
y
O
n
k
T
F
Z
F
N
j
J
I
q
F
Z
9
g
r
x
P
6
+
X
Y
n
j
t
5
0
I
l
K
X
L
F
5
h
+
F
q
S
Q
Y
k
+
J
8
M
h
S
a
M
5
S
Z
J
Z
R
p
Y
b
M
S
N
q
a
a
M
r
Q
l
V
W
w
J
3
v
L
J
q
6
R
9
U
f
c
s
v
7
u
s
N
R
4
W
d
Z
T
h
B
E
7
h
H
D
y
4
g
g
b
c
Q
h
N
a
w
E
D
B
M
7
z
C
m
2
O
c
F
+
f
d
+
Z
i
P
l
p
z
F
z
j
H
8
g
f
P
5
A
w
W
6
k
T
Q
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
D
P
N
i
z
g
A
+
o
p
O
B
j
8
0
l
w
I
S
v
V
i
4
T
i
C
g
=
"
>
A
A
A
B
8
X
i
c
b
V
D
L
S
s
N
A
F
L
2
p
r
1
p
f
V
Z
d
u
B
o
v
g
q
i
Q
i
6
L
L
g
x
m
U
F
+
9
A
2
l
M
l
0
0
g
6
d
T
M
L
M
j
R
B
C
/
8
K
N
C
0
X
c
+
j
f
u
/
B
s
n
b
R
f
a
e
m
D
g
c
M
6
9
z
L
k
n
S
K
Q
w
6
L
r
f
T
m
l
t
f
W
N
z
q
7
x
d
2
d
n
d
2
z
+
o
H
h
6
1
T
Z
x
q
x
l
s
s
l
r
H
u
B
t
R
w
K
R
R
v
o
U
D
J
u
4
n
m
N
A
o
k
7
w
S
T
m
8
L
v
P
H
F
t
R
K
z
u
M
U
u
4
H
9
G
R
E
q
F
g
F
K
3
0
2
I
8
o
j
o
M
w
z
6
a
D
a
s
2
t
u
z
O
Q
V
e
I
t
S
A
0
W
a
A
6
q
X
/
1
h
z
N
K
I
K
2
S
S
G
t
P
z
3
A
T
9
n
G
o
U
T
P
J
p
p
Z
8
a
n
l
A
2
o
S
P
e
s
1
T
R
i
B
s
/
n
y
W
e
k
j
O
r
D
E
k
Y
a
/
s
U
k
p
n
6
e
y
O
n
k
T
F
Z
F
N
j
J
I
q
F
Z
9
g
r
x
P
6
+
X
Y
n
j
t
5
0
I
l
K
X
L
F
5
h
+
F
q
S
Q
Y
k
+
J
8
M
h
S
a
M
5
S
Z
J
Z
R
p
Y
b
M
S
N
q
a
a
M
r
Q
l
V
W
w
J
3
v
L
J
q
6
R
9
U
f
c
s
v
7
u
s
N
R
4
W
d
Z
T
h
B
E
7
h
H
D
y
4
g
g
b
c
Q
h
N
a
w
E
D
B
M
7
z
C
m
2
O
c
F
+
f
d
+
Z
i
P
l
p
z
F
z
j
H
8
g
f
P
5
A
w
W
6
k
T
Q
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
D
P
N
i
z
g
A
+
o
p
O
B
j
8
0
l
w
I
S
v
V
i
4
T
i
C
g
=
"
>
A
A
A
B
8
X
i
c
b
V
D
L
S
s
N
A
F
L
2
p
r
1
p
f
V
Z
d
u
B
o
v
g
q
i
Q
i
6
L
L
g
x
m
U
F
+
9
A
2
l
M
l
0
0
g
6
d
T
M
L
M
j
R
B
C
/
8
K
N
C
0
X
c
+
j
f
u
/
B
s
n
b
R
f
a
e
m
D
g
c
M
6
9
z
L
k
n
S
K
Q
w
6
L
r
f
T
m
l
t
f
W
N
z
q
7
x
d
2
d
n
d
2
z
+
o
H
h
6
1
T
Z
x
q
x
l
s
s
l
r
H
u
B
t
R
w
K
R
R
v
o
U
D
J
u
4
n
m
N
A
o
k
7
w
S
T
m
8
L
v
P
H
F
t
R
K
z
u
M
U
u
4
H
9
G
R
E
q
F
g
F
K
3
0
2
I
8
o
j
o
M
w
z
6
a
D
a
s
2
t
u
z
O
Q
V
e
I
t
S
A
0
W
a
A
6
q
X
/
1
h
z
N
K
I
K
2
S
S
G
t
P
z
3
A
T
9
n
G
o
U
T
P
J
p
p
Z
8
a
n
l
A
2
o
S
P
e
s
1
T
R
i
B
s
/
n
y
W
e
k
j
O
r
D
E
k
Y
a
/
s
U
k
p
n
6
e
y
O
n
k
T
F
Z
F
N
j
J
I
q
F
Z
9
g
r
x
P
6
+
X
Y
n
j
t
5
0
I
l
K
X
L
F
5
h
+
F
q
S
Q
Y
k
+
J
8
M
h
S
a
M
5
S
Z
J
Z
R
p
Y
b
M
S
N
q
a
a
M
r
Q
l
V
W
w
J
3
v
L
J
q
6
R
9
U
f
c
s
v
7
u
s
N
R
4
W
d
Z
T
h
B
E
7
h
H
D
y
4
g
g
b
c
Q
h
N
a
w
E
D
B
M
7
z
C
m
2
O
c
F
+
f
d
+
Z
i
P
l
p
z
F
z
j
H
8
g
f
P
5
A
w
W
6
k
T
Q
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
D
P
N
i
z
g
A
+
o
p
O
B
j
8
0
l
w
I
S
v
V
i
4
T
i
C
g
=
"
>
A
A
A
B
8
X
i
c
b
V
D
L
S
s
N
A
F
L
2
p
r
1
p
f
V
Z
d
u
B
o
v
g
q
i
Q
i
6
L
L
g
x
m
U
F
+
9
A
2
l
M
l
0
0
g
6
d
T
M
L
M
j
R
B
C
/
8
K
N
C
0
X
c
+
j
f
u
/
B
s
n
b
R
f
a
e
m
D
g
c
M
6
9
z
L
k
n
S
K
Q
w
6
L
r
f
T
m
l
t
f
W
N
z
q
7
x
d
2
d
n
d
2
z
+
o
H
h
6
1
T
Z
x
q
x
l
s
s
l
r
H
u
B
t
R
w
K
R
R
v
o
U
D
J
u
4
n
m
N
A
o
k
7
w
S
T
m
8
L
v
P
H
F
t
R
K
z
u
M
U
u
4
H
9
G
R
E
q
F
g
F
K
3
0
2
I
8
o
j
o
M
w
z
6
a
D
a
s
2
t
u
z
O
Q
V
e
I
t
S
A
0
W
a
A
6
q
X
/
1
h
z
N
K
I
K
2
S
S
G
t
P
z
3
A
T
9
n
G
o
U
T
P
J
p
p
Z
8
a
n
l
A
2
o
S
P
e
s
1
T
R
i
B
s
/
n
y
W
e
k
j
O
r
D
E
k
Y
a
/
s
U
k
p
n
6
e
y
O
n
k
T
F
Z
F
N
j
J
I
q
F
Z
9
g
r
x
P
6
+
X
Y
n
j
t
5
0
I
l
K
X
L
F
5
h
+
F
q
S
Q
Y
k
+
J
8
M
h
S
a
M
5
S
Z
J
Z
R
p
Y
b
M
S
N
q
a
a
M
r
Q
l
V
W
w
J
3
v
L
J
q
6
R
9
U
f
c
s
v
7
u
s
N
R
4
W
d
Z
T
h
B
E
7
h
H
D
y
4
g
g
b
c
Q
h
N
a
w
E
D
B
M
7
z
C
m
2
O
c
F
+
f
d
+
Z
i
P
l
p
z
F
z
j
H
8
g
f
P
5
A
w
W
6
k
T
Q
=
<
/
l
a
t
e
x
i
t
>
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
d
H
H
n
0
f
I
H
A
t
7
b
f
3
1
P
S
8
3
3
+
v
9
C
c
i
E
=
"
>
A
A
A
B
8
X
i
c
b
V
D
L
S
s
N
A
F
L
3
x
W
e
u
r
6
t
L
N
Y
B
F
c
l
U
Q
E
X
R
b
c
u
K
x
g
H
9
q
G
M
p
n
e
t
E
M
n
k
z
A
z
E
W
r
o
X
7
h
x
o
Y
h
b
/
8
a
d
f
+
O
k
z
U
J
b
D
w
w
c
z
r
m
X
O
f
c
E
i
e
D
a
u
O
6
3
s
7
K
6
t
r
6
x
W
d
o
q
b
+
/
s
7
u
1
X
D
g
5
b
O
k
4
V
w
y
a
L
R
a
w
6
A
d
U
o
u
M
S
m
4
U
Z
g
J
1
F
I
o
0
B
g
O
x
h
f
5
3
7
7
E
Z
X
m
s
b
w
z
k
w
T
9
i
A
4
l
D
z
m
j
x
k
o
P
v
Y
i
a
U
R
B
m
T
9
N
+
p
e
r
W
3
B
n
I
M
v
E
K
U
o
U
C
j
X
7
l
q
z
e
I
W
R
q
h
N
E
x
Q
r
b
u
e
m
x
g
/
o
8
p
w
J
n
B
a
7
q
U
a
E
8
r
G
d
I
h
d
S
y
W
N
U
P
v
Z
L
P
G
U
n
F
p
l
Q
M
J
Y
2
S
c
N
m
a
m
/
N
z
I
a
a
T
2
J
A
j
u
Z
J
9
S
L
X
i
7
+
5
3
V
T
E
1
7
5
G
Z
d
J
a
l
C
y
+
U
d
h
K
o
i
J
S
X
4
+
G
X
C
F
z
I
i
J
J
Z
Q
p
b
r
M
S
N
q
K
K
M
m
N
L
K
t
s
S
v
M
W
T
l
0
n
r
v
O
Z
Z
f
n
t
R
r
d
8
X
d
Z
T
g
G
E
7
g
D
D
y
4
h
D
r
c
Q
A
O
a
w
E
D
C
M
7
z
C
m
6
O
d
F
+
f
d
+
Z
i
P
r
j
j
F
z
h
H
8
g
f
P
5
A
w
c
/
k
T
U
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
d
H
H
n
0
f
I
H
A
t
7
b
f
3
1
P
S
8
3
3
+
v
9
C
c
i
E
=
"
>
A
A
A
B
8
X
i
c
b
V
D
L
S
s
N
A
F
L
3
x
W
e
u
r
6
t
L
N
Y
B
F
c
l
U
Q
E
X
R
b
c
u
K
x
g
H
9
q
G
M
p
n
e
t
E
M
n
k
z
A
z
E
W
r
o
X
7
h
x
o
Y
h
b
/
8
a
d
f
+
O
k
z
U
J
b
D
w
w
c
z
r
m
X
O
f
c
E
i
e
D
a
u
O
6
3
s
7
K
6
t
r
6
x
W
d
o
q
b
+
/
s
7
u
1
X
D
g
5
b
O
k
4
V
w
y
a
L
R
a
w
6
A
d
U
o
u
M
S
m
4
U
Z
g
J
1
F
I
o
0
B
g
O
x
h
f
5
3
7
7
E
Z
X
m
s
b
w
z
k
w
T
9
i
A
4
l
D
z
m
j
x
k
o
P
v
Y
i
a
U
R
B
m
T
9
N
+
p
e
r
W
3
B
n
I
M
v
E
K
U
o
U
C
j
X
7
l
q
z
e
I
W
R
q
h
N
E
x
Q
r
b
u
e
m
x
g
/
o
8
p
w
J
n
B
a
7
q
U
a
E
8
r
G
d
I
h
d
S
y
W
N
U
P
v
Z
L
P
G
U
n
F
p
l
Q
M
J
Y
2
S
c
N
m
a
m
/
N
z
I
a
a
T
2
J
A
j
u
Z
J
9
S
L
X
i
7
+
5
3
V
T
E
1
7
5
G
Z
d
J
a
l
C
y
+
U
d
h
K
o
i
J
S
X
4
+
G
X
C
F
z
I
i
J
J
Z
Q
p
b
r
M
S
N
q
K
K
M
m
N
L
K
t
s
S
v
M
W
T
l
0
n
r
v
O
Z
Z
f
n
t
R
r
d
8
X
d
Z
T
g
G
E
7
g
D
D
y
4
h
D
r
c
Q
A
O
a
w
E
D
C
M
7
z
C
m
6
O
d
F
+
f
d
+
Z
i
P
r
j
j
F
z
h
H
8
g
f
P
5
A
w
c
/
k
T
U
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
d
H
H
n
0
f
I
H
A
t
7
b
f
3
1
P
S
8
3
3
+
v
9
C
c
i
E
=
"
>
A
A
A
B
8
X
i
c
b
V
D
L
S
s
N
A
F
L
3
x
W
e
u
r
6
t
L
N
Y
B
F
c
l
U
Q
E
X
R
b
c
u
K
x
g
H
9
q
G
M
p
n
e
t
E
M
n
k
z
A
z
E
W
r
o
X
7
h
x
o
Y
h
b
/
8
a
d
f
+
O
k
z
U
J
b
D
w
w
c
z
r
m
X
O
f
c
E
i
e
D
a
u
O
6
3
s
7
K
6
t
r
6
x
W
d
o
q
b
+
/
s
7
u
1
X
D
g
5
b
O
k
4
V
w
y
a
L
R
a
w
6
A
d
U
o
u
M
S
m
4
U
Z
g
J
1
F
I
o
0
B
g
O
x
h
f
5
3
7
7
E
Z
X
m
s
b
w
z
k
w
T
9
i
A
4
l
D
z
m
j
x
k
o
P
v
Y
i
a
U
R
B
m
T
9
N
+
p
e
r
W
3
B
n
I
M
v
E
K
U
o
U
C
j
X
7
l
q
z
e
I
W
R
q
h
N
E
x
Q
r
b
u
e
m
x
g
/
o
8
p
w
J
n
B
a
7
q
U
a
E
8
r
G
d
I
h
d
S
y
W
N
U
P
v
Z
L
P
G
U
n
F
p
l
Q
M
J
Y
2
S
c
N
m
a
m
/
N
z
I
a
a
T
2
J
A
j
u
Z
J
9
S
L
X
i
7
+
5
3
V
T
E
1
7
5
G
Z
d
J
a
l
C
y
+
U
d
h
K
o
i
J
S
X
4
+
G
X
C
F
z
I
i
J
J
Z
Q
p
b
r
M
S
N
q
K
K
M
m
N
L
K
t
s
S
v
M
W
T
l
0
n
r
v
O
Z
Z
f
n
t
R
r
d
8
X
d
Z
T
g
G
E
7
g
D
D
y
4
h
D
r
c
Q
A
O
a
w
E
D
C
M
7
z
C
m
6
O
d
F
+
f
d
+
Z
i
P
r
j
j
F
z
h
H
8
g
f
P
5
A
w
c
/
k
T
U
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
d
H
H
n
0
f
I
H
A
t
7
b
f
3
1
P
S
8
3
3
+
v
9
C
c
i
E
=
"
>
A
A
A
B
8
X
i
c
b
V
D
L
S
s
N
A
F
L
3
x
W
e
u
r
6
t
L
N
Y
B
F
c
l
U
Q
E
X
R
b
c
u
K
x
g
H
9
q
G
M
p
n
e
t
E
M
n
k
z
A
z
E
W
r
o
X
7
h
x
o
Y
h
b
/
8
a
d
f
+
O
k
z
U
J
b
D
w
w
c
z
r
m
X
O
f
c
E
i
e
D
a
u
O
6
3
s
7
K
6
t
r
6
x
W
d
o
q
b
+
/
s
7
u
1
X
D
g
5
b
O
k
4
V
w
y
a
L
R
a
w
6
A
d
U
o
u
M
S
m
4
U
Z
g
J
1
F
I
o
0
B
g
O
x
h
f
5
3
7
7
E
Z
X
m
s
b
w
z
k
w
T
9
i
A
4
l
D
z
m
j
x
k
o
P
v
Y
i
a
U
R
B
m
T
9
N
+
p
e
r
W
3
B
n
I
M
v
E
K
U
o
U
C
j
X
7
l
q
z
e
I
W
R
q
h
N
E
x
Q
r
b
u
e
m
x
g
/
o
8
p
w
J
n
B
a
7
q
U
a
E
8
r
G
d
I
h
d
S
y
W
N
U
P
v
Z
L
P
G
U
n
F
p
l
Q
M
J
Y
2
S
c
N
m
a
m
/
N
z
I
a
a
T
2
J
A
j
u
Z
J
9
S
L
X
i
7
+
5
3
V
T
E
1
7
5
G
Z
d
J
a
l
C
y
+
U
d
h
K
o
i
J
S
X
4
+
G
X
C
F
z
I
i
J
J
Z
Q
p
b
r
M
S
N
q
K
K
M
m
N
L
K
t
s
S
v
M
W
T
l
0
n
r
v
O
Z
Z
f
n
t
R
r
d
8
X
d
Z
T
g
G
E
7
g
D
D
y
4
h
D
r
c
Q
A
O
a
w
E
D
C
M
7
z
C
m
6
O
d
F
+
f
d
+
Z
i
P
r
j
j
F
z
h
H
8
g
f
P
5
A
w
c
/
k
T
U
=
<
/
l
a
t
e
x
i
t
>
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
L
a
F
r
0
Y
8
I
a
F
m
d
U
t
Y
A
d
x
M
o
6
7
E
R
q
+
I
=
"
>
A
A
A
B
+
X
i
c
b
V
D
L
S
s
N
A
F
L
3
x
W
e
s
r
6
t
J
N
s
A
i
u
S
i
K
C
L
g
t
u
X
F
a
w
D
2
l
C
m
U
w
n
7
d
D
J
J
M
z
c
F
G
r
o
n
7
h
x
o
Y
h
b
/
8
S
d
f
+
O
k
z
U
J
b
D
w
w
c
z
r
m
X
e
+
a
E
q
e
A
a
X
f
f
b
W
l
v
f
2
N
z
a
r
u
x
U
d
/
f
2
D
w
7
t
o
+
O
2
T
j
J
F
W
Y
s
m
I
l
H
d
k
G
g
m
u
G
Q
t
5
C
h
Y
N
1
W
M
x
K
F
g
n
X
B
8
W
/
i
d
C
V
O
a
J
/
I
B
p
y
k
L
Y
j
K
U
P
O
K
U
o
J
H
6
t
u
2
P
C
O
Z
+
T
H
A
U
R
v
n
T
b
N
a
3
a
2
7
d
n
c
N
Z
J
V
5
J
a
l
C
i
2
b
e
/
/
E
F
C
s
5
h
J
p
I
J
o
3
f
P
c
F
I
O
c
K
O
R
U
s
F
n
V
z
z
R
L
C
R
2
T
I
e
s
Z
K
k
n
M
d
J
D
P
k
8
+
c
c
6
M
M
n
C
h
R
5
k
l
0
5
u
r
v
j
Z
z
E
W
k
/
j
0
E
w
W
E
f
W
y
V
4
j
/
e
b
0
M
o
5
s
g
5
z
L
N
k
E
m
6
O
B
R
l
w
s
H
E
K
W
p
w
B
l
w
x
i
m
J
q
C
K
G
K
m
6
w
O
H
R
F
F
K
J
q
y
q
q
Y
E
b
/
n
L
q
6
R
9
W
f
c
M
v
7
+
q
N
R
7
L
O
i
p
w
C
m
d
w
A
R
5
c
Q
w
P
u
o
A
k
t
o
D
C
B
Z
3
i
F
N
y
u
3
X
q
x
3
6
2
M
x
u
m
a
V
O
y
f
w
B
9
b
n
D
1
/
+
l
D
M
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
L
a
F
r
0
Y
8
I
a
F
m
d
U
t
Y
A
d
x
M
o
6
7
E
R
q
+
I
=
"
>
A
A
A
B
+
X
i
c
b
V
D
L
S
s
N
A
F
L
3
x
W
e
s
r
6
t
J
N
s
A
i
u
S
i
K
C
L
g
t
u
X
F
a
w
D
2
l
C
m
U
w
n
7
d
D
J
J
M
z
c
F
G
r
o
n
7
h
x
o
Y
h
b
/
8
S
d
f
+
O
k
z
U
J
b
D
w
w
c
z
r
m
X
e
+
a
E
q
e
A
a
X
f
f
b
W
l
v
f
2
N
z
a
r
u
x
U
d
/
f
2
D
w
7
t
o
+
O
2
T
j
J
F
W
Y
s
m
I
l
H
d
k
G
g
m
u
G
Q
t
5
C
h
Y
N
1
W
M
x
K
F
g
n
X
B
8
W
/
i
d
C
V
O
a
J
/
I
B
p
y
k
L
Y
j
K
U
P
O
K
U
o
J
H
6
t
u
2
P
C
O
Z
+
T
H
A
U
R
v
n
T
b
N
a
3
a
2
7
d
n
c
N
Z
J
V
5
J
a
l
C
i
2
b
e
/
/
E
F
C
s
5
h
J
p
I
J
o
3
f
P
c
F
I
O
c
K
O
R
U
s
F
n
V
z
z
R
L
C
R
2
T
I
e
s
Z
K
k
n
M
d
J
D
P
k
8
+
c
c
6
M
M
n
C
h
R
5
k
l
0
5
u
r
v
j
Z
z
E
W
k
/
j
0
E
w
W
E
f
W
y
V
4
j
/
e
b
0
M
o
5
s
g
5
z
L
N
k
E
m
6
O
B
R
l
w
s
H
E
K
W
p
w
B
l
w
x
i
m
J
q
C
K
G
K
m
6
w
O
H
R
F
F
K
J
q
y
q
q
Y
E
b
/
n
L
q
6
R
9
W
f
c
M
v
7
+
q
N
R
7
L
O
i
p
w
C
m
d
w
A
R
5
c
Q
w
P
u
o
A
k
t
o
D
C
B
Z
3
i
F
N
y
u
3
X
q
x
3
6
2
M
x
u
m
a
V
O
y
f
w
B
9
b
n
D
1
/
+
l
D
M
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
L
a
F
r
0
Y
8
I
a
F
m
d
U
t
Y
A
d
x
M
o
6
7
E
R
q
+
I
=
"
>
A
A
A
B
+
X
i
c
b
V
D
L
S
s
N
A
F
L
3
x
W
e
s
r
6
t
J
N
s
A
i
u
S
i
K
C
L
g
t
u
X
F
a
w
D
2
l
C
m
U
w
n
7
d
D
J
J
M
z
c
F
G
r
o
n
7
h
x
o
Y
h
b
/
8
S
d
f
+
O
k
z
U
J
b
D
w
w
c
z
r
m
X
e
+
a
E
q
e
A
a
X
f
f
b
W
l
v
f
2
N
z
a
r
u
x
U
d
/
f
2
D
w
7
t
o
+
O
2
T
j
J
F
W
Y
s
m
I
l
H
d
k
G
g
m
u
G
Q
t
5
C
h
Y
N
1
W
M
x
K
F
g
n
X
B
8
W
/
i
d
C
V
O
a
J
/
I
B
p
y
k
L
Y
j
K
U
P
O
K
U
o
J
H
6
t
u
2
P
C
O
Z
+
T
H
A
U
R
v
n
T
b
N
a
3
a
2
7
d
n
c
N
Z
J
V
5
J
a
l
C
i
2
b
e
/
/
E
F
C
s
5
h
J
p
I
J
o
3
f
P
c
F
I
O
c
K
O
R
U
s
F
n
V
z
z
R
L
C
R
2
T
I
e
s
Z
K
k
n
M
d
J
D
P
k
8
+
c
c
6
M
M
n
C
h
R
5
k
l
0
5
u
r
v
j
Z
z
E
W
k
/
j
0
E
w
W
E
f
W
y
V
4
j
/
e
b
0
M
o
5
s
g
5
z
L
N
k
E
m
6
O
B
R
l
w
s
H
E
K
W
p
w
B
l
w
x
i
m
J
q
C
K
G
K
m
6
w
O
H
R
F
F
K
J
q
y
q
q
Y
E
b
/
n
L
q
6
R
9
W
f
c
M
v
7
+
q
N
R
7
L
O
i
p
w
C
m
d
w
A
R
5
c
Q
w
P
u
o
A
k
t
o
D
C
B
Z
3
i
F
N
y
u
3
X
q
x
3
6
2
M
x
u
m
a
V
O
y
f
w
B
9
b
n
D
1
/
+
l
D
M
=
<
/
l
a
t
e
x
i
t
>
<
l
a
t
e
x
i
t
 
s
h
a
1
_
b
a
s
e
6
4
=
"
L
a
F
r
0
Y
8
I
a
F
m
d
U
t
Y
A
d
x
M
o
6
7
E
R
q
+
I
=
"
>
A
A
A
B
+
X
i
c
b
V
D
L
S
s
N
A
F
L
3
x
W
e
s
r
6
t
J
N
s
A
i
u
S
i
K
C
L
g
t
u
X
F
a
w
D
2
l
C
m
U
w
n
7
d
D
J
J
M
z
c
F
G
r
o
n
7
h
x
o
Y
h
b
/
8
S
d
f
+
O
k
z
U
J
b
D
w
w
c
z
r
m
X
e
+
a
E
q
e
A
a
X
f
f
b
W
l
v
f
2
N
z
a
r
u
x
U
d
/
f
2
D
w
7
t
o
+
O
2
T
j
J
F
W
Y
s
m
I
l
H
d
k
G
g
m
u
G
Q
t
5
C
h
Y
N
1
W
M
x
K
F
g
n
X
B
8
W
/
i
d
C
V
O
a
J
/
I
B
p
y
k
L
Y
j
K
U
P
O
K
U
o
J
H
6
t
u
2
P
C
O
Z
+
T
H
A
U
R
v
n
T
b
N
a
3
a
2
7
d
n
c
N
Z
J
V
5
J
a
l
C
i
2
b
e
/
/
E
F
C
s
5
h
J
p
I
J
o
3
f
P
c
F
I
O
c
K
O
R
U
s
F
n
V
z
z
R
L
C
R
2
T
I
e
s
Z
K
k
n
M
d
J
D
P
k
8
+
c
c
6
M
M
n
C
h
R
5
k
l
0
5
u
r
v
j
Z
z
E
W
k
/
j
0
E
w
W
E
f
W
y
V
4
j
/
e
b
0
M
o
5
s
g
5
z
L
N
k
E
m
6
O
B
R
l
w
s
H
E
K
W
p
w
B
l
w
x
i
m
J
q
C
K
G
K
m
6
w
O
H
R
F
F
K
J
q
y
q
q
Y
E
b
/
n
L
q
6
R
9
W
f
c
M
v
7
+
q
N
R
7
L
O
i
p
w
C
m
d
w
A
R
5
c
Q
w
P
u
o
A
k
t
o
D
C
B
Z
3
i
F
N
y
u
3
X
q
x
3
6
2
M
x
u
m
a
V
O
y
f
w
B
9
b
n
D
1
/
+
l
D
M
=
<
/
l
a
t
e
x
i
t
>
other unaltered samples in one tuple:

(8)

T(ey) = i(θi; T(ˆz)),

where T(ey) and T(ˆz) are tuples in the feature and embed-

ding space respectively, and θi is the parameters of the gen-
erative mapping i.

We exploit an auto-encoder architecture to implement
the mapping g and mapping i. The encoder g takes as input
a feature vector y which is extracted by CNN from the im-
age, and ﬁrst maps it to an embedding z. In the embedding
space, we modify z to ˆz using the hardness-aware augmen-
tation described in the last subsection. The generator i then
maps the original embedding z and the augmented embed-

ding ˆz to y′ andey respectively.
In order to exploit the synthetic featuresey for effective

training, they should preserve the labels of the original sam-
ples as well as the augmented hardness. We formulate the
objective of the generator as follows:

Jgen = Jrecon + λJsof t

= c(Y, Y′) + λJsof t(eY, L)
= Xy∈Y
||y − y′||2 + λXey∈ eY

y′∈Y′

l∈L

(9)

jsof t(ey, l),

where λ is a balance factor, y′ = i(θi; z) is the unaltered

synthetic feature,ey is the hardness-aware synthetic feature
of origin y with label l, Y′, Y and eY are the correspond-

ing feature distributions, c(Y, Y′) is the reconstruction cost
between the two distributions, and Jsof t is the softmax
loss function. Note that Jgen is only used to train the de-
coder/generator and has no inﬂuence on the metric.

The overall objective function is composed of two parts:
the reconstruction loss and the softmax loss. The syn-
thetic negative should be as close to the augmented nega-
tive as possible so that it can constitute a tuple with hard-
ness we require. Thus we utilize the reconstruction loss
Jrecon = ||y − y′||2
2 to restrict the encoder & decoder to
map each point close to itself. The softmax loss Jsof t en-
sures that the augmented synthetics do not change the orig-

inal label. Directly penalizing the distance betweeney and y

can also achieve this, but is too strict to preserve the hard-
ness. Alternatively, we simultaneously learn a fully con-
nected layer with the softmax loss on y, where the gra-
dients only update the parameters in this layer. We em-
ploy the learned softmax layer to compute the softmax loss

and the original label l.

jsof t(ey, l) between the synthetic hardness-aware negativeey

3.4. Hardness Aware Deep Metric Learning

We present the framework of the proposed method,
which is mainly composed of three parts, a metric network
to obtain the embeddings, a hardness-aware augmentor to

=

76

perform augmentation of the hard level and a hardness-and-
label-preserving generator network to generate the corre-
sponding synthetics, as shown in Figure 3.

Having obtained the embeddings of a tuple, we ﬁrst per-
form linear interpolation to modify the hard level, weighted
by a factor indicating the current training status of the
model. Then we utilize a simultaneously trained genera-
tor to generate synthetics for the augmented hardness-aware
tuple, meanwhile ensuring the synthetics are realistic and
maintain their original labels. Compared to conventional
deep metric learning methods, we additionally utilize the
hardness-aware synthetics to train the metric:

θh

(10)

θ∗
h = arg min

J(θh; {Ti} ∪ {eTi}),
where eTi is the synthetic hardness-aware tuple.

The proposed framework can be applied to a variety of
deep metric learning methods to boost their performance.
For a speciﬁc loss J in metric learning, the objective func-
tion to train the metric is:

Jmetric = e

− β

Jgen Jm + (1 − e

− β

Jgen )Jsyn
− β

− β

= e

Jgen J(T) + (1 − e

where β is a pre-deﬁned parameter, Jm = J(T) is the

Jgen )J(eT), (11)
loss J over original samples, Jsyn = J(eT) is the loss J
over synthetic samples, and eT denotes the synthetic tuple

in the feature space. We use e
Jgen as the balance factor
to assign smaller weights to synthetic features when Jgen
is high, since the generator is not fully trained and the syn-
thetic features may not have realistic meanings.

− β

Jm aims to learn the embedding space so that inter-class
distances are large and intra-class distances are small. Jsyn
utilizes synthetic hardness-aware samples to train the metric
more effectively. As the training proceeds, harder tuples are
synthesized to keep the high efﬁciency of learning.

We demonstrate our framework on two losses with
triplet loss [25] and N-pair

different tuple formations:
loss [28].

For the triplet loss [25], we use the distance of the posi-
tive pair as the reference distance and generate the negative
with our hardness-aware synthesis:

J(eT(x, x+,ex−)) = [D(x, x+) − D(x,ex−) + m]+, (12)

where [·]+ = max(·, 0) and m is the margin.

For the N-pair loss [28], we also use the distance of the
positive pair as the reference distance, but generate all the
N − 1 negatives for each anchor in an (N+1)-tuple:

J(eT({x, x+,ex+}i))
NXi=1
log (1 +Xj6=i

1
N

(13)

exp (D(xi, x+

j ))).

i ) − D(xi,ex+

The metric and the generator network are trained simul-
taneously, without any interruptions for auxiliary sampling
processes as most hard negative mining methods do. The
augmentor and generator are only used in the training stage,
which introduces no additional workload to the resulting
embedding computing.

0.7

0.6

4. Experiments

In this section, we conducted various experiments to
evaluate the proposed HDML in both image clustering and
retrieval tasks. We performed an ablation study to analyze
the effectiveness of each module. For the clustering task, we
employed NMI and F1 as performance metrics. The nor-
malized mutual information (NMI) is deﬁned by the ratio
of the mutual information of clusters and ground truth labels
and the arithmetic mean of their entropy. F1 is the harmonic
mean of precision and recall. See [30] for more details. For
the retrieval task, we employed Recall@Ks as performance
metrics. They are determined by the existence of at least
one correct retrieved sample in the K nearest neighbors.

4.1. Datasets

We evaluated our method under a zero-shot setting,
where the training set and test set contain image classes
with no intersection. We followed [30, 29, 5] to perform
the training/test set split.

• The CUB-200-2011 dataset [36] consists of 11,788 im-
ages of 200 bird species. We split the ﬁrst 100 species
(5,864 images) for training and the rest 100 species
(5,924 images) for testing.

• The Cars196 dataset [16] consists of 16,185 images of
196 car makes and models. We split the ﬁrst 98 models
(8,054 images) for training and the rest 100 models
(8,131 images) for testing.

• The Stanford Online Products dataset [30] consists
of 120,053 images of 22,634 online products from
eBay.com. We split the ﬁrst 11,318 products (59,551
images) for training and the rest 11,316 products
(60,502 images) for testing.

4.2. Experimental Settings

We used the Tensorﬂow package throughout the experi-
ments. For a fair comparison with previous works on deep
metric learning, we used GoogLeNet [31] architecture as
the CNN feature extractor (i.e., f ) and added a fully con-
nected layer as the embedding projector (i.e., g). We im-
plemented the generator (i.e., i) with two fully connected
layers of increasing output dimensions 512 and 1,024. We
ﬁxed the embedding size to 512 for all the three datasets.
For training, we initialized the CNN with weights pre-
trained on ImageNet ILSVRC dataset [24] and all other

I

M
N

0.5

0.4

0.3

0

2000

4000

N-pair
HDML(N-pair)
HDML(N-pair) w/o Jsoft
HDML(N-pair) w/o Jrecon
8000 10000 12000

6000

Iterations

Figure 4. Comparisons of different settings in the clustering task.

1
@

l
l

a
c
e
R

0.8
0.7
0.6
0.5
0.4
0.3
0.2
0.1

0

2000

4000

N-pair
HDML(N-pair)
HDML(N-pair) w/o Jsoft
HDML(N-pair) w/o Jrecon
8000 10000 12000

6000

Iterations

Figure 5. Comparisons of different settings in the retrieval task.

fully connected layers with random weights. We ﬁrst re-
sized the images to 256 by 256, then performed random
cropping at 227 by 227 and horizontal random mirror for
data augmentation. We tuned all the hyperparameters via
5-fold cross-validation on the training set. We set the learn-
ing rate for CNNs to 10−4 and multiplied it by 10 for other
fully connected layers. We set the batch size to 120 for the
triplet loss and 128 for the N-pair loss. We ﬁxed the balance
factors β and λ to 104 and 0.5, and set α to 7 for the triplet
loss and 90 for the N-pair loss.

4.3. Results and Analysis

Ablation Study: We present the ablation study of the
proposed method. We conducted all the following experi-
ments on the Cars196 dataset with the N-pair loss, but we
observe similar results with the triplet loss.

Figures 4 and 5 show the learning curves of different
model settings in the clustering and retrieval task, including
the baseline model, the proposed framework with the N-pair
loss, the HDML framework without the softmax loss and
the HDML framework without the reconstruction loss. We

77

0.74

0.72

0.70

0.68

I

M
N

0.66

0.64

0.62

0.60

NMI

Recall@1

0.80

0.78

0.76

0.74

0.72

1
@

l
l

a
c
e
R

0.70

0.68

0.66

0

100

200

α

300

400

500

Figure 6. Comparisons of converged results using different pulling
factors in the clustering and retrieval task.

0.8

0.7

0.6

1
@

l
l

a
c
e
R

0.5

0.4

α = 0
α = 20
α = 90
α = 150
α = 500

0

2000

4000

6000

Iterations

8000 10000 12000

Figure 7. Comparisons of using different pulling factors in the re-
trieval task.

observe that the absence of the softmax loss results in dra-
matic performance reduction. This is because the synthetic
samples might not preserve the label information, leading
to inconsistent tuples.
It is surprising that the proposed
method without the reconstruction loss still achieves bet-
ter results than the baseline. We speculate it is because the
softmax layer itself learns to distinguish realistic synthetics
from false ones in this situation.

Figures 6 and 7 show the effect of different pulling fac-
tors. A larger α means we generate harder tuples each time,
and α = 0 means we do not apply hard synthesis at all.
We see that as α grows, the performance increases at ﬁrst
and achieves the best result at α = 90, then gradually de-
creases. This justiﬁes the synthesis of tuples with suitable
and adaptive hardness. A too light hard synthesis may not
fully exploit the underlying information, while a too strong
hard synthesis may lead to inconsistent tuples and destroy
the structure of the embedding space.

Quantitative Results: We compared our model with

Table 1. Experimental results (%) on the CUB-200-2011 dataset
in comparison with other methods.

Method

NMI

F1

R@1 R@2

R@4 R@8

Contrastive
DDML
Lifted
Angular

Triplet
Triplet hard
DAML (Triplet)
HDML (Triplet)

N-pair
DAML (N-pair)
HDML (N-pair)

47.2
47.3
56.4
61.0

49.8
53.4
51.3
55.1

60.2
61.3
62.6

12.5
13.1
22.6
30.2

15.0
17.9
17.6
21.9

28.2
29.5
31.6

27.2
31.2
46.9
53.6

35.9
40.6
37.6
43.6

51.9
52.7
53.7

36.3
41.6
59.8
65.0

47.7
52.3
49.3
55.8

64.3
65.4
65.7

49.8
54.7
71.2
75.3

59.1
64.2
61.3
67.7

74.9
75.5
76.7

62.1
67.1
81.5
83.7

70.0
75.0
74.4
78.3

83.2
84.3
85.7

Table 2. Experimental results (%) on the Cars196 dataset in com-
parison with other methods.

Method

NMI

F1

R@1 R@2

R@4 R@8

Contrastive
DDML
Lifted
Angular

Triplet
Triplet hard
DAML (Triplet)
HDML (Triplet)

N-pair
DAML (N-pair)
HDML (N-pair)

42.3
41.7
57.8
62.4

52.9
55.7
56.5
59.4

62.7
66.0
69.7

10.5
10.9
25.1
31.8

17.9
22.4
22.9
27.2

31.8
36.4
41.6

27.6
32.7
59.9
71.3

45.1
53.2
60.6
61.0

68.9
75.1
79.1

38.3
43.9
70.4
80.7

57.4
65.4
72.5
72.6

78.9
83.8
87.1

51.0
56.5
79.6
87.0

69.7
74.3
82.5
80.7

85.8
89.7
92.1

63.9
68.8
87.0
91.8

79.2
83.6
89.9
88.5

90.9
93.5
95.5

Table 3. Experimental results (%) on the Stanford Online Products
dataset in comparison with other methods.

Method

NMI

F1

R@1 R@10

R@100

Contrastive
DDML
Lifted
Angular

Triplet
Triplet hard
DAML (Triplet)
HDML (Triplet)

N-pair
DAML (N-pair)
HDML (N-pair)

82.4
83.4
87.2
87.8

86.3
86.7
87.1
87.2

87.9
89.4
89.3

10.1
10.7
25.3
26.5

20.2
22.1
22.3
22.5

27.1
32.4
32.2

37.5
42.1
62.6
67.9

53.9
57.8
58.1
58.5

66.4
68.4
68.7

53.9
57.8
80.9
83.2

72.1
75.3
75.0
75.5

82.9
83.5
83.2

71.0
73.7
91.2
92.2

85.7
88.1
88.0
88.3

92.1
92.3
92.4

including the conventional
several baseline methods,
contrastive loss [9] and triplet
loss [41], more recent
DDML [41] and triplet loss with semi-hard negative min-
ing [25], the state-of-the-art lifted structure [30], N-pair
loss [28] and angular loss [39], and the hard negative gen-

78

Figure 8. Barnes-Hut t-SNE visualization [33] of the proposed HDML (N-pair) method on the test split of CUB-200-2011, where we
magnify several areas for a better view. The color of the boundary of each image represent the category. (Best viewed when zoomed in.)

eration method DAML [5]. We employed the proposed
framework to the triplet loss and N-pair loss as illustrated
before. We evaluated all the methods mentioned above us-
ing the same pre-trained CNN model for fair comparison.

Tables 1, 2, and 3 show the quantitative results on the
CUB-200-2011, Cars196, and Stanford Online Products
datasets respectively. Red numbers indicate the best results
and bold numbers mean our method achieves better results
than the associated method without HDML. We observe our
proposed framework can achieve very competitive perfor-
mance on all the three datasets in both tasks. Compared
with the original triplet loss and N-pair loss, our framework
can further boost their performance for a fairly large mar-
gin. This demonstrates the effectiveness of the proposed
hardness-aware synthesis strategy. The performance im-
provement on the Stanford Online Products dataset is rela-
tively small compared with the other two datasets. We think
this difference comes from the size of the training set. Our
proposed framework generates synthetic samples with suit-
able and adaptive hardness, which can exploit more infor-
mation from a limited training set than conventional sam-
pling strategies. This advantage becomes more signiﬁcant
on small-sized datasets like CUB-200-2011 and Cars196.

Qualitative Results: Figure 8 shows the Barnes-Hut t-
SNE visualization [33] of the learned embedding using the
proposed HDML (N-pair) method. We magnify several ar-
eas for a better view, where the color on the boundary of
each image represents the category. The test split of the

CUB-200-2011 dataset contains 5,924 images of birds from
100 different species. The visual differences between two
species tend to be very subtle, making it difﬁcult for humans
to distinguish. We observe that despite the subtle inter-class
differences and large intra-class variations, such as illumi-
nation, backgrounds, viewpoints, and poses, our method
can still be able to group similar species, which intuitively
verify the effectiveness of the proposed HDML framework.

5. Conclusion

In this paper, we have presented a hardness-aware syn-
thesis framework for deep metric learning. Our proposed
HDML framework boosts the performance of original met-
ric learning losses by adaptively generating hardness-aware
and label-preserving synthetics as complements to the train-
ing data. We have demonstrated the effectiveness of the
proposed framework on three widely-used datasets in both
clustering and retrieval task. In the future, it is interesting to
apply our framework to the more general data augmentation
problem, which can be utilized to improve a wide variety of
machine learning approaches other than metric learning.

Acknowledgement

This work was supported in part by the National Natural
Science Foundation of China under Grant 61672306, Grant
U1813218, Grant 61822603, Grant U1713214, and Grant
61572271.

79

References

[1] Miguel A Bautista, Artsiom Sanakoyeu, and Bj¨orn Om-
mer. Deep unsupervised similarity learning using partially
ordered sets. In CVPR, pages 1923–1932, 2017. 2

[2] Weihua Chen, Xiaotang Chen, Jianguo Zhang, and Kaiqi
Huang. Beyond triplet loss: a deep quadruplet network for
person re-identiﬁcation. In CVPR, pages 1320–329, 2017. 1,
2

[3] De Cheng, Yihong Gong, Sanping Zhou, Jinjun Wang, and
Nanning Zheng. Person re-identiﬁcation by multi-channel
parts-based cnn with improved triplet loss function.
In
CVPR, pages 1335–1344, 2016. 2

[4] Jason V Davis, Brian Kulis, Prateek Jain, Suvrit Sra, and
Inderjit S Dhillon. Information-theoretic metric learning. In
ICML, pages 209–216, 2007. 2

[5] Yueqi Duan, Wenzhao Zheng, Xudong Lin, Jiwen Lu, and
Jie Zhou. Deep adversarial metric learning. In CVPR, pages
2780–2789, 2018. 1, 2, 6, 8

[6] Andrea Frome, Yoram Singer, Fei Sha, and Jitendra Ma-
lik. Learning globally-consistent local distance functions
for shape-based image retrieval and classiﬁcation. In ICCV,
pages 1–8, 2007. 2

[7] Weifeng Ge, Weilin Huang, Dengke Dong, and Matthew R
Scott. Deep metric learning with hierarchical triplet loss. In
ECCV, pages 269–285, 2018. 2

[8] Amir Globerson and Sam T Roweis. Metric learning by col-

lapsing classes. In NIPS, pages 451–458, 2006. 2

[9] Raia Hadsell, Sumit Chopra, and Yann LeCun. Dimension-
ality reduction by learning an invariant mapping. In CVPR,
pages 1735–1742, 2006. 2, 7

[10] Ben Harwood, Vijay Kumar B G, Gustavo Carneiro, Ian
Reid, and Tom Drummond. Smart mining for deep metric
learning. In ICCV, pages 2840–2848, 2017. 2

[11] Kaiming He, Xiangyu Zhang, Shaoqing Ren, and Jian Sun.
In CVPR,

Deep residual learning for image recognition.
pages 770–778, 2016. 1

[12] Junlin Hu, Jiwen Lu, and Yap-Peng Tan. Discriminative deep
metric learning for face veriﬁcation in the wild. In CVPR,
pages 1875–1882, 2014. 2

[13] Chen Huang, Chen Change Loy, and Xiaoou Tang. Local
In NIPS, pages

similarity-aware deep feature embedding.
1262–1270, 2016. 2

[14] Hyo Jin Kim, Enrique Dunn, and Jan-Michael Frahm.
Learned contextual feature reweighting for image geo-
localization. In CVPR, pages 3251–3260, 2017. 1

[15] Wonsik Kim, Bhavya Goyal, Kunal Chawla, Jungmin Lee,
and Keunjoo Kwon. Attention-based ensemble for deep met-
ric learning. In ECCV, pages 760–777, 2018. 2

[16] Jonathan Krause, Michael Stark, Jia Deng, and Li Fei-Fei.
3d object representations for ﬁne-grained categorization. In
ICCVW, pages 554–561, 2013. 2, 6

[17] Alex Krizhevsky, Ilya Sutskever, and Geoffrey E Hinton.
Imagenet classiﬁcation with deep convolutional neural net-
works. In NIPS, pages 1097–1105, 2012. 1

[18] Marc T Law, Nicolas Thome,

and Matthieu Cord.
Quadruplet-wise image similarity learning. In ICCV, pages
249–256, 2013. 2

[19] Marc T Law, Raquel Urtasun, and Richard S Zemel. Deep
In ICML, pages 1985–1994,

spectral clustering learning.
2017. 1

[20] Xudong Lin, Yueqi Duan, Qiyuan Dong, Jiwen Lu, and Jie
In ECCV, pages

Zhou. Deep variational metric learning.
689–704, 2018. 2

[21] Tomasz Malisiewicz, Abhinav Gupta, and Alexei A Efros.
Ensemble of exemplar-svms for object detection and beyond.
In ICCV, pages 89–96, 2011. 2

[22] Yair Movshovitz-Attias, Alexander Toshev, Thomas K. Le-
ung, Sergey Ioffe, and Saurabh Singh. No fuss distance met-
ric learning using proxies. In ICCV, pages 360–368, 2017.
2

[23] Michael Opitz, Georg Waltner, Horst Possegger, and Horst
Bischof. Bier - boosting independent embeddings robustly.
In ICCV, pages 5189–5198, 2017. 1, 2

[24] Olga Russakovsky, Jia Deng, Hao Su, Jonathan Krause, San-
jeev Satheesh, Sean Ma, Zhiheng Huang, Andrej Karpathy,
Aditya Khosla, Michael Bernstein, et al.
Imagenet large
scale visual recognition challenge.
IJCV, 115(3):211–252,
2015. 6

[25] Florian Schroff, Dmitry Kalenichenko, and James Philbin.
Facenet: A uniﬁed embedding for face recognition and clus-
tering. In CVPR, pages 815–823, 2015. 2, 3, 5, 7

[26] Hailin Shi, Yang Yang, Xiangyu Zhu, Shengcai Liao, Zhen
Lei, Weishi Zheng, and Stan Z Li. Embedding deep metric
for person re-identiﬁcation: A study against large variations.
In ECCV, pages 732–748, 2016. 1

[27] Karen Simonyan and Andrew Zisserman. Very deep convo-
lutional networks for large-scale image recognition. arXiv,
abs/1409.1556, 2014. 1

[28] Kihyuk Sohn.

Improved deep metric learning with multi-
class n-pair loss objective. In NIPS, pages 1857–1865, 2016.
2, 3, 5, 7

[29] Hyun Oh Song, Stefanie Jegelka, Vivek Rathod, and Kevin
Murphy. Deep metric learning via facility location. In CVPR,
pages 2206–2214, 2017. 2, 6

[30] Hyun Oh Song, Yu Xiang, Stefanie Jegelka, and Silvio
Savarese. Deep metric learning via lifted structured feature
embedding. In CVPR, pages 4004–4012, 2016. 1, 2, 6, 7

[31] Christian Szegedy, Wei Liu, Yangqing Jia, Pierre Sermanet,
Scott E Reed, Dragomir Anguelov, Dumitru Erhan, Vincent
Vanhoucke, and Andrew Rabinovich. Going deeper with
convolutions. In CVPR, pages 1–9, 2015. 1, 6

[32] Evgeniya Ustinova and Victor Lempitsky. Learning deep
embeddings with histogram loss. In NIPS, pages 4170–4178,
2016. 2

[33] Laurens Van Der Maaten. Accelerating t-sne using tree-

based algorithms. JMLR, 15(1):3221–3245, 2014. 8

[34] Nam Vo, Nathan Jacobs, and James Hays. Revisiting im2gps
in the deep learning era. In ICCV, pages 2640–2649, 2017.
1

[35] Nam N Vo and James Hays. Localizing and orienting street
In ECCV, pages 494–509,

views using overhead imagery.
2016. 1

[36] Catherine Wah, Steve Branson, Peter Welinder, Pietro Per-
ona, and Serge J Belongie. The Caltech-UCSD Birds-200-

80

2011 dataset. Technical Report CNS-TR-2011-001, Califor-
nia Institute of Technology, 2011. 2, 6

[37] Faqiang Wang, Wangmeng Zuo, Liang Lin, David Zhang,
and Lei Zhang.
Joint learning of single-image and cross-
image representations for person re-identiﬁcation. In CVPR,
pages 1288–1296, 2016. 1

[38] Jiang Wang, Yang Song, Thomas Leung, Chuck Rosenberg,
Jingbin Wang, James Philbin, Bo Chen, and Ying Wu. Learn-
ing ﬁne-grained image similarity with deep ranking.
In
CVPR, pages 1386–1393, 2014. 2

[39] Jian Wang, Feng Zhou, Shilei Wen, Xiao Liu, and Yuanqing
Lin. Deep metric learning with angular loss. In ICCV, pages
2593–2601, 2017. 2, 7

[40] Xiaolong Wang and Abhinav Gupta. Unsupervised learning
of visual representations using videos. In ICCV, pages 2794–
2802, 2015. 2

[41] Kilian Q Weinberger and Lawrence K Saul. Distance met-
ric learning for large margin nearest neighbor classiﬁcation.
JMLR, 10(2):207–244, 2009. 2, 7

[42] Chao-Yuan Wu, R Manmatha, Alexander J Smola, and
Philipp Kr¨ahenb¨uhl. Sampling matters in deep embedding
learning. In ICCV, pages 2859–2867, 2017. 2

[43] Hong Xuan, Richard Souvenir, and Robert Pless. Deep ran-
In ECCV, pages

domized ensembles for metric learning.
723–734, 2018. 2

[44] Baosheng Yu, Tongliang Liu, Mingming Gong, Changxing
Ding, and Dacheng Tao. Correcting the triplet selection bias
for triplet loss. In ECCV, pages 71–87, 2018. 2

[45] Rui Yu, Zhiyong Dou, Song Bai, Zhaoxiang Zhang,
Yongchao Xu, and Xiang Bai. Hard-aware point-to-set deep
metric for person re-identiﬁcation. In ECCV, pages 188–204,
2018. 2

[46] Yuhui Yuan, Kuiyuan Yang, and Chao Zhang. Hard-aware
deeply cascaded embedding. In ICCV, pages 814–823, 2017.
2

[47] Yiru Zhao, Zhongming Jin, Guo-jun Qi, Hongtao Lu, and
Xian-sheng Hua. An adversarial approach to hard triplet gen-
eration. In ECCV, pages 501–517, 2018. 2

[48] Jiahuan Zhou, Pei Yu, Wei Tang, and Ying Wu. Efﬁcient on-
line local metric adaptation via negative samples for person
re-identiﬁcation. In ICCV, pages 2420–2428, 2017. 1

81

