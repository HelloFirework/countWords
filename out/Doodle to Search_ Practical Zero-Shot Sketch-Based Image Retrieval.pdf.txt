Doodle to Search: Practical Zero-Shot Sketch-based Image Retrieval

Sounak Dey∗, Pau Riba∗, Anjan Dutta, Josep Llad´os

Yi-Zhe Song

Computer Vison Center, UAB, Spain

SketchX, CVSSP, University of Surrey, UK

{sdey,priba,adutta,josep}@cvc.uab.cat

y.song@surrey.ac.uk

Abstract

Fish

Frog

Crab

Owl

Sea-turtle

In this paper, we investigate the problem of zero-
shot sketch-based image retrieval (ZS-SBIR), where human
sketches are used as queries to conduct retrieval of photos
from unseen categories. We importantly advance prior arts
by proposing a novel ZS-SBIR scenario that represents a
ﬁrm step forward in its practical application. The new set-
ting uniquely recognizes two important yet often neglected
challenges of practical ZS-SBIR, (i) the large domain gap
between amateur sketch and photo, and (ii) the necessity
for moving towards large-scale retrieval. We ﬁrst contribute
to the community a novel ZS-SBIR dataset, QuickDraw-
Extended, that consists of 330, 000 sketches and 204, 000
photos spanning across 110 categories. Highly abstract
amateur human sketches are purposefully sourced to max-
imize the domain gap, instead of ones included in existing
datasets that can often be semi-photorealistic. We then for-
mulate a ZS-SBIR framework to jointly model sketches and
photos into a common embedding space. A novel strategy
to mine the mutual information among domains is specif-
ically engineered to alleviate the domain gap. External
semantic knowledge is further embedded to aid semantic
transfer. We show that, rather surprisingly, retrieval per-
formance signiﬁcantly outperforms that of state-of-the-art
on existing datasets that can already be achieved using a
reduced version of our model. We further demonstrate the
superior performance of our full model by comparing with a
number of alternatives on the newly proposed dataset. The
new dataset, plus all training and testing code of our model,
will be publicly released to facilitate future research†.

1. Introduction

In the context of retrieval, sketch modality has shown
great promise thanks to the pervasive nature of touchscreen
devices. Consequently, research on sketch-based image re-
trieval (SBIR) has ﬂourished, with many great examples
addressing various aspects of the retrieval process: ﬁne-

∗These authors contributed equally to this work.
†http://dag.cvc.uab.es/doodle2search/

]
7
2
[

y
h
c
t
e
k
S

]
6
[
n

i
l
r
e
B
U
T

w
a
r
D
k
c
i
u
Q

Figure 1. Qualitative comparison of sketch datasets, columns show
examples belonging the same class. Sketchy, TUBerlin and Quick-
Draw datasets orderly contain sketches with increasing level of
abstraction. It is worth noting that despite being the most abstract
dataset, QuickDraw sketches can still be reliably recognised.

grained matching [37, 30, 24], large-scale hashing [17, 16],
cross-modal attention [5, 30] to name a few.

However, a common bottleneck identiﬁed by almost all
sketch researches is that of data scarcity. Different to pho-
tos that can be effortlessly crawled for free, sketches have
to be drawn one by one by human being. As a result,
existing SBIR datasets suffer in both volume and variety,
leaving only less than thousand of sketches per category,
with maximum number of classes limited to few hundreds.
This largely motivated the problem of zero-shot SBIR (ZS-
SBIR), where one wishes to conduct SBIR on object cate-
gories without having the training data. ZS-SBIR is increas-
ingly being regarded as an important component in unlock-
ing the practical application of SBIR, since million-scale
datasets that have been used to train commercial photo-only
systems [4] might not be feasible.

The problem of ZS-SBIR is extremely challenging.

It
shares all challenges laid out in conventional SBIR: (i) large
domain gap between sketch and image, and (ii) high degree

12179

of abstraction found in human sketches as a result of vari-
ant drawing skills and visual interpretations. Additionally,
it also needs the semantic transference from the seen to un-
seen categories for the purpose of zero-shot learning. Over
and above all, in this paper, we are interested in moving to-
wards the practical adaptation of ZS-SBIR technology. For
that, a more appropriate dataset that best capture all these
challenges is required.

Therefore, our ﬁrst contribution is a new dataset to simu-
late the real application scenario of ZS-SBIR, which should
satisfy the following requirements. First, the dataset needs
to mimic the real-world abstraction gap between sketch and
photo. Such amateur sketches are very different from the
ones currently studied by existing datasets, which are ei-
ther too photo-realistic [7] or produced by recollection of
a reference images [27] (Figure 1 offers a comparative ex-
ample). Second, in order to learn a reliable cross-domain
embedding between amateur sketch and photo, the dataset
much faithfully capture of a full variety of sketch samples
from users having various drawing skills. Our proposed
dataset, QuickDraw-Extended, contains 330, 000 sketches
and 204, 000 photos in total spanning across 110 categories.
In particular, it includes 3, 000 amateur sketches per cate-
gory carefully sourced from the recently released Google
Quickdraw dataset [12] – six times more than the next
largest. It also has a search space stretching to 166million
total comparisons in the test set, compared to Sketchy-
Extended and TUBerlin-Extended with just 10 million and
1.9 million, respectively.

This dataset and the real-world scenario it mimics, es-
sentially make the ZS-SBIR task more difﬁcult. This leads
to our second contribution which is a novel cross-domain
zero-shot embedding model that addresses all challenges
posed by this new setting. Our base network is a visually-
attended triplet ranking model that is commonly known in
the SBIR community to produce state-of-the-art retrieval
performances [37, 30]. To our surprise, just by adopting
such a triplet formulation, we can already achieve retrieval
performances drastically better than that of the previously
reported ZS-SBIR results on commonly used datasets. We
attribute this phenomena to previous datasets being too sim-
plistic in terms of the cross-domain abstraction gap and the
diversity of sketch samples. This further justiﬁes the neces-
sity of a new practical dataset like ours. We then propose
two novel techniques to help learn a better cross-domain
transfer model. First, a domain disentanglement strategy
is designed to bridge gap between the domains by forcing
the network to learn a domain-agnostic embedding, where
a Gradient Reversal Layer (GRL) [8] encourages the en-
coder to extract mutual information from sketches and pho-
tos. Second, a novel semantic loss to ensure that semantic
information is preserved in the obtained embedding. By ap-
plying a GRL only to the negative samples at the input of

the semantic decoder helps the encoder network to separate
the semantic information of similar classes.

Extensive experiments are ﬁrst carried out on the two
commonly used ZS-SBIR datasets, TUBerlin-Extended [6]
and Sketchy-Extended [27]. The results show that the even
a reduced version of our model can outperform current
state-of-the-arts by a signiﬁcant margin. The superior per-
formance of the proposed method is further validated on our
own dataset, with ablative studies to draw insights towards
each of the proposed system components.

2. Related Work

SBIR Datasets. One of the key barriers towards large-scale
SBIR research is the lack of appropriate benchmarks. The
Sketchy dataset [27] is the mostly used one for this pur-
pose, which contains 75,471 hand-drawn sketches of 12,500
object photos belonging to 125 different categories. Later,
Liu et al. [17] collected 60,502 natural images from Im-
ageNet [4] in order to ﬁt the task of large-scale SBIR.
This dataset having contained highly detailed or less ab-
stract sketches, models trained on Sketchy have high chance
of getting collapsed in real life scenario. Two more ﬁne-
grained SBIR datasets with paired sketches and images
are shoe and chair datasets which were proposed in [37].
The shoe dataset contains altogether 6648 sketches and
2000 photos, whereas, the chair dataset altogether con-
tains 297 sketches and photos. However, being ﬁne-grained
pairs these two datasets also have similar disadvantages as
the Sketchy dataset. TU-Berlin [6] being the other popu-
lar dataset originally contains 250 classes of hand-drawn
sketches, where each class roughly contains 80 instances.
It was extended with real images by [38] for SBIR pur-
poses. This dataset has a lot of confusion regarding the class
hierarchy, for an example, swan, seagull, pigeon,
parrot, duck, penguin, owl have substantial visual
similarity and commonality with standing bird and
flying bird which are another separate categories of
the TU-Berlin dataset. To obliterate, these difﬁculties faced
by the SBIR works, in this paper, we introduce QuickDraw-
Extended dataset, where we take the sketch classes of the
Google QuickDraw dataset [12] and provide the corre-
sponding set of images to facilitate the training of large-
scale SBIR system.
Sketch-based Image Retrieval (SBIR). The main chal-
lenge that most of the SBIR tasks address is bridging the
domain gap between sketch and natural image.
In litera-
ture, these existing methods can be roughly grouped into
two categories: hand crafted and cross-modal deep learning
methods. The hand-crafted techniques mostly work with
Bag-of-Words representations of sketch and edge map of
natural image on top of some off-the-shelf features, such
as, SIFT [19], Gradient Field HOG [10], Histogram of
Edge Local Orientations [25] or Learned Key Shapes [26])

2180

etc. This domain shift issue is further addressed by cross-
domain deep learning-based methods [27, 37], where they
have used classical ranking losses, such as, contrastive loss,
triplet loss [32] or more elegant HOLEF loss [30] within
a siamese like network. Based on the problem at hand,
two separated tasks have been identiﬁed: (1) Fine-grained
SBIR (FG-SBIR) aims to capture ﬁne-grained similarities of
sketch and photo [15, 27, 37] and (2) Coarse-grained SBIR
(CG-SBIR) performs a instance level search across multiple
object categories [38, 10, 11, 31, 38], which has received a
lot of attention due to its importance. Realising the need of
large-scale SBIR, some researchers have proposed a variant
of cross-modal hashing framework for the same [17, 39],
which also showed promising results in SBIR scenario. In
contrast, our proposed model overcomes this domain gap by
mining the modality agnostic features using a domain loss
along with a GRL.

Zero-Shot Sketch-based Image Retrieval (ZS-SBIR).
Early works on zero-shot learning (ZSL) were mostly fo-
cused on attribute based recognition [14], which is later
augmented by another major line that focus on learning a
joint embedding space for image feature representation and
class semantic descriptor [3, 34, 13, 35, 18]. Depending on
the selection of joint embedding space and type of projec-
tion function utilised between the visual to semantic space,
existing models can be divided into three groups: (i) pro-
jected from visual feature space to semantic space [14, 21],
(ii) projected from semantic space to the visual feature
space [3], and (iii) an intermediate space that both are si-
multaneously projected to [40]. In contrast to these existing
works, our model can be seen as a combination of the ﬁrst
and second groups, where the embedding is on the visual
feature space, but asked to additionally recover its embod-
ied semantics with a decoder.

Although SBIR and ZSL have been extensively studied
among the research community, very few works have stud-
[28] propose a multi-
ied their combination. Shen et al.
modal network to mitigate the sketch-image heterogeneity
and enhance semantic relations. Yelamarthi et al. [36] re-
sort to a deep conditional generative model, where a sketch
is taken as input and learned to generate its photo features
by stochastically ﬁlling the missing information. The main
motivation behind ZS-SBIR lies with sketches being costly
and labour-intensive to source – sketches need to be individ-
ually drawn by hand, other than crawled for free from the
internet. To enable rapid deployment on categories where
training sketches are not readily available, it is important to
leverage on existing sketch data from other categories. The
key difference between ZS-SBIR and other ZS tasks, which
is also the main difﬁculty of the problem, lies with the ad-
ditional modality gap between sketch and photo.

3. QuickDraw-Extended Dataset

Existing datasets do not cover all the challenges derived
from a ZS-SBIR system. Therefore, we propose a new
dataset named QuickDraw-Extended Dataset that is spe-
cially designed for this task. First we review the existing
datasets in the literature used for ZS-SBIR and motivate
the purpose of the new dataset. Thus, we provide a large-
scale ZS-SBIR dataset that overcomes the main problems of
the existing ones. Existing datasets were not originally de-
signed for a ZS-SBIR scenario, but they have been adapted
by a redeﬁning the partitions setup. In addition, the main
limitations that we overcome with the new dataset are (i) the
large domain gap between amateur sketch and photo, and
(ii) the necessity for moving towards large-scale retrieval.
Sketchy-Extended Dataset [27]: Originally created as a
ﬁne-grained association between sketches to particular pho-
tos for ﬁne-grained retrieval. This dataset has been adapted
to the task of ZS-SBIR. On one hand, Shen et al. [28] pro-
posed to set aside 25 random classes as a test set whereas
the training is performed in the rest 100 classes. On the
other hand, Yelamarthi et al. [36] proposed a different par-
tition of 104 train classes and 21 test classes in order to
make sure that test is not present in the 1,000 classes of
ImageNet. Its main limitation for the task of ZS-SBIR is
its ﬁne-grained nature, i.e., each sketch has a correspond-
ing photo that was used as reference at drawing time. Thus,
participants tended to draw the objects in a realistic fash-
ion, producing sketches resembling that of a true edge-map
very well. This essentially narrows the cross-domain gap
between sketch and photo.
TUBerlin-Extended Dataset [6]: It is a dataset that was
created for sketch classiﬁcation and recognition bench-
marking.
In this case, drawers were asked to draw the
sketches giving them only the name of the class. This allows
a semantic connection among sketches and avoids possible
biases. However, the number of sketches is scarce, con-
sidering the variability among the observations of a con-
cept in the real world. Also, some of the design decisions
on the selection of object categories prevent it to be ade-
quate for our zero-shot setting: (i) classes are deﬁned both
in terms of a concept and an attribute (e.g., seagull,
flying-bird); (ii) different WordNet levels are used,
i.e. there are classes that are semantically included in others
(e.g., mug, beer-mug).

3.1. The Dataset

Taking into account the limitations of the previously
described datasets in a ZS-SBIR scenario, we contribute
to the community a novel large-scale dataset, QuickDraw-
Extended. We identiﬁed the following challenges of a prac-
tical ZS-SBIR, (i) the large domain gap between amateur
sketch and photo, and (ii) the necessity for moving towards
large-scale retrieval. According to this, the new dataset

2181

Table 1. Dataset comparison in terms of their size. Partition is pre-
sented in terms of number of classes used for each set, moreover, #
Comparisons stands for the number of comparisons sketch-image
performed in test.

Sketchy [27] TUBerlin [6] QuickDraw

Partition
(tr+va, te)

(104, 21)

(220, 30)

(80, 30)

# Sketch/class
# Image/class
# Comparisons ∼ 10Mill. ∼ 1.9Mill. ∼ 166Mill.

∼ 1, 854

600-700

∼ 764a

3, 000

500

80

aExtremely imbalanced

must fulﬁl the following aspects: (i) to not have a direct
one-to-one correspondence between sketches and images,
i.e. sketches can be rough conceptual abstractions of im-
ages produced in an amateur drawing style; (ii) to avoid
ambiguities and overlapping classes; (iii) large intra-class
variability provided by the high abstraction level of differ-
ent drawers.

In order to accomplish these objectives, we took advan-
tage of the Google Quick, Draw! [12] data which is a huge
collection of drawings (50 millions) belonging to 345 cat-
egories obtained from the Quick, Draw!‡ game.
In this
game, the user is asked to draw a sketch of a given cate-
gory while the computer tries to classify them. The way
sketches are collected provides the dataset a large variabil-
ity, derived from human abstraction. Moreover, it addresses
the large domain gap between non-expert drawers and pho-
tos that is not considered in previous benchmarks. Hence,
we propose to make use of a subset of sketches to con-
struct a novel dataset for large-scale ZS-SBIR containing
110 categories (80 for training and 30 for testing). Classes
such as circle of zigzag are directly discarded because
they can not be used in an appropriate SBIR. As a retrieval
gallery, we provide images extracted from Flickr tagged
with the corresponding label. Manual ﬁltering is performed
to remove outliers. Moreover, following the idea introduced
in [36] for the Sketchy-Extended dateset, we provide a test
split which forces that test classes are not present in Im-
ageNet in case of using pre-trained models. Finally, this
dataset consists of 330,000 sketches and 204,000 photos
moving towards a large-scale retrieval. We consider that
this dataset will provide better insights about the real per-
formance of ZS-SBIR in a real scenario.

Table 1 provides a comparison of the three benchmarks
for the task of ZS-SBIR. To the best of our knowledge,
this is the ﬁrst time that a real large-scale problem is ad-
dressed providing 6 times more sketches and more than the
double of photos per each class. Qualitatively QuickDraw-
Extended provides a high abstraction level than previous

‡https://quickdraw.withgoogle.com/

Fish

Frog

Crab

Owl

]
7
2
[
y
h
c
t
e
k
S

]
6
[
n
i
l
r
e
B
U
T

w
a
r
D
k
c
i

u
Q

Figure 2. Qualitative comparison of the datasets. The different lev-
els of abstraction in the sketches can be appreciated. From the top
to the bottom, the ﬁgure also shows the decrease in the alignment
between sketches and images.

benchmarks as it is shown in Figure 2.

4. A ZS-SBIR framework

4.1. Problem Formulation

i=1 and Y = {yi}M

Let C be the set of all possible categories in a given
dataset; X = {xi}N
i=1 be the set of pho-
tos and sketches respectively; lx : X → C and ly : Y → C
be two labelling functions for photos and sketches respec-
tively. Such that give an input sketch an optimal ranking
of gallery images can be obtained. In a zero-shot frame-
work, training and testing sets are divided according to seen
C s ⊂ C and unseen C u ⊂ C categories, where Cs∩Cu = ∅.
Thus, the model needs to learn an aligned space between
sketches and photos to perform well on test data whose
classes have never been used in training. We deﬁne the set
of seen and unseen photos as X s = {xi; lx(xi) ∈ Cs}N
i=1
and X u = X \ X s. We deﬁne analogously the seen and
unseen sets for sketches, denoted as Y s and Y u.

The proposed framework is divided in two main compo-
nents. The encoder transforms the input image to the cor-
responding embedding space. The second component is the
cost function which guides the learning process to provide

2182

Figure 3. Proposed architecture for ZS-SBIR which maps sketches and photos in a common embedding space. It combines three losses:
(i) triplet loss, to learn a ranking metric; (ii) domain loss to merge images and sketches to an indistinguishable space making use of a GRL;
(iii) semantic loss forces the embeddings to contain semantic information by reconstructing the word2vec embedding of the class. It also
helps to distinguish semantically similar classes by means of a GRL on the negative example (best viewed in color).

the embedding with the desired properties. Figure 3 outlines
the proposed approach.

4.2. Encoder Networks

Given a distance function d(·, ·), the aim of our frame-
work is to learn two embedding functions φ : X → RD
and ψ : Y → RD which respectively map the photo and
sketch domain into a common embedding space. Later,
these embedding functions are used in the retrieval task dur-
ing the test phase, therefore, they should possess a rank-
ing property related to the considered distance function.
Hence, given two photos x1, x2 ∈ X and a sketch y ∈ Y,
we expect the embedding fulﬁls the following condition:
d(φ(x1), ψ(y)) < d(φ(x2), ψ(y)), when lx(x1) = ly(y)
and lx(x2) 6= ly(y). In a retrieval scenario, our system is
able to provide a ranked list of images by the chosen dis-
In this framework, d has been set as ℓ2-
tance function.
distance. During training, the two embedding φ(·) and ψ(·)
are trained with multi-modal information, therefore they
presume to learn a modality free representation.

Our embedding functions φ(·) and ψ(·) are deﬁned as
two CNNs with attention where the last fully-connected
layer has been replaced to match the desired embedding
size D. The attention [33] mechanism helps our system
to localise the important features in both modalities. Soft-
attention is the widely used one because it is differentiable,
and hence it can be learned end-to-end with the rest of the
network. Our soft-attention model learns an attention mask
which assigns different weights to different regions of an
image given a feature map. These weights are used to high-
light important features, therefore, given an attention mask

att and a feature map f , the output of the attention module
is computed by f + f · att. The attention mask is com-
puted by means of 1 × 1 convolution layers applied on the
corresponding feature map.

4.3. Learning objectives

The learning objective of the proposed framework com-
(i) Triplet Loss; (ii) Domain Loss, (iii) Semantic
bines:
Loss. These objective functions provide visual and seman-
tic information to the encoder network. Let us consider a
triplet {a, p, n} where a ∈ Y s, p ∈ X s and n ∈ X s are re-
spectively the anchor, positive and negative samples during
the training. Moreover, lx(p) = ly(a) and lx(n) 6= ly(a).
Triplet Loss: This loss aims to reduce the distance be-
tween embedded sketch and image if they belong to the
same class and increase it if they belong to different classes.
For simplicity, if we deﬁne the distances between the sam-
ples as δ+ = kψ(a) − φ(p)k2 and δ− = kψ(a) − φ(n)k2
for the positive and negative samples respectively, then, the
ranking loss for a particular triplet can be formulated as
λ(δ+, δ−) = max{0, µ+δ+ −δ−} where µ > 0 is a margin
parameter. Batch-wise, the loss is deﬁned as:

Lt =

1
N

N

X

i=1

λ(δi

+, δi

−).

(1)

This loss measures the violation of the ranking order of the
embedded features. Therefore, the order aimed by this loss
is δ− > δ+ + µ, if this is the case, the network is not up-
dated, otherwise, the weights of the network are updated
accordingly. Triplet loss provides a metric space with rank-
ing properties based on visual features.

2183

Domain Loss: Triplet loss mentioned above does not ex-
plicitly enforce the mapping of sketch and image samples
to a common space. Therefore, at this end, to ensure that
the obtained embedding belong to the same space, we pro-
pose to use a domain adaptation loss [8]. The basic idea
of this loss is to obtain a domain-agnostic embedding that
does not contain enough information to decide whether it
comes from a sketch or photo. Given the embedding φ(·)
and ψ(·), we make use of a Multilayer Perceptron (MLP)
as a binary classiﬁer trying to predict which was the initial
domain. Purposefully, in order to create indistinguishable
embedding we use a GRL deﬁned as Rλ(·), which applies
the identity function during the forward pass Rλ(x) = x,
whereas during the backward pass it multiplies the gradi-
ents by the meta-parameter −λ, d Rλ
d x = −λI. This opera-
tion reverses the sign of the gradient that ﬂows through the
CNNs. In this way, we encourage our encoders to extract
the shared representation from sketch and photo. For this
loss, we deﬁne a meta-parameter λd that changes from 0
(only trains the classiﬁer but does not update the encoder
network) to 1 during the training according to a deﬁned
function.
In our case it is deﬁned according to the iter-
ation i as zλ(i) = (i − 5)/20. Following the notation,
f : RD → [0, 1] be the MLP and e ∈ RD an embed-
ding coming from the encoders network. Then we can
deﬁne the binary cross entropy of one of the samples as
lt(e) = t log(f (Rλd (e))) + (1 − t) log(1 − f (Rλd (e))),
where e is the embedding obtained by the encoder network
and t is 0 and 1 for sketch and photo domains respectively.
Hence, the domain loss is deﬁned as:

Ld =

1
3N

N

X

i=1

(l0(ψ(ai)) + l1(φ(pi)) + l1(φ(ni)))

(2)

Semantic Loss: A decoder network trying to reconstruct
the semantic information of the corresponding category
from the generated embedding is proposed. This recon-
struction forces that the semantic information is encoded
in the obtained embedding.
In this case, we propose to
minimise the cosine distance with the reconstructed feature
vector and the semantic representation of the category. In-
spired by the idea presented by Gonzalez et al. [9] for cross-
domain disentanglement, we propose to exploit the negative
sample to foster the difference between similar semantic
categories. Hence, we apply a GRL Rλs (·) to the negative
sample at the input of the semantic decoder and we train it
to reconstruct the semantics of the positive example. The
idea is to help the encoder network to separate the semantic
information of similar classes. In this case, we decided to
keep the meta-parameter λs to a ﬁxed value among all the
training, in particular, it was set to 0.5.

Let c ∈ Cs be the corresponding category of the an-
chor a. The semantics of this category are obtained by the

word2vec [20] embedding trained on part of Google News
dataset (∼ 100 billion words), GloVe [23] and fastText [1]
(more results are available in supplementary materials ). Let
g : RD → R300 be the semantic reconstruction network and
s = embedding(c) ∈ R300 be the semantics of the given
category. Hence, given an image embedding e ∈ RD the co-
||g(e)||·||s||(cid:17). The
sine loss is deﬁned as lc(e, s) = 1
semantic loss is deﬁned as follows:

2 (cid:16)1 − g(e)st

Ls =

1
3N

N

X

i=1

(lc(ψ(ai), si) + lc(φ(pi), si)

+lc(Rλs (φ(ni)), si))

(3)

Therefore, the whole network will be trained by a combina-
tion of three proposed loss functions.

L = α1Lt + α2Ld + α3Ls,

(4)

where the weighting factors α1, α2 and α3 are equal in
our model. Algorithm 1 presents the training algorithm fol-
lowed in this work. Γ(·) denotes the optimiser function.

Algorithm 1 Training algorithm for the proposed model .

Input: Photo-Sketch data {X , Y}; Class semantics S;

λs = 0.5 and max training iterations T

Output: Encoder networks parameters {Θφ, Θψ}.

1: repeat
2:

3:

4:

5:

Get a random mini-batch {yi, xp

i , si}NB
i belong to the same class and xn

yi, xp

i , xn

i=1; where
i does not.

λd ← clip(zλ(·), min = 0, max = 1)
L ← Eq. 4
Θ ← Θ − Γ(∇ΘL)

6:
7: until Convergence or max training iterations T

5. Experimental Validation

This Section experimentally validates the proposed ZS-
SBIR approach on three benchmarks Sketchy-Extended,
TUBerlin-Extended and QuickDraw-Extended, highlighting
the importance of the newly introduced dataset which is
more realistic for practical SBIR purpose. A detailed com-
parison with the state-of-the-art is also presented.

5.1. Zero shot Experimental Setting

Implementation details: Our CNN-based encoder net-
works φ(·) and ψ(·) make use of a ImageNet pre-trained
VGG-16 [29] architecture. This can be replaced by any
model to enhance the extracted feature quality. Both, do-
main classiﬁer f (·) and semantic reconstruction g(·) of the
proposed model makes use of 3 fully connected layers with
ReLU activation functions. The whole framework was im-
plemented with PyTorch [22] deep learning tool and is train-
able on single Pascal Titan X GPU card.

2184

Table 2. Comparison against the state-of-the-art with that of the proposed model. Note: the same train and test split are used for all
experiments on CVAE [36] and ours. ZSIH [28] did not report the speciﬁc details on their split (other than 25 classes were used for
testing), and we could not produce their results on QuickDraw-Extended due to the lack of publicly available code.

Method

Sketchy-Extended [27]

TUBerlin-Extended [6]

QuickDraw-Extended

mAP mAP@200 P@200

mAP mAP@200 P@200

mAP mAP@200 P@200

ZSIH [28]
CVAE [36]

0.2540a
0.1959

−

−

0.2250

0.3330

Ours

0.3691 0.4606

0.3704

0.2200
0.0050

0.1094

−

−

Not able to produce

0.0090

0.0030

0.0030

0.0060

0.0030

0.1568

0.1208

0.0752

0.0901

0.0675

aUsing a random partition of 25 test categories following the setting proposed in [26], we obtained 0.3521 for our model.

Table 3. Ablation study for the proposed model. As baseline, the triplet loss is used and the different modules are incrementally added.

Attn. Dom. Sem.

Sketchy-Extended [27]

TUBerlin-Extended [6]

QuickDraw-Extended

mAP mAP@200 P@200

mAP mAP@200 P@200

mAP mAP@200 P@200

-
X

-
-
X X

0.3020
-
0.3207
-
0.3256
-
X 0.3392
X X X 0.3691

X

-

0.3890
0.4150
0.4113
0.4146
0.4606

0.3091
0.3342
0.3444
0.3586
0.3704

0.0590
0.0729
0.0845
0.1055
0.1094

0.1040
0.1141
0.1264
0.1496
0.1568

0.0682
0.1002
0.1080
0.1115
0.1208

0.0354
0.0456
0.0651
0.0693
0.0752

0.0546
0.0635
0.0881
0.0896
0.0901

0.0454
0.0496
0.0615
0.0625
0.0675

Training setting: Our system uses triplets to utilise the in-
herent ranking order. The training batches are constructed
in a way so that it can take the advantage of the semantic in-
formation in order to mine hard negative samples for a given
anchor class. This implies that semantically closer classes
will have a higher probability to be used during training and
thus they are likely to be disjoint in the ﬁnal embedding.
We trained our model following an early stopping strategy
in validation to provide the ﬁnal test result. The model is
trained end-to-end using the SGD [2] optimiser. The learn-
ing rate used throughout is 1e − 4. The epochs required to
train the model on different dataset is around 40.
Evaluation protocol: The proposed evaluation uses the
metrics used by Yelamarthi et al. [36]. Therefore, the evalu-
ation is performed taking into account the top 200 retrieved
samples. Moreover, we also provide metrics on the whole
dataset. Images labelled with the same category as that of
the query sketch, are considered as relevant. Note that this
evaluation does not consider visually similar drawings that
can be considered correct by human users. For the existing
datasets, we used the proposed splits in [36, 28].

5.2. Model Discussion

This section presents a comparative study with the
state-of-the-art followed by a discussion on the TUBerlin-
Extended results and ﬁnally the ablative study. As men-
tioned, our model is build on top of a triplet network. We
take this as a baseline and study the importance of the dif-
ferent components of the full model which includes the at-
tention mechanism, the semantic loss and the domain loss.

Comparison: Table 2 provides comparisons of our full
model results against those of the state-of-the-art. We report
a comparative study with regard to two methods presented
in Section 2, namely ZSIH [28] and CVAE [36]. Note that
we have not been able to reproduce the ZSIH model due
to lack of technical implementation details and the code be-
ing unavailable. Hence, the results on QuickDraw-Extended
dataset nor an evaluation using the top 200 retrieval could
be computed. The last row of the Table 2 shows the result of
our full model. From the Table 2 the results suggest the lim-
itation of the previous models regarding their ability in an
unconstrained domain where sketches have higher level of
abstractions. The CVAE [36] method trained with sketch-
image correspondence has difﬁculties to capture the intra-
class variability, the domain gap and also the ability to infer
unseen classes. The following conclusions are drawn: (i)
our base model outperforms all the state-of-the-art methods
in Sketchy-Extended Dataset; (ii) our model performs the
best overall on each metric and on almost all the datasets;
(iii) the gap between our model and the state-of-the-art
datasets is almost double in Sketchy-Extended Dataset; (iv)
the difference in the result in previous dataset points out the
need of a new well structured dataset for ZS-SBIR (v) the
new benchmark also provides the different aspects (i.e of se-
mantics, mutual information) that can play important role in
a real ZS-SBIR scenario; (vi) the evaluation shows the im-
portance of going towards large-scale ZS-SBIR where the
retrieval search space is in the range of 166 million compar-
isons (16 times of the current largest dataset).
Discussion on TUBerlin-Extended: As stated in Section 3,

2185

Sketchy [27]

QuickDraw

Query

Top-8 retrieved candidates

Query

Top-8 retrieved candidates

CVAE

[36]

Ours pear

CVAE

[36]

Ours door

skyscraper

helicopter

Figure 4. Top 8 image retrieval examples given a query sketch. All the examples correspond to a zero-shot setting, i.e. no example have
been seen in training. First row provides a comparison with CVAE [36] method against our pipeline. Note that in some retrieval cases,
for instance, door is confused with window images which can be true even for humans. Green and Red stands for correct and incorrect
retrievals. (Better viewed in pdf)

the results could be heavily affected by the chosen classes
for experiments. Since [28] did not report speciﬁc details
on their train and test split, we can not offer a fair compari-
son on TUBerlin-Extended. Instead, for both [36] and ours,
we resort to the commonly accepted median over random
splits setting. And it shows our method favourably beats
[36] by a clear margin. We did however observe a high
degree of ﬂuctuation over the different splits on TUBerlin-
Extended, which re-afﬁrms our speculation on how the cat-
egories included in TUBerlin-Extended might not be opti-
mal for the zero-shot setting (see Section 3). This could
explain the superior performance of [28], yet more experi-
ments are needed to conﬁrm such suspicion. Unfortunately,
again such experiments would not be possible without de-
tails on their train and test split.

Ablation study: Here, we investigate the contribution of
each component to the model, as well as other issues of the
architecture. The ﬁrst 5 rows of Table 3 present a study of
the contribution of each component to the whole proposed
model. From this Table we can draw the following conclu-
sions: (i) attention plays a major role in improving the base-
line result; (ii) the domain loss is able to alleviate to some
extend the domain gap, this is more remarkable in those
datasets where sketches are more abstract; (iii) as the difﬁ-
culty of the dataset increases, the semantic and the domain
losses start playing a major role in improving the baseline
result; (iv) semantics provide better extrapolation to unseen
data than domain loss which shows that either the mutual
information is very less or that the semantic information is
really needed in this extrapolation; (v) the poor performance
in the QuickDraw-Extended dataset shows that the practical
problem of ZS-SBIR is still indeed unsolved. It should be
noted, that the best model makes use of the three losses.

Qualitative: Some retrieval results are shown in Figure 4
for Sketchy-Extended and QuickDraw-Extended. We also

provide a qualitative comparison with CVAE proposed by
Yelamarthi et al. [36]. The qualitative results reinforce
that the combination of semantic, domain and triplet loss
fairs well in a dataset with substantial variances on visual
abstraction. We would also like to point out that the re-
trieved results for the class skyscraper show high visual
shape similarity with rectangle i.e. door and saw. The re-
trieved circular saw could also might be retrieved because
of the semantic rather than the visual similarity. Similar vi-
sual correspondences can also be noticed between the query
sketch helicopter and the retrieved result windmill.

6. Conclusions

This paper represents a ﬁrst step towards a practical ZS-
SBIR task. Previous works on this task do not address
some of the important challenges that appear when mov-
ing to an unconstrained retrieval and do not tackle with the
large domain gap between amateur sketch and photo.
In
this scenario, to overcome the lack of proper data, we have
contributed to the community a speciﬁcally designed large-
scale ZS-SBIR dataset, QuickDraw-Extended which pro-
vides highly abstract amateur sketches collected with the
Google Quick, Draw! game. Then, we have proposed a
novel ZS-SBIR system that combines visual as well as se-
mantic information to generate an image embedding. We
experimentally show that this novel framework overcomes
recent state-of-the-art methods in the ZS-SBIR setting.

Acknowledgements

Work supported by EU’s MSC grant No. 665919, Span-
ish grants FPU15/06264 and TIN2015-70924-C2-2-R; and
the CERCA Program/Generalitat de Catalunya. The Titan
X was donated by NVIDIA. This work was carried out dur-
ing research stay at SketchX Lab in QMUL.

2186

References

[1] Piotr Bojanowski, Edouard Grave, Armand Joulin, and
Tomas Mikolov. Enriching word vectors with subword in-
formation. TACL, 2017. 6

[2] L´eon Bottou. Large-scale machine learning with stochastic

gradient descent. In COMPSTAT. 2010. 7

[3] Soravit Changpinyo, Wei-Lun Chao, and Fei Sha. Predicting
visual exemplars of unseen classes for zero-shot learning. In
ICCV, 2017. 3

[4] J. Deng, W. Dong, R. Socher, L. Li, Kai Li, and Li Fei-
Imagenet: A large-scale hierarchical image database.

Fei.
In CVPR, 2009. 1, 2

[5] Sounak Dey, Anjan Dutta, Suman Kumar Ghosh, Ernest Val-
veny, Josep Llad´os, and Umapada Pal. Learning cross-modal
deep embeddings for multi-object image retrieval using text
and sketch. In ICPR, 2018. 1

[6] Mathias Eitz, James Hays, and Marc Alexa. How do humans

sketch objects? In SIGGRAPH, 2012. 1, 2, 3, 4, 7

[7] Mathias Eitz, Kristian Hildebrand, Tamy Boubekeur, and
Marc Alexa. Sketch-based image retrieval: Benchmark and
bag-of-features descriptors.
IEEE transactions on VCG,
pages 1624–1636, 2011. 2

[8] Yaroslav Ganin and Victor Lempitsky. Unsupervised domain

adaptation by backpropagation. In ICML, 2015. 2, 6

[9] Abel Gonzalez-Garcia, Joost van de Weijer, and Yoshua Ben-
gio. Image-to-image translation for cross-domain disentan-
glement. NeurIPS, 2018. 6

[10] Rui Hu and John Collomosse. A performance evaluation of
gradient ﬁeld hog descriptor for sketch based image retrieval.
CVIU, 117(7):790–806, 2013. 2, 3

[11] Stuart James, Manuel J Fonseca, and John Collomosse.
Reenact: Sketch based choreographic design from archival
dance footage. In ICMR, 2014. 3

[12] Jonas Jongejan, Henry Rowley, Takashi Kawashima, Jong-
min Kim, and Nick Fox-Gieg. The quick, draw! - a.i. exper-
iment. https://quickdraw.withgoogle.com, 2016. 2, 4

[13] Nour Karessli, Zeynep Akata, Bernt Schiele, Andreas
Bulling, et al. Gaze embeddings for zero-shot image clas-
siﬁcation. In CVPR, 2017. 3

[14] Christoph H Lampert, Hannes Nickisch, and Stefan Harmel-
ing. Attribute-based classiﬁcation for zero-shot visual object
categorization. IEEE PAMI, 36(3):453–465, 2014. 3

[15] Yi Li, Timothy M Hospedales, Yi-Zhe Song, and Shaogang
Gong. Fine-grained sketch-based image retrieval by match-
ing deformable part models. In BMVC, 2014. 3

[16] Yanan Li, Donghui Wang, Huanhang Hu, Yuetan Lin, and
Yueting Zhuang. Zero-shot recognition using dual visual-
semantic mapping paths. In CVPR, 2017. 1

[17] Li Liu, Fumin Shen, Yuming Shen, Xianglong Liu, and Ling
Shao. Deep sketch hashing: Fast free-hand sketch-based im-
age retrieval. In CVPR, 2017. 1, 2, 3

[18] Yang Long, Li Liu, Yuming Shen, Ling Shao, and J Song.
Towards affordable semantic searching: Zero-shot. retrieval
via dominant attributes. In AAAI, 2018. 3

[19] David G Lowe. Object recognition from local scale-invariant

features. In ICCV, 1999. 2

[20] Tomas Mikolov, Kai Chen, Greg Corrado, and Jeffrey Dean.
Efﬁcient estimation of word representations in vector space.
In ICLR, 2013. 6

[21] Mohammad Norouzi, Tomas Mikolov, Samy Bengio, Yoram
Singer, Jonathon Shlens, Andrea Frome, Greg S Corrado,
and Jeffrey Dean. Zero-shot learning by convex combination
of semantic embeddings. In ICLR, 2014. 3

[22] Adam Paszke, Sam Gross, Soumith Chintala, and Gregory

Chanan. Pytorch, 2017. 6

[23] Jeffrey Pennington, Richard Socher, and Christopher Man-
In

ning. Glove: Global vectors for word representation.
EMNLP, pages 1532–1543, 2014. 6

[24] Yonggang Qi, Yi-Zhe Song, Honggang Zhang, and Jun Liu.
Sketch-based image retrieval via siamese convolutional neu-
ral network. In ICIP, 2016. 1

[25] Jose M Saavedra. Sketch based image retrieval using a soft
computation of the histogram of edge local orientations (s-
helo). In ICIP, 2014. 2

[26] Jose M Saavedra, Juan Manuel Barrios, and S Orand. Sketch
In

based image retrieval using learned keyshapes (lks).
BMVC, 2015. 2

[27] Patsorn Sangkloy, Nathan Burnell, Cusuh Ham, and James
Hays. The sketchy database: Learning to retrieve badly
drawn bunnies. SIGGRAPH, 2016. 1, 2, 3, 4, 7, 8

[28] Yuming Shen, Li Liu, Fumin Shen, and Ling Shao. Zero-shot

sketch-image hashing. In CVPR, 2018. 3, 7, 8

[29] K. Simonyan and A. Zisserman.

Very deep convolu-
tional networks for large-scale image recognition. arXiv,
abs/1409.1556, 2014. 6

[30] Jifei Song, Qian Yu, Yi-Zhe Song, Tao Xiang, and Timo-
thy M Hospedales. Deep spatial-semantic attention for ﬁne-
grained sketch-based image retrieval. In ICCV, 2017. 1, 2,
3

[31] Fang Wang, Le Kang, and Yi Li. Sketch-based 3d shape re-
trieval using convolutional neural networks. In CVPR, 2015.
3

[32] Jian Wang, Feng Zhou, Shilei Wen, Xiao Liu, and Yuanqing
Lin. Deep metric learning with angular loss. In ICCV, 2017.
3

[33] Kelvin Xu, Jimmy Ba, Ryan Kiros, Kyunghyun Cho, Aaron
Courville, Ruslan Salakhudinov, Rich Zemel, and Yoshua
Bengio. Show, attend and tell: Neural image caption gen-
eration with visual attention. In ICML, 2015. 5

[34] Xing Xu, Fumin Shen, Yang Yang, Dongxiang Zhang,
Heng Tao Shen, and Jingkuan Song. Matrix tri-factorization
with manifold regularizations for zero-shot learning.
In
CVPR, 2017. 3

[35] Meng Ye and Yuhong Guo. Zero-shot classiﬁcation with
In CVPR,

discriminative semantic representation learning.
2017. 3

[36] Sasikiran Yelamarthi, Shiva Krishna Reddy M, Ashish
Mishra, and Anurag Mittal. A zero-shot framework for
sketch based image retrieval. In ECCV, 2018. 3, 4, 7, 8

[37] Qian Yu, Feng Liu, Yi-Zhe Song, Tao Xiang, Timothy M
Hospedales, and Chen-Change Loy. Sketch me that shoe. In
CVPR, 2016. 1, 2, 3

2187

[38] H. Zhang, S. Liu, C. Zhang, W. Ren, R. Wang, and X. Cao.
Sketchnet: Sketch classiﬁcation with web images. In CVPR,
2016. 2, 3

[39] Jingyi Zhang, Fumin Shen, Li Liu, Fan Zhu, Mengyang Yu,
Ling Shao, Heng Tao Shen, and Luc Van Gool. Generative
domain-migration hashing for sketch-to-image retrieval. In
ECCV, 2018. 3

[40] Ziming Zhang and Venkatesh Saligrama. Zero-shot learning

via semantic similarity embedding. In ICCV, 2015. 3

2188

