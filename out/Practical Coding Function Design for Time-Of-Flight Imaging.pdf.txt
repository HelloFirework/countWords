Practical Coding Function Design for Time-of-Flight Imaging

Felipe Gutierrez-Barragan, Syed Azer Reza, Andreas Velten, Mohit Gupta

University of Wisconsin-Madison

{fgutierrez3, sreza2, velten}@wisc.edu, mohitg@cs.wisc.edu

Abstract

The depth resolution of a continuous-wave time-of-ﬂight
(CW-ToF) imaging system is determined by its coding func-
tions. Recently, there has been growing interest in the de-
sign of new high-performance CW-ToF coding functions.
However, these functions are typically designed in a hard-
ware agnostic manner, i.e., without considering the prac-
tical device limitations, such as bandwidth, source power,
digital (binary) function generation. Therefore, despite the-
oretical improvements, practical implementation of these
functions remains a challenge. We present a constrained
optimization approach for designing practical coding func-
tions that adhere to hardware constraints. The optimiza-
tion problem is non-convex with a large search space and
no known globally optimal solutions. To make the problem
tractable, we design an iterative, alternating least-squares
algorithm, along with convex relaxation of the constraints.
Using this approach, we design high-performance coding
functions that can be implemented on existing hardware
with minimal modiﬁcations. We demonstrate the perfor-
mance beneﬁts of the resulting functions via extensive sim-
ulations and a hardware prototype.

1. Introduction

Time-of-Flight (ToF) cameras are fast becoming the pre-
ferred depth sensing technology in several applications, in-
cluding autonomous navigation, augmented reality and user
interfaces. Broadly, ToF cameras can be categorized in
two ways: Impulse ToF (I-ToF), and continuous-wave ToF
(CW-ToF). I-ToF systems estimate depths by emitting a
high-powered laser pulse and measuring its time-of-ﬂight
using a high-speed detector. Typical I-ToF systems (e.g. Li-
DAR) need high-cost components such as high-speed lasers
and sensors. In contrast, CW-ToF cameras are low-power
and low-cost (e.g. Kinect), and estimate depths by modu-
lating the light intensity and decoding the reﬂected signal.

Current CW-ToF cameras have limited depth resolution,
especially in low signal-to-noise ratio (SNR) scenarios.
While the resolution can be increased using high-powered
light sources and longer exposure times, this is not always
possible. Given a ﬁxed energy and exposure time budget,
the depth resolution of a CW-ToF system depends on the
coding functions (i.e. light modulation and sensor demodu-

lation functions). Most existing CW-ToF systems use sinu-
soid [22] or square [12, 24] functions, which, although easy
to implement, have low depth resolution.

Recently, there has been growing interest in designing
high-performance CW-ToF codes [1, 15, 27], albeit in a
hardware agnostic setting. These works propose novel cod-
ing functions, which, although theoretically interesting, do
not adhere to practical constraints imposed by current de-
vices. For example, these coding functions [15, 1] require
impulse modulation with inﬁnite peak power and band-
width, and continuous, analog demodulation functions. In
practice, the space of physically realizable coding func-
tions is highly constrained. Speciﬁcally, although high-cost
lasers can emit ultra-short pulses with large peak power,
most light sources employed in CW-ToF cameras (e.g., laser
diodes, LEDs) have ﬁnite peak power. Furthermore, most
components of the system have a limited bandwidth. Ad-
ditionally, most CW-ToF systems use digital square/binary
functions for light modulation and sensor demodulation,
and may need considerable hardware modiﬁcations to sup-
port arbitrary continuous functions. Finally, binary func-
tions are also preferred because of their applicability to 2-
bucket sensors used in commercial CW-ToF cameras [29].
This leads to a trade-off in CW-ToF code design: Con-
ventional coding schemes, such as sinusoid and square, ad-
here to practical constraints, but have low performance.
On the other hand, recent schemes promise higher perfor-
mance, but, may not be physically realizable on current
hardware. In this paper, we consider the following ques-
tion: Can we design CW-ToF coding functions that adhere
to hardware constraints, and yet, achieve high performance
in a broad range of imaging scenarios? We consider three
important constraints: Limited peak source power, limited
bandwidth, and binary coding functions. 1

To address this question, we pose the practical CW-ToF
code design as a constrained optimization problem. This
is challenging due to the large space of coding functions
and the non-convex constraints. In order to keep the prob-
lem tractable, we consider pre-designed correlation func-
tions, which are factorized into physically realizable modu-
lation and demodulation functions. While this reduces the

1Binary functions, theoretically, have inﬁnite bandwidth. We consider
both binary and bandwidth constraints simultaneously by assuming that the
bandwidth constraints are applied while being passed through the imaging
system, after the binary coding functions are generated.

1566

search space, factorizing a given correlation function into
modulation and demodulation function is ill-posed. To per-
form this factorization, we use an iterative optimization ap-
proach, similar to blind deconvolution [2, 21], where at each
iteration a convex sub-problem is solved. This approach,
along with convex relaxations of constraints, enables opti-
mizing over the space of practical coding functions.

The proposed approach is ﬂexible; given a hardware im-
plementation, it computes high-performance coding func-
tions that adhere to the corresponding constraints and are
physically realizable. We demonstrate, via extensive simu-
lations and hardware experiments, that the performance of
the proposed coding functions, although lower than theoret-
ical (but impractical) coding functions [15], is considerably
higher than conventional approaches, such as sinusoid and
square coding. We also demonstrate how to adapt the re-
sulting practical codes for a 2-bucket architecture. The pro-
posed approach provides a framework for designing practi-
cal ToF coding functions under a wide range of constraints,
from weak to strong constraints, such as severely limited
bandwidth and peak power, and enable 3D imaging in chal-
lenging imaging scenarios (e.g. outdoors, low-power).

2. Related Work

Code design for CW-ToF: Many coding designs have been
proposed to address issues in CW-ToF imaging, such as,
mitigating multi-camera interference [4, 29], multi-path in-
terference [20, 14] and non-linearities caused by aliased
harmonics [25, 24]. Furthermore, CW-ToF code design has
also been used for transient imaging [20] and illumination
demultiplexing [19]. There has been little work on design-
ing coding schemes that achieve higher depth resolution.
Payne et al. [26] proposed multi-frequency sinusoid func-
tions to simultaneously achieve large depth range and high
depth precision. This approach requires phase unwrapping
and is prone to large errors in low SNR scenarios. The focus
of this paper is on designing practical coding schemes that
achieve high depth resolution, even in low SNR scenarios.

Code design for structured light: Code design for im-
proved depth resolution has been explored in other active vi-
sion systems, in particular structured light (SL) [18, 23, 13].
Despite theoretical similarities between SL (spatial coding)
and CW-ToF (temporal coding), there are crucial differ-
ences in their practical hardware limitations. For instance,
typical SL systems can implement arbitrary continuous pat-
terns [6] limited only by the spatial resolution of the system.
In contrast, CW-ToF systems are limited to sinusoidal and
square functions, with strong bandwidth constraints (< 200
MHz) which severely limits the achievable depth resolution.

function generator(cid:4666)(cid:4667)
D
,
=׬0

multiplier

ambient illumination

scene

source

sensor

: Distance to 

point

Figure 1: CW-ToF imaging. The intensity of a light source
is temporally modulated according to a function M (t). The
incident sensor radiance, R(t), is multiplied with a demod-
ulation function, D(t). The product is integrated for an ex-
posure time T and the resulting intensity, I, is recorded.

over time according to a modulation function M (t). As-
suming no indirect illumination, the radiance R(t) incident
on a sensor pixel at time t is given as:

R(t) = s M (cid:18)t −

2 d

c (cid:19) + A ,

(1)

where d is the distance of the scene point from the sensor,
c is the speed of light, and s is a scene dependent scale fac-
tor which depends on the scene point’s albedo, shading and
intensity fall-off. A is the ambient illumination due to ex-
ternal light sources (e.g., sunlight in outdoor scenarios).

The incident radiance R(t) is correlated with a demodu-
lation function at the sensor, D(t), where 0 ≤ D(t) ≤ 1. 2
The demodulation function can be implemented through
photonic mixer devices [22], or fast optical shutters [5]. We
assume both M (t) and D(t) to be periodic functions with
the same fundamental frequency f0 (homodyne CW-ToF).
The intensity I measured at the pixel is given by the tem-

poral correlation of R(t) and D(t):

I = Z T

0

D(t) R(t) dt ,

(2)

where T is the sensor exposure time. We deﬁne χ(d) as the
normalized cross-correlation between M (t) and D(t):

2d

D(t) ¯M (cid:18)t −

χ(d) = (D ⋆ ¯M )(d) = Z τ
where τ is the period of M (t) and D(t), Eτ = R τ

0 M (t)dt,
is the total energy emitted by the light source within a period
τ , and ¯M (t) = M (t)
is the normalized modulation function.
Eτ

c (cid:19) dt ,

(3)

0

3. Background: Image Formation Model

We begin by reviewing the CW-ToF image formation
model [22, 16, 15]. A CW-ToF imaging system (Figure
1) consists of a light source whose intensity is modulated

22-bucket ToF sensors [22] emulate negative, zero-mean demodulation
functions by taking the difference of two complementary measurements.
Since these functions are the difference of two positive demodulation func-
tions, we only consider positive functions in our analysis. In Section 6.4,
we show how the proposed binary demodulation functions can be adapted
as complementary demodulation pairs that can be used in 2-bucket sensors.

1567

Figure 2: Practical coding function design. The black lines illustrate the pulsed ToF implementation of a high-performance
correlation function [15]. Our algorithm designs the input modulation and demodulation functions (blue lines) that adhere
to peak power and binary constraints. The input functions are smoothed according to the system’s impulse response and
result in the red lines above. The actual correlation function achieved by the system is the correlation of the smoothed output
functions. Our algorithm designs the blue functions to produce the best approximation of the objective correlation function.

Substituting Eq. 1 into Eq. 2, and simplifying using Eq. 3,
we get the following expression for the measured intensity:

I = Is χ(d) + Ia ,

(4)

where Ia = AR T

is the average power of M (t).

0 D(t)dt, Is = s Pave T , and Pave = Eτ

τ

Since there are three unknowns in Eq. 4 (distance d, ef-
fective albedo Is, and ambient brightness Ia), K ≥ 3 in-
tensity measurements are needed. Each measurement, Ii
(1 ≤ i ≤ K), is taken using a different pair of modulation
and demodulation functions. The set of K modulation and
demodulation functions is called a coding scheme [15].

4. Constrained Optimization for Code Design

Designing practical, high-performance coding schemes
(Mi(t), Di(t)), 1 ≤ i ≤ K, can be posed as a con-
strained optimization problem. Unfortunately, the space
of functions can be large, making this a challenging opti-
mization problem to solve. To keep it tractable, we pose
practical coding design as a two-stage problem. The per-
formance of a ToF imaging system, in terms of depth pre-
cision, can be completely characterized by its correlation
functions χi, 1 ≤ i ≤ K [15]. Thus, the ﬁrst stage de-
signs the correlation functions, without imposing the hard-
ware constraints. This can be performed following any of
the previous coding function design approaches [15, 1, 27].
The second stage factorizes each χi into modulation and
demodulation functions. This step is critical, because for a
practical implementation we need to determine the modula-
tion and demodulation functions that create a given corre-
lation function. Mathematically, this factorization problem
can be expressed as follows:

ﬁnd

such that

(Mi(t), Di(t)), 1 ≤ i ≤ K
(Di ⋆ ¯Mi)(t; d) = χi(d),

Z τ

0

¯Mi(t)dt ≤ 1,

0 ≤ ¯Mi(t),

0 ≤ Di(t) ≤ 1

(5)

Recent coding design works [15, 1] focused only on the
ﬁrst step of designing correlation functions. For the sec-

ond step, they considered a trivial factorization: an impulse
modulation function Mi(t) = Eτ δ(t), and the demodula-
tion function being the same as the normalized correlation
function, e.g., a trapezoidal function (see Figure 2). Al-
though theoretically feasible, this decomposition is imprac-
tical because of three fundamental hardware constraints:

1. Limited peak source power: An impulse modulation
function assumes the laser can emit an inﬁnitely short
and high powered pulse, as illustrated in Figure 2. Al-
though, high powered pulsed lasers are used in multi-
ple applications [28], they are often expensive, and not
appropriate for low-cost CW-ToF systems.

2. Limited bandwidth: An ideal impulse function re-
quires inﬁnite bandwidth. Most current CW-ToF cam-
eras are severely constrained by the available band-
width of the coding functions (typically < 200 MHz.).

3. Non-binary coding functions: The trivial decompo-
sition described above leads to arbitrary continuous-
valued demodulation functions. Several commercial
CW-ToF systems rely on digitally generated signals
to modulate M (t) and D(t) [24, 22], and thus, are
limited to binary functions. Furthermore, non-binary
codes cannot leverage two-bucket ToF sensors that ef-
ﬁciently use source power, thereby improving SNR.

We present a framework that decomposes a correla-
tion function into a modulation and demodulation function,
while adhering to pre-speciﬁed hardware constraints. Fig-
ure 2 shows an example of such a decomposition. Our
framework takes as input a desired correlation function
(e.g., trapezoidal function shown in black line), the maxi-
mum peak power constraint, and the frequency bandwidth,
speciﬁed as the impulse response of the system. Given these
parameters and a binary structure prior, an optimization
problem similar to 5 is solved. The designed modulation
and demodulation functions (blue dashed lines in Figure 2)
will produce the closest approximation of the objective cor-
relation function. These designed modulation and demodu-
lation functions are input to the CW-ToF system, which then

1568

=Correlation Function⋆Source ModulationSensor Demodulation∞=(cid:883)
=(cid:884)
=(cid:885)

Source Modulation

Sensor Demodulation

Correlation Functions

Figure 3: Power-limited decomposition. Power-limited correlation function decomposition for Hamiltonian K = 3 at
different maximum power levels. At Pmax ≥ 6Pave the resulting modulation and demodulation functions have the same
correlation as the objective Hamiltonian correlation. This is clearly illustrated in the case of Pmax = 30Pave (blue) where
the chosen solution only uses 6Pave. When Pmax ≤ 6Pave only approximations of the objective correlations are obtained.

,

smooths them according to its impulse response. The output
modulation and demodulation functions (red lines in Figure
2) will produce the actual correlation function. As an exam-
ple, we demonstrate our framework on the family of Hamil-
tonian correlation functions [15]. Speciﬁcally, we consider
Hamiltonian codes with 3, 4, or 5 measurements, referred
hereafter as Hamiltonian K = 3, K = 4, and K = 5.

5. Power-limited Coding Function Design

In this section, we analyze the correlation decomposition
with a ﬁnite light source peak power and inﬁnite bandwidth.

5.1. Power limited Decomposition

Let ¯mi, di, χi be the vectors representing the N point
discretization of a single period of ¯Mi(t), Di(t), and χi(d),
respectively. We ﬁnd the best ﬁtting ¯mi and di for a given
χi by solving the following constrained optimization:

argmin
¯mi,di

subject to

kχi − ¯mi ⋆ dik2

N

Xj=1

¯mi,j∆t ≤ 1,

0 ≤ ¯mi,j ≤ pf ,

(6)

0 ≤ di,j ≤ 1,

j = 1, . . . , N

N and pf =
. For interpretability we ﬁx τ = 1 in the optimization.

where ⋆ is the cross-correlation operator, ∆t = τ
Pmax
τ Pave
The problem is solved for each χi, 1 ≤ i ≤ K.
Alternating convex optimization approach: Problem (6)
can be thought of as the 1-dimensional analog of blind
image deblurring [10, 7, 21] and in general,
is under-
constrained and ill-posed. However, if either mi or di is
ﬁxed, the problem becomes well-posed, and can be solved
through standard convex optimization methods [3, 11].
Therefore, one approach to ﬁnding a local optima is to al-
ternate between ﬁxing mi and di and solving the convex
sub-problem. This is done until convergence of the loss
function. We implemented the alternating optimization pro-
cedure using CVXPY [8]. The coding function vectors, m
and d, are randomly initialized, and χ is set to the objective
correlation. In our ﬁnal implementation, which included the
additional regularization discussed below, convergence was
often achieved within 5 − 50 iterations.

Imposing binary function constraint: The alternating
convex optimization approach often leads to rapidly ﬂuc-
tuating non-binary solutions for mi and di. Such solutions
may be able to approximate χi accurately, but, they are not
practical due to their high bandwidth requirements and non-
binary structure. Ideally, we would impose a binary con-
straint on m and d. Such constraint would make each sub-
problem non-convex. Therefore, we relax the binary con-
straint by imposing a total variation regularization on m and
d, thereby preserving the convexity of the sub-problems.
Although this relaxation leads to near-binary sparse solu-
tions for m and d, it does not guarantee a binary structure.
In order to achieve binary solutions, we apply a binary re-
projection operator at the end of each iteration.
Power-limited Hamiltonian coding functions: Figure 3
shows the correlation decomposition for one (out of three)
Hamiltonian K = 3 codes at different maximum power
levels. See the supplementary material for the other two
correlation functions. When Pmax ≥ 6Paverage our algo-
rithm is able to ﬁnd a factorization that achieves zero error:
M (t) is a 1
6 duty cycle square wave with peak power of
6Pave, and D(t) is a square wave with 1
2 duty cycle. When
Pmax < 6Pave our algorithm generates coding schemes
that only approximate Hamiltonian K = 3. In the limiting
case, when Pmax = 2Pave, our method returns conven-
tional square coding functions. Please see the supplemen-
tary material for power-limited decompositions for Hamil-
tonian K = 4, 5 under different power constraints.

5.2. Performance of Power limited Coding Schemes

The L2 norm of the difference between the objective cor-
relation function and the correlation of ¯m and d is a met-
ric that is easily expressed in an optimization problem. A
more meaningful metric, however, is the mean depth error
(MDE) achieved by the decomposition, for a given depth
range and distribution of scene albedos [15]. See the sup-
plementary report for details of the MDE metric.
Mean depth error comparisons: We used the following
parameters. Fundamental frequency, f0 = 15 Mhz, corre-
sponding to a depth range of 0 − 10 meters. Gaussian noise,
with afﬁne noise model including photon noise and sensor
read noise with a variance of 20 electrons. Total integration
time of 300ms, and scene albedos of 0 − 1. To perform the
comparisons at a wide range of SNR levels, we vary source

1569

Figure 4: Mean depth errors of power-limited and band-limited CW-ToF codes. In the power-limited case (a), all coding
schemes achieve their theoretical performance. In the more practical scenarios where the system band-limits are considered
(b and c), the re-designed Hamiltonian schemes outperform both baselines at all SNR levels. Zoom in for better visualization.

and ambient strength, while ﬁxing the other parameters.

Figure 4 (a) shows the MDE for Hamiltonian K = 3,
K = 4, K = 5, sinusoid [22], and multi-frequency si-
nusoid [9, 26]. 3 We consider a multi-frequency sinusoid
with K = 5 measurements;
three low frequency mea-
surements with f = f0 and two high-frequency measure-
ments with f = 7f0. We use 7f0 because the higher
frequency components in Hamiltonian K = 5 can be ap-
proximated by a square wave with a frequency of 7f0.
The coding schemes are compared at various peak power
constraints. When Pmax = 30Pave, all coding schemes
achieve a zero error decomposition. Consequently, the per-
formance of the ideal Hamiltonian codes is maintained. As
the peak power constraint is strengthened, i.e., Pmax is
reduced, the decompositions become approximations.
In
the supplementary material we show the performance at
Pmax = [15Pave, 5Pave, 2Pave]. Multi-frequency sinusoid
performs well at high SNR levels, but its performance de-
grades rapidly at low SNR due to phase unwrapping errors.
Although the performance of the power-limited Hamilto-
nian codes is lowered as compared to theoretically ideal
codes, they still outperform the sinusoid-based codes at
most source and ambient power levels.

these components smooth the input modulation and demod-
ulation functions, which attenuates frequencies outside the
system’s bandwidth. Here, it is important to make a distinc-
tion between the input coding functions Min(t) and Din(t),
and the output functions Mout(t) and Dout(t), which are
created after the input functions are smoothed by the sys-
tem. We are designing the input functions, but the output
functions actually correlate to form the correlation func-
tions. Therefore, the goal of the correlation decomposi-
tion for a band-limited system is to ﬁnd Min(t) and Din(t)
whose corresponding (smoothed) Mout(t) and Dout(t) best
approximate the objective correlation.

Furthermore, we apply the bound constraints described
in Sections 4 and 5 on the input functions because, in prac-
tice, these bounds can be imposed on Min(t) and Din(t) via
a function generator. Once the bounds are imposed on the
input functions, the output functions will also satisfy them.

6.2. Band limited Decomposition

Let hm(t) and hd(t) be the impulse responses of the
modulation and demodulation arms of the system. Then,
we solve the following optimization problem to ﬁnd the in-
put coding functions:

6. Band-limited Coding Function Design

In this section we analyze the correlation decomposition

problem with both peak power and bandwidth constraints.

argmin
ˆmi,di

subject to

kχi − ( ¯min

i ⊛ hm(t)) ⋆ (din

i ⊛ hd(t))k2

N

Xj=1

¯min

i,j∆t ≤ 1,

0 ≤ ¯min

i,j ≤ pf ,

(7)

6.1. Bandwidth of a System

0 ≤ din

i,j ≤ 1,

j = 1, . . . , N

The bandwidth of a system is characterized by the im-
pulse/frequency response. The cascade of hardware com-
ponents (e.g. function generator, laser, sensor) in the CW-
ToF system determines the impulse response. Effectively,

3For comparing coding schemes with different K, we assume a ﬁxed
total integration time which is split evenly among the intensity measure-
ments. Under such constraint the performance of sinusoid schemes does
not change as we vary K. For details, see the supplement.

where ⊛ is the circular convolution operator. We solve
problem 7 with the same alternating convex optimiza-
tion approach with TV regularization described in Section
5.1. Due to stronger constraints, the convergence for the
band-limited decomposition was on average faster than the
power-limited case, only requiring 3 − 20 iterations.
Band-limited Hamiltonian coding functions: We assume
the modulation and demodulation impulse responses to be

1570

Mean Depth Error (mm)=5∙,~5∙0Mean Depth Error (mm)=5∙,~(cid:883)(cid:882)∙0Mean Depth Error (mm)=3(cid:882)∙,~∞(a)(b)(c)Figure 5: Hanning window. Hanning window with
fmax ∼ 5f0 used to model the impulse/frequency response
of the band-limiting components in our simulations.

the same, i.e., hm(t) = hd(t), and model them as Han-
ning windows [17]. Figure 5 shows an example Hanning
window and its frequency response. We evaluate two cases
with Hanning windows that constraint the maximum fre-
quency to be fmax ∼ 10f0 and fmax ∼ 5f0. We consider
fmax to be the maximum frequency whose amplitude is not
attenuated more than ∼ 5x.

Figure 6 shows the input modulation and demodula-
tion functions that best ﬁt two (out of ﬁve) Hamiltonian
K = 5 correlation functions. Due to limited bandwidth,
only smoothed approximations of Hamiltonian codes can
be achieved. However, the input coding functions (Min(t)
and Din(t)) generated by our algorithm, continue to have
the desired binary structure (columns 1 and 3 in Figure
6); only the output functions (Mout(t) and Dout(t)) are
band-limited. Please refer to the supplementary material for
all the resulting band-limited factorizations of Hamiltonian
codes under different combinations of constraints.

6.3. Performance of Band limited Coding Schemes

Figures 4 (b) and (c) show the MDE for several coding
schemes, under two different bandwidth constraints. The
same simulation parameters described in Section 5.2 are
used. The smoothing degrades the performance of all cod-
ing schemes. We do not apply our framework to sinusoid-
based schemes in our evaluation, but we do limit their band-
width as it happens in practice. Despite the relatively poor
approximations of the Hamiltonian codes in the severely
band-limited case (Figure 6), the overall performance of the
resulting codes is still 2 − 5x greater than sinusoid-based
codes. Please refer to the supplementary material for addi-
tional MDE simulations at different maximum power and
bandwidth levels.

Figure 7 shows the 3D imaging simulations for a hand
gesture reconstruction in two hardware constrained scenar-
ios. In the loosely constrained scenario, all coding schemes
perform almost ideally and faithfully recover the 3D ge-
ometry.
In the more practical setting with tighter power
and bandwidth constraints, the overall performance of all
coding schemes degrades. However, our new hardware-
constrained codes outperform conventional sinusoid codes
in both high and low SNR settings.

6.4. Applicability to 2 Bucket CW ToF Sensors

Complementary demodulation function pairs: One im-
portant consequence of enforcing binary demodulation
functions is that they can leverage two-bucket CW-ToF sen-
sors. A two-bucket sensor simultaneously acquires two
measurements using complementary binary demodulation
function pairs [22, 29]. Any coding scheme with K binary
demodulation functions (e.g. codes in this paper) can be
implemented in a two-bucket sensor.

Figure 8 shows the performance of sinusoid-based and
Hamiltonian codes implemented in a two-bucket sensor in
two band-limiting cases. Hamiltonian K = 8 corresponds
to Hamiltonian K = 4 adapted for 2-bucket ToF. The four
extra measurements are the complementary demodulation
functions. Dual-frequency sinusoid corresponds to 4 f0 and
4 7f0 measurements. Additional discussion and results for
two-bucket sensors can be found in the supplement.

7. Hardware Experiments

7.1. Hardware Prototype

We developed a CW-ToF hardware prototype that can
implement arbitrary coding schemes, with controllable fun-
damental frequency and average power. Our setup is based
on a point scanning design using a galvo mirror system
(GVS012, Thorlabs). The light source is a 830nm laser
diode (L830P200, Thorlabs) with a maximum power of
∼ 200mW. The intensity of the laser is modulated by an ar-
bitrary function generator (SDG 5162, Siglent) whose max-
imum frequency is 150Mhz, and is the band-limiting com-
ponent of the setup. The reﬂected signal is focused by a lens
onto an avalanche photodiode (APD430A, Thorlabs). The
detected signal is multiplied with the demodulation func-
tion using a frequency mixer (zx05-1L-s+, Mini-Circuits).
The output of the mixer is ampliﬁed (C7319, Hamamatsu),
low-pass ﬁltered (EF110, Thorlabs), sampled and averaged
by a data acquisition card (USB-6000DAQ, National Instru-
ments) to obtain intensity measurements. Additional infor-
mation on the setup is provided in the supplement.

7.2. Experimental Results

We evaluate the performance of all coding schemes un-
der different hardware parameters, constraints, and SNR
levels in four scenarios. Table 1 summarizes the experi-
mental parameters used for each scene. The band-limit of
our prototype system is modelled similar to the simulations
with a maximum frequency of 150Mhz.
Evaluating depth error at a single pixel: Figure 9 shows
the mean depth errors of our hardware setup for each cod-
ing scheme. The scene is a single point at a distance of
0.7m from the source and the sensor. The laser is colli-
mated and the sensor is focused on the laser spot. To eval-
uate the mean absolute error (MAE), we estimate the depth
of the point 300 times. We emulate the full depth range

1571

Impulse ResponseFrequency ResponseFigure 6: Band-limited decomposition. Two coding functions selected from Hamiltonian K = 5 are factorized. The
bandwidth constraint is fmax ∼ 10f0. The input modulation and demodulation functions adhere to their corresponding
bound and binary constraints.

Figure 7: Simulations under loose and tight constraints.
Comparison of a 3D hand reconstruction under loose
(Pmax = 20Pave, fmax = 20f0) and tight (Pmax = 5Pave,
fmax = 5f0) constraints. Under loose constraints both
Hamiltonian and multi-freq sinusoid accurately recover the
shape. Under tighter constraints the performance degrades,
however, the re-designed Hamiltonian K = 4 continues to
recover the overall structure and details of the hand.

of the coding scheme by artiﬁcially shifting the modulation
function and calculating the MAE for each shift. The mean
depth percent errors in Figure 9 are calculated by averaging
the MAE of all shifts (20 shifts) and dividing by the total
depth range (30m). Since f0 is 30x lower than fmax on this
conﬁguration, we assume inﬁnite bandwidth and evaluate
power-limited coding schemes.

3D wall reconstruction: Figure 11 shows the 3D recon-
struction for a wall. At both high and low SNR, the practical
Hamiltonian codes outperform sinusoid-based codes.

Real-world scenes with complex textures: Figure 10
shows the recovered depth maps for a table-top scene and
a volleyball using Hamiltonian K = 5 and multi-freq sinu-
soid. The table-top scene consists of 3 books spaced 20cm

Figure 8: Performance in two-bucket sensors. The
MDE for two sinusoid-based and one Hamiltonian scheme
adapted for a two-bucket architecture. Being able to lever-
age the two-bucket architecture allows Hamiltonian K = 8
to continue outperforming sinusoid-based schemes.

Figure 9: Experimental mean depth errors.
Single
pixel MDE in a power-limited setting where Pmax =
15Pave. Consistent with simulations, at low-medium SNR
power-limited Hamiltonian codes outperform sinusoid-
based codes, and at high SNR multi-frequency sinusoid per-
forms comparably to Hamiltonian.

from each other each other, and a background wall ∼ 2m
behind the ﬁrst book. The second scene was a 20cm radius
volleyball placed 1m away from the sensor. The exposure
time used for both scenes is the same. The band-limited
Hamiltonian K = 5 depth maps have considerably fewer
outliers. Multi-freq sinusoid, on the other hand, displays
large errors at low SNR due to erroneous phase unwrap-
ping. The MAE are obtained by ﬁtting multiple planes and
a sphere to the high SNR table-top and volleyball scenes.

1572

Input ModulationInput DemodulationCorrelation FunctionsOutput ModulationOutput DemodulationHigh SNR Hamiltonian K=5MAE = 1.17mmMulti-Freq SinusoidMAE = 3.65mm Hamiltonian K=5MAE = 2.93mm Multi-Freq SinusoidMAE = 4.69mm Low SNR Loose constraintsHamiltonian K=4MAE = 3.75mmSinusoidMAE = 8.69mm Hamiltonian K=4MAE = 6.47mm SinusoidMAE = 14.11mm High SNR Low SNR Tight constraintsMean Depth Error (mm)=5∙,~5∙0Mean Depth Error (mm)=5∙,~(cid:883)(cid:882)∙0(a)(b)Low –Medium SNR LevelsTotal Integration Time (milliseconds)Mean Percent Depth ErrorsHigh SNR LevelsTotal Integration Time (milliseconds)Mean Percent Depth ErrorsFigure 10: Depth maps for a table-top scene and a volleyball. We compare the reconstruction results for Hamiltonian
K = 5 and multi-freq sinusoid. At high SNR both coding schemes accurately recover the 3D geometry in both scenes. In the
books scene, at low SNR, phase unwrapping errors appear in multi-freq sinusoid, especially in regions with low albedo (left-
most book) and farther depths (background wall). For the volleyball multi-freq sinusoid also displays poor depth precision
along the periphery for low SNR. The dark red spots correspond to errors greater than 30cm which are indicative of a poor
reconstruction of the ball. On the other hand, Hamiltonian K = 5 exhibit no phase unwrapping errors and a low outlier rate.

fmax High SNR Low SNR

f0

Pave

Scene
Single Pixel 2mW 5Mhz ∞ O.D. 2
10mW 10Mhz 15f0 O.D. 2
Wall
10mW 15Mhz 10f0 O.D. 1
Table-top
10mW 15Mhz 10f0 O.D. 1
Volleyball

O.D. 3
O.D. 3
O.D. 2
O.D. 2

Figure 11: 3D wall reconstructions. The wall is at a dis-
tance of 0.5m. At high SNR, Hamiltonian K = 5 and multi-
freq sinusoid perform comparably. At low SNR phase un-
wrapping errors appear in multi-freq sinusoid signiﬁcantly
degrading its performance. The MAE is calculated with re-
spect to the mean depth of all pixels.

8. Limitations and Future Work

Optimality of the two-step approach: Ideally one would
optimize for the practical modulation and demodulation
functions directly with the MDE as the objective. Since
the resulting optimization problem is challenging with no
known tractable solutions, we divide it into two steps: (1)
optimize the correlation functions over the MDE, (2) ﬁnd
practical modulation and demodulation functions that ap-
proximate the correlation. This procedure is simpler to im-
plement, and as our results show, leads to practical high-
performance codes. Although, our approach is general
enough to be applied to any correlation function, it is dif-

Table 1: Parameters for hardware experiments. The
maximum power is ﬁxed across all experiments to 15Pave.
The maximum frequency constraint (fmax) is determined
by f0 and the band-limit of
the function generator
(150Mhz). The high and low SNR settings are emulated
by attenuating the source power with ND ﬁlters with dif-
ferent optical densities (O.D). O.D of 1, 2, and 3 lead to a
signal attenuation factor of 10, 100, and 1000.

ﬁcult to guarantee that a given correlation can be accurately
factorized. Ultimately, the goodness of ﬁt depends on the
strength of the constraints (e.g., Supplementary Figure 12).

Complementary demodulation for 2-bucket ToF: The 2-
bucket coding schemes derived from the binary demodula-
tion functions with our method may not be optimal. An in-
teresting direction for future research is to embed the com-
plementary function constraint in the optimization.

Multi-path interference: In this paper we assume there is
no interference due to multiple reﬂections. The correlation
function design step and depth inference algorithm could
incorporate a multi-path propagation model as done in [1,
27]. This is a promising future research direction.

Acknowledgements: This research was supported in part
by ONR grants N00014-15-1-2652 and N00014-16-1-2995
and DARPA grant HR0011-16-C-0025.

1573

Hamiltonian K=5, MAE = 7.8cmMulti-Freq Sinusoid, MAE = 64.6cmHamiltonian K=5, MAE = 1.1cmMulti-Freq Sinusoid, MAE = 0.9cmHamiltonian K=5, MAE = 1.8cmMulti-Freq Sinusoid, MAE = 50.4cm Hamiltonian K=5, MAE = 1.2cmMulti-Freq Sinusoid, MAE = 2.9cmunwrapping errorsHigh SNRLow SNRSceneSinusoid MAE = 181.1mm High SNRMulti-Freq Sinusoid MAE = 84.7mmHamiltonian K=5MAE = 51.6mmSinusoid MAE = 461.1mm Low SNRMulti-Freq Sinusoid MAE = 392.2mmHamiltonian K=5MAE = 109.3mm[18] E. Horn and N. Kiryati. Toward optimal structured light pat-
terns1. Image and Vision Computing, 17(2):87–97, 1999. 2
[19] A. Kadambi, A. Bhandari, R. Whyte, A. Dorrington, and
R. Raskar. Demultiplexing illumination via low cost sensing
and nanosecond coding. In 2014 IEEE International Confer-
ence on Computational Photography (ICCP), pages 1–10.
IEEE, 2014. 2

[20] A. Kadambi, R. Whyte, A. Bhandari, L. Streeter, C. Barsi,
A. Dorrington, and R. Raskar. Coded time of ﬂight cameras:
sparse deconvolution to address multipath interference and
recover time proﬁles. ACM Transactions on Graphics (ToG),
32(6):167, 2013. 2

[21] D. Kundur and D. Hatzinakos. Blind image deconvolution.

IEEE signal processing magazine, 13(3):43–64, 1996. 2, 4

[22] R. Lange and P. Seitz. Solid-state time-of-ﬂight range cam-
era. IEEE Journal of quantum electronics, 37(3):390–397,
2001. 1, 2, 3, 5, 6

[23] P. Mirdehghan, W. Chen, and K. N. Kutulakos. Optimal
structured light `a la carte. In Proceedings of the IEEE Con-
ference on Computer Vision and Pattern Recognition, pages
6248–6257, 2018. 2

[24] A. D. Payne, A. A. Dorrington, and M. J. Cree. Illumina-
tion waveform optimization for time-of-ﬂight range imag-
ing cameras. In Videometrics, Range Imaging, and Applica-
tions XI, volume 8085, page 80850D. International Society
for Optics and Photonics, 2011. 1, 2, 3

[25] A. D. Payne, A. A. Dorrington, M. J. Cree, and D. A.
Carnegie. Improved measurement linearity and precision for
amcw time-of-ﬂight range imaging cameras. Applied optics,
49(23):4392–4403, 2010. 2

[26] A. D. Payne, A. P. Jongenelen, A. A. Dorrington, M. J. Cree,
and D. A. Carnegie. Multiple frequency range imaging to re-
move measurement ambiguity. In Optical 3-D Measurement
Techniques, 2009. 2, 5

[27] M. Schober, A. Adam, O. Yair, S. Mazor, and S. Nowozin.
Dynamic time-of-ﬂight.
In Proceedings of the IEEE Con-
ference on Computer Vision and Pattern Recognition, pages
6109–6118, 2017. 1, 3, 8

[28] A. Velten, T. Willwacher, O. Gupta, A. Veeraraghavan, M. G.
Bawendi, and R. Raskar. Recovering three-dimensional
shape around a corner using ultrafast time-of-ﬂight imaging.
Nature communications, 3:745, 2012. 3

[29] R. Z. Whyte, A. D. Payne, A. A. Dorrington, and M. J. Cree.
Multiple range imaging camera operation with minimal per-
formance impact. In Image Processing: Machine Vision Ap-
plications III, volume 7538, page 75380I. International So-
ciety for Optics and Photonics, 2010. 1, 2, 6

References

[1] A. Adam, C. Dann, O. Yair, S. Mazor, and S. Nowozin.
Bayesian time-of-ﬂight for realtime shape, illumination and
albedo. IEEE transactions on pattern analysis and machine
intelligence, 39(5):851–864, 2017. 1, 3, 8

[2] G. Ayers and J. C. Dainty.

Iterative blind deconvolution
method and its applications. Optics letters, 13(7):547–549,
1988. 2

[3] S. Boyd and L. Vandenberghe. Convex optimization. Cam-

bridge university press, 2004. 4

[4] B. B¨uttgen and P. Seitz. Robust optical time-of-ﬂight range
IEEE Trans. on

imaging based on smart pixel structures.
Circuits and Systems, 55(6):1512–1525, 2008. 2

[5] D. A. Carnegie, J. McClymont, A. P. Jongenelen, B. Drayton,
A. A. Dorrington, and A. D. Payne. Design and construction
of a conﬁgurable full-ﬁeld range imaging system for mobile
robotic applications. In New Developments and Applications
in Sensing Technology, pages 133–155. Springer, 2011. 2

[6] B. Carrihill and R. Hummel. Experiments with the intensity
ratio depth sensor. Computer Vision, Graphics, and Image
Processing, 32(3):337 – 358, 1985. 2

[7] T. F. Chan and C.-K. Wong. Total variation blind deconvolu-
tion. IEEE transactions on Image Processing, 7(3):370–375,
1998. 4

[8] S. Diamond and S. Boyd. Cvxpy: A python-embedded mod-
eling language for convex optimization. The Journal of Ma-
chine Learning Research, 17(1):2909–2913, 2016. 4

[9] D. Droeschel, D. Holz, and S. Behnke. Multi-frequency
phase unwrapping for time-of-ﬂight cameras. In Intelligent
Robots and Systems (IROS), 2010 IEEE/RSJ International
Conference on, pages 1463–1469. IEEE, 2010. 5

[10] W. Freeman, F. Durand, Y. Weiss, and A. Levin. Understand-
ing and evaluating blind deconvolution algorithms. 2009. 4

[11] M. Grant, S. Boyd, and Y. Ye. Disciplined convex pro-
gramming. In Global optimization, pages 155–210. Springer,
2006. 4

[12] R. Grootjans, W. van der Tempel, D. Van Nieuwenhove,
C. de Tandt, and M. Kuijk.
Improved modulation tech-
niques for time-of-ﬂight ranging cameras using pseudo ran-
dom binary sequences. In Eleventh Annual Symposium of the
IEEE/LEOS Benelux Chapter, page 217, 2006. 1

[13] M. Gupta and N. Nakhate. A geometric perspective on struc-
tured light coding. In Proceedings of the European Confer-
ence on Computer Vision (ECCV), pages 87–102, 2018. 2

[14] M. Gupta, S. K. Nayar, M. B. Hullin, and J. Martin. Pha-
sor imaging: A generalization of correlation-based time-
of-ﬂight imaging. ACM Transactions on Graphics (ToG),
34(5):156, 2015. 2

[15] M. Gupta, A. Velten, S. K. Nayar, and E. Breitbach. What are
optimal coding functions for time-of-ﬂight imaging? ACM
Transactions on Graphics (TOG), 37(2):13, 2018. 1, 2, 3, 4

[16] M. Hansard, S. Lee, O. Choi, and R. P. Horaud. Time-
of-ﬂight cameras: principles, methods and applications.
Springer Science & Business Media, 2012. 2

[17] F. J. Harris. On the use of windows for harmonic analysis
with the discrete fourier transform. Proceedings of the IEEE,
66(1):51–83, 1978. 6

1574

