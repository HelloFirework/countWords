Unsupervised Learning of Consensus Maximization for 3D Vision Problems

Thomas Probst, Danda Pani Paudel, Ajad Chhatkuli, Luc Van Gool

Computer Vision Laboratory, ETH Zurich, Switzerland

Abstract

Consensus maximization is a key strategy in 3D vision
for robust geometric model estimation from measurements
with outliers. Generic methods for consensus maximiza-
tion, such as Random Sampling and Consensus (RANSAC),
have played a tremendous role in the success of 3D vision,
in spite of the ubiquity of outliers. However, replicating
the same generic behaviour in a deeply learned architec-
ture, using supervised approaches, has proven to be difﬁ-
cult. In that context, unsupervised methods have a huge po-
tential to adapt to any unseen data distribution, and there-
fore are highly desirable. In this paper, we propose for the
ﬁrst time an unsupervised learning framework for consen-
sus maximization, in the context of solving 3D vision prob-
lems. For that purpose, we establish a relationship be-
tween inlier measurements, represented by an ideal of in-
lier set, and the subspace of polynomials representing the
space of target transformations. Using this relationship, we
derive a constraint that must be satisﬁed by the sought in-
lier set. This constraint can be tested without knowing the
transformation parameters, therefore allows us to efﬁciently
deﬁne the geometric model ﬁtting cost. This model ﬁtting
cost is used as a supervisory signal for learning consen-
sus maximization, where the learning process seeks for the
largest measurement set that minimizes the proposed model
ﬁtting cost. Using our method, we solve a diverse set of
3D vision problems, including 3D-3D matching, non-rigid
3D shape matching with piece-wise rigidity and image-to-
image matching. Despite being unsupervised, our method
outperforms RANSAC in all three tasks for several datasets.

1. Introduction

In 3D vision, problems such as Structure-from-Motion
(SfM) [26, 16, 12] and image registration [17, 30] are ge-
ometrically solved from noisy measurements with outliers.
In that context, consensus maximization among inlier mea-
surements, is very often a crucial step. Typically, the max-
imum consensus is searched using the Random Sampling

and Consensus (RANSAC) algorithm [13] or its deriva-
tives [35, 44, 37]. During this process, almost all geo-
metric models are represented by a system of polynomi-
als whose common root speciﬁes the desired transforma-
tion parameters. Polynomial-based geometric model repre-
sentations, when used with RANSAC, offer accurate trans-
formation parameters, therefore are used for a diverse set
of problems [12, 17, 30, 20]. Globally optimal meth-
ods [10, 33, 42, 2, 15, 3, 23, 49], which overcome limita-
tions of RANSAC, further bolster the importance of maxi-
mizing consensus. However, most methods that seek con-
sensus maximization solely depend upon the geometric
models. They do not exploit knowledge about the scene
or their measurement distributions.

Learning for consensus maximization is an alternative
approach which has the potential of providing a higher in-
lier/outlier classiﬁcation accuracy, by leveraging the dis-
tribution of the given data. Additionally, the supervisory
signal for consensus maximization may help to learn other
related tasks, within the framework of multi-task learn-
ing. Owing to the success of deep learning, recent methods
have tackled the consensus maximization problem for im-
age matching using the Fundamental matrix [36], the Essen-
tial matrix [48] and for the absolute pose [7]. These meth-
ods use supervision through ground-truth labels to train a
neural network for classifying correspondences as inliers or
outliers. Other methods, [36, 48] respectively use Funda-
mental or Essential matrix models, which require supervi-
sion by their associated matrices to train the network param-
eters. Unfortunately, such networks, trained in a supervised
manner, are not on par with RANSAC in terms of their gen-
erality to unseen data distribution. Moreover, ground-truth
geometric models are sometimes difﬁcult to obtain, or even
non-existent [16]. In this scenario, unsupervised methods
have a huge potential, as they can adapt to any unseen data
distribution, and therefore are highly desirable.

In this paper, we propose an unsupervised framework to
learn consensus maximization in the context of geometric
3D vision problems. We model the geometric transforma-
tions using polynomials, as commonly done in the litera-

1929

ture [12, 16, 30]. We then develop a framework of ﬁtting
polynomials in a deep architecture while maximizing the
consensus. To develop such method, we ﬁrst establish a re-
lationship between inlier measurements, represented by an
ideal of the inlier measurements, and the subspace of poly-
nomials representing the space of target transformations.
This relationship is then used to formulate a loss function
for ﬁtting polynomials, as the singular values minimization
problem on the so-called Vandermonde matrix [4, 8].While
minimizing the proposed loss function, our training pro-
cess also seeks for the largest consensus among the mea-
surements. Thereby our formulation evaluates the consis-
tency to the geometric model without regressing the model
parameters, which is known to be sensitive for robust es-
timation tasks within supervised setups [36, 48]. Regard-
less, one may still think of using a robust regression-based
formulation, e.g. based on m-estimators. However, mini-
mizing such robust loss function may provide satisfactory
results only when outliers are relatively few [31, 2].

Our loss function on the other hand is designed to train a
correspondence classiﬁcation network, and it naturally ex-
tends to many transformation models that can be expressed
by one or more polynomials. Notably, we neither require
classiﬁcation labels, nor the ground-truth transformations.
To the best of our knowledge, our work is the ﬁrst to learn
a deep architecture in an unsupervised manner for consen-
sus maximization in 3D vision problems. Our method is
adapted to a diverse set of 3D vision problems: 3D-3D rigid
body transformation, non-rigid shape matching with piece-
wise rigidity and uncalibrated 2D transformations (Funda-
mental matrix and homography). We experimentally show
that our method is able to outperform RANSAC in all of
the mentioned tasks, while being unsupervised. We further
empirically show how the accuracy of supervised methods
worsens when tested on different data statistics. This dete-
rioration in accuracy could be recovered to a large extend,
using the proposed unsupervised training framework.

2. Related Work

We brieﬂy summarize the related work to put our pa-
per into context. Consensus maximization is a well stud-
ied topic
[12, 17, 30, 20], and is usually solved with
RANSAC [13, 35, 44, 37].
In contrast to heuristic ap-
proaches, global methods provide optimality guaranties
[10, 33, 42, 2, 15, 3, 23, 49]. Recently, supervised ma-
chine learning has been leveraged to solve consensus max-
imization and robust estimation. With regards to two-view
[48, 36] learn from keypoint correspondences,
geometry,
whereas [32, 29] regress transformation parameters directly
from the input images. [7] integrate a differentiable version
of RANSAC into their network to robustify camera local-
ization. Although they may show beneﬁcial accuracy (w.r.t.
to classical RANSAC) and speed (compared to global meth-

ods), the generalizability of supervised methods is limited
to the domain of the training data and to the level of ab-
straction of the input data. In contrast, our method takes
inspiration from algebraic varieties [4, 9] to train a deep
network for inlier/outlier classiﬁcation in an unsupervised
fashion. We build on permutation-invariant networks which
recently gained attention for learning on unordered point
sets [34, 24, 46], by adapting the PointNet [34] architecture.

3. Background and Theory

3.1. Consensus Maximization

Given a set X = {(ui, vi), i = 1, . . . , m}, of correspond-
ing measurements, the consensus maximization problem in-
volves ﬁnding the largest subset Ω ⊆ X that can be ex-
plained by a single parametric transformation Φ. For every
pair (u, v) ∈ Ω, the distance between v and the transformed
measurement Φ(u) is smaller than a threshold ǫ. Mathe-
matically, the problem of consensus maximization is,

 Ω 

max
Φ,Ω⊆X
s.t. d(Φ(ui), vi) ≤ ǫ, ∀(ui, vi) ∈ Ω.

(1)

We represent Φ using polynomials as commonly done in
the literature. In this regard, (1) is an algebraic problem of
ﬁnding a variety V of known dimension – representing Φ –
such that the distance from every inlier member of X to V is
bounded by a given threshold ǫ. After a general formulation
of our task, we ﬁrst discuss the problem of consensus max-
imization in the absence of noise. The case of noisy data is
considered later.

3.2. Problem Formulation

i , v⊺

Consider the ring R[x] ∶= R[x1, ..., xn]d of multivari-
ate polynomials of degree ≤ d and an algebraic variety
V ⊆ Rn deﬁned such that V ∶= {x ∈ Rn ∶ pj(x) = 0}. Let
xi = (u⊺
i )⊺ ∈ Rn be a measurement vector representing a
pair of correspondences in X . Primarily, we are interested
in ﬁnding Ω ⊆ X which vanishes on some variety V con-
strained by Φ, where X is corrupted by outliers. Recovering
V exactly is an NP-hard problem because every polynomial
in the ideal I(V)∶ = {∑j gj(x)pj(x) ∶ gj(x) ∈ R[x]} van-
ishes on V as well. Nevertheless, the existence of the ideal
I(V) implies the existence of V. In this context, an exam-
ple problem of ﬁtting a 3D line, represented by Φ, involves
an ideal I(V) of some one-dimensional variety V, which is
parameterized by two intersecting planes p1(x) and p2(x).
As shown in Fig. 1, the ideal I(V) is represented by a pen-
cil of planes passing through the line. The desired inlier
set is the largest Ω ⊆ X for which there exists a line – rep-
resented by V of dimension one – passing through all 3D
points x ∈ Ω. While seeking for Ω, we ensure the existence
of V(Ω) ∶= {V ∶ Ω ⊆ V} by ensuring the existence of I(Ω).

930

Deﬁnition 3.3 The Vandermonde matrix Md(Ω) ∈ Rm×s is
a matrix with the terms of a geometric progression monomi-
als in each row, such that the entries mij are the monomials
xe = xe1
For example, if n = 1, d = 3, and Ω = {x1, x2, x3} then
M3(Ω) is the Vandermonde matrix of the form,

n of degree at most d.

2 . . . xen

1 xe2

Figure 1. 3D Line Fitting. Finding a one-dimensional variety V
from a sample set X . V is the intersection of planes p1(x) and
p2(x). The ideal I(V) is a pencil of planes.

M3(Ω) =

⎡⎢⎢⎢⎢⎢⎣

x3
x3
x3

1 x2
2 x2
3 x2

1 x1
2 x2
3 x3

1
1
1

⎤⎥⎥⎥⎥⎥⎦

.

Deﬁnition 3.1 The ideal I(Ω) is a set of polynomials that
vanishes on the samples of Ω. i.e. I(Ω) ∶= I(V(Ω)).

One can argue that there always exists some I(Ω), even
when Ω = X . However, we are interested in only those
I(Ω) which lie in the space of valid transformations Φ, rep-
resented by the polynomial basis B ⊆ R[x]. We assume that
Φ resides within the vector space spanned by B.

Deﬁnition 3.2 The basis B is a set of monomial bases of
R[x] and RB = R[B] is the subspace of polynomials
spanned by B. Any polynomial in RB can therefore be rep-
resented by a coefﬁcient vector in Rs for s =  B .

The polynomial representation of Φ involves r linearly in-
dependent equations in RB that vanish for all x ∈ Ω. For
example, while ﬁtting lines and spheres in 3D, (r, RB) are
(2, R[x1, x2, x3]1) and (1, R[x1, x2, x3]2), respectively.

The consensus maximization problem can be reformu-
lated as the search for the largest inlier set Ω, for which
there exists some ideal I(Ω) whose intersection with RB
spans exactly r dimensions:

 Ω  ∶ dim(I(Ω) ∩ RB) = r.

max
Ω⊆X

(2)

Intuitively, the problem of (2) demands that I(Ω) must van-
ish on all polynomials represented by r equations in RB, as
required by Φ. Recall the example of Fig. 1. The line V lives
in the space of linear polynomials RB = R[x1, x2, x3]1 of
dimension 2. In other words, one needs 2 independent lin-
ear equations to represent a line in 3D. Among all linear
polynomials (in RB) that vanish on Ω, we require exactly
two to be independent. These equations indeed represent
two intersecting planes, thus the line V.

Note that Md(Ω) grows linearly in the number of samples
m as well as in the number of monomials s, and therefore
is a compact representation. One of the key properties of
the Vandermonde matrix, which allows us to analyze the
existence of I(Ω) ∩ RB, is stated below.
Theorem 3.4 The kernel ker(Md(Ω)) of the Vandermonde
matrix Md(Ω) equals to the vector space I(Ω)∩RB. i.e. all
polynomials that are linear combinations of B and vanish
on Ω are represented by I(Ω) ∩ RB = ker(Md(Ω)).
Using Theorem 3.4, the problem of (1) is expressed as the
following constrained cardinality maximization problem,

 Ω ,

max
Ω⊆X

s.t.

dim(ker(Md(Ω))) = r.

(3)

In the presence of noise, however, the constraint on
the kernel dimension of the Vandermonde matrix Md(Ω),
given in (3), is difﬁcult to satisfy. Therefore, we enforce
the dimensionality constraint by minimizing the singular
values of Md(Ω) [18]. For descending singular values
σ1, σ2, . . . σs of Md(Ω), the trailing r singular values must
be zero for the constraint of (3) to be true. Hence, we relax
the problem of (3), for a given scalar λ, as follows,

 Ω  − λ

max
Ω⊆X

r−1
Q
k=0

σs−k(Md(Ω)).

(4)

Maximizing the cardinality can be thought of a subset selec-
tion problem, expressed using a set of binary variables wi ∈
{0, 1} (de-)activating the corresponding rows in Md(Ω).

max

w∈{0,1}m

m
Q
i=1

wi − λ

r−1
Q
k=0

σs−k(diag(w)Md(X )).

(5)

Exact solving of (5) involves combinatorial optimization
and is not tractable in practice. Therefore, we relax the
problem by introducing a soft selection of inliers using con-
tinuous sample weights wi as follows.

3.3. Ideals and Sample Sets

The relationship between an ideal I(Ω) and the sample
set Ω ⊂ Rn can be established with the help of the so-called
Vandermonde matrix. This also allows us to reason about
the existence of I(Ω) ∩ RB for the chosen bases B.

max
w∈Rm

m
Q
i=1

wi − λ

r−1
Q
k=0

σs−k(diag(w)Md(X )), s.t. 0 ≤ wi ≤ 1.

(6)

Equation (6) is still not convex, however, it is differentiable
and can be optimized using gradient-based methods.

931

3.4. Recovering the Ideal

In some cases, we are interested in actually recovering
the ideal P = I(Ω) ∩ RB, for example to compute the pa-
rameters of the transformation Φ. Consider the SVD de-
composition of M(X ) = UΣVT . Recall that the ideal of our
interest P lies on the kernel of M(X ). Therefore we can ex-
tract the corresponding polynomials from the nullspace of
M(X ), represented by the trailing r right singular vectors,

B = [ vs vs−1 . . . vs−r+1 ] ∈ Rs×r.

(7)

Let p(x) be the vector of monomials in B. The recovered
ideal P is then deﬁned by P = {BT p(x) = 0}.

3.5. Deep Learning for Consensus Maximization

Besides direct optimization of Eq. (6) for a given set of
correspondences, it can be thought of a supervisory signal
for learning consensus maximization from data. Given a
neural network wθ(X ) ∶ Rm×n → [0, 1]m parametrized by
θ, we wish to learn prediction score wi for each sample
xi ∈ X , that maximizes the number of inliers (wi → 1), while
rejecting outliers (wi → 0). To this end, we deﬁne a differ-
entiable supervisory signal that requires neither point-wise
labels, nor knowledge about the ground truth transformation
between correspondences. Given sample set X , we aim to
learn the optimal parameters θ by minimizing the following
empirical loss ℓ(θ, X ) based on Eq. (6).

ℓ(θ, X ) = − wθ(X )1 + λ

r−1
Q
k=0

σs−k(diag(wθ(X ))Md(X )).

(8)

The input to our network is a set of correspondences X .
Consequently, we require a architecture that is invariant to
the permutation of the input, whereas most neural networks
were designed for ordered input data, e.g. 2D images. How-
ever, recent advances in deep learning on unordered point
sets [34, 24, 46] allow a suitable choice of architecture for
our problem. We employ the PointNet [34] segmentation ar-
chitecture to encourage a global reasoning about the under-
lying transformation. The key component of the architec-
ture is a max-pool operation across correspondences before
computing a global feature vector (GFV). The GFV is then
concatenated to the pointwise features to exploit the global
context for the point-wise predictions. Since our goal is bi-
nary inlier classiﬁcation, we add an element-wise sigmoid
layer that outputs inlier prediction scores wi in the range
[0, 1]. We deﬁne our prediction function wθ(X ) as

wθ(X )i = s(Cθ(X )i),

s(x) = (1 + e−x)−1,

(9)

with the PointNet-seg output denoted as Cθ(X ) ∈ Rm. To-
gether with the loss function (8), our architecture can the be

modeled using standard building blocks: after construction
of the Vandermonde Matrix Md(X ) ∈ Rm×s, every row i
gets weighted with the corresponding inlier probability wi.
Then we compute the last r singular values of the weighted
Vandermonde matrix using the differentiable SVD opera-
tion. The architecture is illustrated in Fig. 2. We implement
the network in tensorﬂow [1] and use the ADAM [19] opti-
mizer to learn the parameters θ.

By design, our approach generalizes over transformation
functions that can be represented by polynomial equations.
In the following sections we explain how the Vandermonde
loss can be adapted to geometric transformation problems.

4. 3D Vision Problems

In this section, we present four examples of 3D vision
problems for consensus maximization problems and intro-
duce different problem speciﬁc RB subspace constraints.

Unfortunately, non-linear constraints on transformation
parameters can not be directly applied in this framework.
However, since we can compute the ideal P and extract the
parameters of the model, we are able to introduce a regular-
ization term on the solutions.

4.1. Rigid Body Transformation

We consider correspondences between two point clouds
that differ by a 3D rigid body transformation. Let {u, v} be
euclidean coordinates of a pair of points such that

v = Ru + t, R ∈ SO(3), t ∈ IR3.

(10)

We can see that Eq. (10) involves r = 3 linear equa-
tions in the coordinates of corresponding points. There-
fore we can restrict the polynomial subspace RB to linear
terms B = {ux, uy, uz, vx, vy, vz, 1}. This leads to a Van-
dermonde matrix M(X ) ∈ Rm×7, with kernel dimension 3.
Note that this representation holds for any 3D afﬁne
transformation, since it does not enforce rotation manifold
and scale constraints. We therefore introduce an additional
regularization term on the recovered ideal P. Recall that we
extract the basis B of P according to Eq. (7). The recovered
polynomials in P are some linear combination of Eq. (10).
To recover the components of R and t, we need a change of
basis to separate vx, vy and vz in each equation. The desired
basis B′ of the form in Eq. (10) can be obtained by

B′ = −[ bT

4 bT

5 bT

6 ]−T B = [ ˆR − I3×3 ˆt ],

(11)

where bi denotes the ith row of the matrix B. This form
offers direct access to the estimated rotation and translation
parameters. To avoid numerical issues, we add a small iden-
tity matrix before the matrix inversion in our implementa-
tion. Based on this observation, we deﬁne a regularizer ℓr,

ℓr(θ, X ) = log 1 + ˆRˆRT − I3×32 .

(12)

932

Figure 2. Method Overview. A set of correspondences X is fed to a network that outputs inlier scores w. Every score weights its
corresponding row in the Vandermonde matrix Md(X ) . We minimize the last singular values of Md(X ), while maximizing the number
of inliers. Training uses only the knowledge about the polynomial structure of transformation Φ.

The log serves for extenuation of spike-like behaviour.
We add λrℓr(θ, X ) to the Vandermonde loss (8). Note that
(12) can be also adapted to similarity transform by encour-
aging orthogonality after normalizing by scale.

Non-rigid Extension. Theoretically, there is no reason
to assume that our network can learn the inlier statistics
of only one rigid transformation in the data. As long
as a consistent transformation pattern is present, correla-
tions between inliers can be extracted by an accordingly
trained network [45].
In this work, we investigate this
idea in the context of unsupervised learning. We assume
that the transformation can be approximated by piece-wise
rigidity, a well studied approximation for non-rigid sur-
faces [43, 28, 38, 21]. Consequently, we model the global
non-rigid deformation by rigid transformations on local
neighborhoods. A straight forward approach is to compute
our loss deﬁned for 3D rigid transformation on local neigh-
borhoods of the input point set. Given a K-neighborhood
Na of an anchor point ua ∈ U on the ﬁrst point cloud, we
assemble a local Vandermonde matrix M(Na). The loss is
then computed according to Alg. 1.

Algorithm 1 Piecewise-rigid loss ℓpr(θ, X , K)

0. Deﬁne a reference point set U = {ui ∶ (ui, vi)∈X }.
1. Randomly sample an anchor point ua ∈ U.
2. Compute the (geodesic) neighborhood of ua

Na = {(ui, vi)∈X ∶ d(ua, ui) ≤ δ}, where  Na  = K.

3. Assemble the local Vandermonde matrix M(Na).
4. Extract Ba (7) of M(Na) to compute ℓr(θ, Na) (12).
5. Compute ℓ(θ, Na) (8).
6. Return ℓ(θ, Na) + λrℓr(θ, Na).

Random sampling of anchor points ua may result in gra-
dients of high variance and unstable training. We observed
that larger batch size and low learning rate gives stable gra-
dients and improves learning signiﬁcantly.

4.2. Uncalibrated 2 View Geometry

We now consider correspondences {ui, vi}m

i=1 between
2D image points of uncalibrated perspective cameras. De-
pending on the camera motion, the relationship between two
views can be described by either a Fundamental matrix or
homography, as expressed by

uT Fv ∼ 0,
u − Hv ∼ 0,

for Fundamental matrix F ∈ R3×3.
for Homography H ∈ R3×3.

(13)

(14)

An interesting property is that both share the same poly-
nomial subspace RB of second degree polynomials in 2
variables: B = {ux, uy, vx, vy, uxvx, uxvy, uyvx, uy, vy1}.
However, the Fundamental matrix (13) is represented by
r = 1 basis in RB, whereas homography (13) is constrained
by r = 3 bases. The similarity of the polynomials of (13)
and (14) allows us to train one network that can handle both
cases simultaneously, by simply minimizing one or three
singular values. This gives a signiﬁcant practical advantage
over other approaches including RANSAC, that results in an
incorrect Fundamental matrix under degenerate motions.

Note that in case of the Fundamental matrix we cannot
directly enforce F to be rank-deﬁcient. Given the estimated
Fundamental matrix ˆF ∈ R3×3, recovered from the basis B ∈
R9 by reshaping, we thus deﬁne a regularization term

ℓf (θ, X ) = σ3(ˆF),

(15)

that minimizes the last singular value. Again, we add
λf ℓf (θ, X ) to form the complete loss.

5. Experimental Results

We conduct a variety of experiments to validate the de-
veloped theoretical framework and to demonstrate the per-
formance of unsupervised learning for consensus maxi-
mization. When comparing with RANSAC, we assume
50% outlier rate and tune the parameters accordingly. In ex-
periments with real data, we compute the ROC curves and
select the optimal operating point for each method.

933

Figure 3. 3D-3D Rigid body transformation estimation with increasing outlier rate. We evaluate inlier detection rate, outlier detection
rate, and F1-score on the ModelNet-40 test set by varying the ratio of synthetically introduced outliers. We compare training on synthetic
data and ModelNet-40 training set, for both supervised and unsupervised training setups.

Figure 4. 3D-3D Rigid body transformation estimation with increasing noise level. From left to right: Evaluation of the impact on
F1-score, rotation error, and translation error on ModelNet-40 test set using 60% synthetic outliers.

Synthetic data supported training. Although we are able
to train our network from scratch, with competitive results
in the presence of up to 50% outliers, the process beyond
that becomes delicate. Nevertheless, when supported with
initialization using synthetic data, the training behaviour
turns out to be as expected, with very competitive results
for outliers up to 98%, on real data with very different dis-
tributions. Note that we are concerned to maximize the con-
sensus for 3D vision problems. In this context, generating
such synthetic data from noise is straightforward. However,
as expected, training on synthetic data alone is not enough
to get good overall performance on real data, given the im-
mutable difference in statistics.
Implementation details. We trained using a batch size of
64 samples, each containing 512 correspondences. Training
was performed for a ﬁxed number of 100 epochs with learn-
ing rate decay of 0.9 every 10 epochs, starting from 10−3.
The hyperparameters were set as λ = 0.15, λr = λf = 0.01.
We generated synthetic data for pretraining by uniform sam-
pling of 3D points, and applying a random 6-DoF pose. For
the two-view data, we uniformly sampled three euler angles
from [−60, 60] degrees and a random translation.

5.1. 3D 3D Rigid Body Transformation

We begin by investigating the behaviour of our method
in scenarios of varying outlier rates and noise levels in
semi-synthetic experiments on 3D-3D rigid body transfor-
mation. The following experiments were conducted on the
ModelNet-40 [47] dataset, with the default train/test split.
We sampled 512 points from each model, and added 1%
noise on the points. We then applied an unconstrained
rigid transformation and randomly mixed correspondences

In Fig. 3
to generate the desired number of outliers.
we plot the inlier and outlier detection rates and the F1-
measure in order to compare to several baselines. Here,
we evaluate the performance of two methods for pretrain-
ing on the synthetic data: supervised (synth-sv) and unsu-
pervised (synth-unsv). For synth-unsv, we trained using
the Vandermonde Loss (8), starting with only 10% outlier
rate and gradually increasing to 95% outlier rate, whereas
synth-sv is directly trained using cross entropy loss. Nat-
urally, supervised pretraining performs better. More inter-
estingly, with unsupervised ﬁnetuning we observe large im-
provement over both pretrained methods. Among the ﬁne-
tuned models, synth-sv+modelnet-unsv slightly outper-
forms synth-unsv+modelnet-unsv in the domain of high
outlier rates, while approaching the performance of the end-
to-end supervised method modelnet-sv. We can therefore
conclude that 1) supervised pretraining is more effective,
2) data speciﬁc ﬁnetuning is necessary and 3) unsuper-
vised ﬁnetuning is able to adapt to the different statistics
of ModelNet-40. Moreover, the experiments demonstrate
that RANSAC is not useful as a supervisory signal at the
outlier rates beyond 60%.

For the second experiment, we varied the noise level
from 0% to 5% at a ﬁxed outlier rate of 60%. As depicted
in Fig. 4 the F1-score for all trained methods is fairly stable,
whereas RANSAC starts deteriorating beyond 2% noise.
More importantly, evaluating the rotation and translation
errors of the models estimated from the respective inliers,
we ﬁnd that synth-sv performs exceptionally bad. We at-
tribute this to the fact that the domain gap results in a fairly
good accuracy (similar to RANSAC), but it is unable to re-
ject some very bad outliers, thus leading to an inadequate

934

Figure 5. 2-View geometry estimation with increasing outliers. From left to right: Evaluation on ModelNet-40 test data with Funda-
mental matrix, on a 50-50 mixture of Homography and Fundamental matrices, and on pure Homography.

Figure 6. Non-rigid shape matching. From left to right: Sparse SfM source point cloud; the reference SMPL [27] model; correspondences
classiﬁed by our network (inliers in black and outliers in red); top views of inliers (on top) and outliers (at bottom) shown separately; and
front and side views of the mesh model obtained after performing articulated ICP initialized using our detected inliers. Red points in the
last two images are the SfM point cloud superimposed on the ﬁtted mesh model.

Figure 7. Rigid body transformation. Correspondence classiﬁca-
tion result of our approach on the T-Rex dataset [10] (85% outliers)
using PFH [39] matches. Inliers and outliers are visualized on the
left side, the aligned models in two views on the right side.

Figure 8. 2D-2D Homography estimation with increasing out-
liers. Left: Comparing F1-score with variants of RANSAC on
ModelNet-40 test set. Right: Run-time of various methods.

Figure 9. 2D-2D Fundamental matrix estimation. ROC curve on
Middlebury Temple (top). The right ﬁgure shows operating points
of four methods on three real datasets. η is the outlier rate.

ﬁt. Our method synth-sv+modelnet-unsv performs com-
petitive to the supervised model, consistently outperforming
other methods in all metrics. We conclude that minimizing
our loss gives better classiﬁcation accuracy and leads to bet-
ter models, thus validating our theoretical considerations.

In Fig. 7 we show a qualitative result on the T-Rex
dataset [10] (85% outliers) of our unsupervisedly trained
outlier removal network for PFH [39] feature matches.

5.2. 2D 2D Homography & Fundamental Matrix

We now analyze the performance on 2D-2D Fundamen-
tal matrix and homography estimation tasks. First, we
investigate the behaviour on semi-synthetically generated
data. We projected 3D points from ModelNet-40 data on
two views with varying motions and focal lengths, and
added 3px noise. The left plot in Fig. 5 compares pre-
training, our method, and supervised learning on Funda-

935

mental matrix estimation. We observe slight improvement
over pretraining, with ﬁnetuning getting close to supervised
performance. This can be attributed to the similar motion
statistics used in pretraining. Here, we omitted compar-
isons with other supervised methods [36] that showed per-
formance on par with modelnet-sv. In the middle and right
plot of Fig. 5, we tested on 50% and 100% homographies,
respectively. Here, we trained our model on both homogra-
phy and Fundamental matrix (see Eq. (14) and (13)), only
knowing the type of the motion (not the parameters) at train-
ing time (not at test time). We compare to RANSAC with
Fundamental matrix and homography model, and to a state-
of-the-art supervised method for Fundamental matrix esti-
mation [36] dfme-sv. We can clearly see that our unsu-
pervised method can handle both cases, as opposed to the
single model approaches that fail to to reject outliers by ﬁt-
ting Fundamental matrix to homography data. For up to
80% outliers, the unsupervised approach is very competi-
tive with the fully supervised modelnet-sv.

We further compare the F1-score and runtime with var-
ious variants of RANSAC [35] and a globally optimal
method [11] on homography estimation in Fig. 8. The best
baseline USAC works reliably until 70% outlier rate. Ex-
tending to 80% involves increasing the max. iterations 100-
fold to 50k, severely impacting runtime. The global optimal
method [11] is orders of magnitude slower and fails above
10% outliers, making it not practical in general. Note that
our implementation is by no means optimized for efﬁciency.
The next set of experiments was conducted with real
matches on three different datasets where the groundtruth
motion was known: Temple and Dino from the Middlebury-
MultiView dataset [41], and one sequence of KITTI [14].
We disjointly sampled frames for training and testing, com-
puted SIFT keypoints and matched across distance of up
to 5 neighboring frames. In the left plot of Fig. 9 we vi-
sualize the classiﬁcation performance by plotting the ROC
curve over varying classiﬁcation thresholds. We observe
that unsupervised training gives AuC and operating points
very competitive to supervised training. In the middle of
Fig. 9 we plot operating points for all methods on all three
datasets. Note that the pretrained model synth-sv yields
suboptimal results and is consistently improved by unsuper-
vised ﬁnetuning to a level similar to the supervised model.

5.3. Non rigid 3D Shape Matching

To gauge the capabilities of our method to learn non-
rigid transformations, we experiment on the FAUST [6]
dataset. The dataset offers 10 subjects of different body
shape in 10 different poses. We take one subject as a ref-
erence model, and precompute the geodesic neighborhood.
For every training sample, we compute the local loss ac-
cording to Alg. 1. Training is conducted in a curriculum
learning fashion: starting with one global transformation

DFM [25]
MFCM [33]
synth-sv
synth-sv+unsv
KM [22]
MFCM [33]
synth-sv
synth-sv+unsv

Inlier / Outl.
4211 / 772
3918 / 31
3812 / 74
3814 / 58
4736 / 181
4556 / 17
3811 / 23
3957 / 19

Time [s]

1.0
24
0.8
0.8
89
110
0.8
0.8

Inl. / Outlier
3756 / 1227

3437 / 93
2601 / 82
3122 / 11
4051 / 860
3634 / 161
2371 / 171
3303 / 40

Time [s]

1.0
19
0.8
0.8
92
115
0.8
0.8

Intra-subject

Inter-subject
Table 1. Non-rigid 3D shape matching.
Our results on
FAUST [6] intra- and inter-subjects vs. [22] and [33]. We report
the number of true positive (inliers) and false positive (remaining
outliers) matches, as well as run time on CPU.

(K = 512), we linearly reduce the number of neighbors in
every epoch down to K = 100. Results on two datasets
are reported in Table 1:
intra-subject (mostly isometric,
pose variation) and inter-subject (non-isometric, similar
poses). Initial matches are computed using DFM [25] and
KM [22]. Again, we observe that the unsupervised method
adapts to the method-speciﬁc outlier statistics, whereas the
method pretrained on synthetic outliers fails to generalize.
Compared to the isometric consensus maximization method
MFCM [33], we loose more inliers, which can be attributed
to the fact that piecewise rigidity is not the entirely cor-
rect deformation model. In Fig. 6 we give a qualitative re-
sult on matching a sparse SfM point cloud, reconstructed
from 72 images using Colmap [40] to the SMPL [27] ref-
erence model. We train our network to ﬁlter matches from
KM [22]. The resulting set of matches enables ICP-based
reﬁnement [5] on body pose and shape.

6. Conclusions

In this paper we introduced a method for unsupervised
learning of consensus maximization. Based on the relation-
ship between inlier measurements, represented by an ideal
of the inlier set, and the subspace of polynomials represent-
ing the space of target transformations, our formulation al-
lows to train a neural network for inlier/outlier classiﬁca-
tion, without knowing ground truth correspondences or the
model parameters. Our experiments conﬁrm that there is
a huge potential in adapting learning-based methods to un-
seen data domains. We demonstrate on a diverse set of 3D
vision problems that our method can successfully ﬁnetune
to new data without external supervision, thus replicating
the generic behaviour of RANSAC. For future work, we are
interested in investigating the case where the type of trans-
formation is also unknown, by jointly ﬁnding the polyno-
mial basis RB, on which suitable polynomials reside.

Acknowledgements. This research was funded by the EU
Horizon 2020 programme, grant No. 687757 – REPLI-
CATE and by the Swiss Commission for Technology
and Innovation (CTI), Grant No.
26253.1 PFES-ES –
EXASOLVED.

936

References

[1] M. Abadi, P. Barham, J. Chen, Z. Chen, A. Davis, J. Dean,
M. Devin, S. Ghemawat, G. Irving, M. Isard, M. Kudlur,
J. Levenberg, R. Monga, S. Moore, D. G. Murray, B. Steiner,
P. A. Tucker, V. Vasudevan, P. Warden, M. Wicke, Y. Yu, and
X. Zhang. Tensorﬂow: A system for large-scale machine
learning. In OSDI, 2016. 4

[2] J.-C. Bazin, H. Li, I. S. Kweon, C. Demonceaux, P. Vasseur,
and K. Ikeuchi. A branch-and-bound approach to correspon-
dence and grouping problems. IEEE transactions on pattern
analysis and machine intelligence, 35(7):1565–1576, 2013.
1, 2

[3] J. C. Bazin, Y. Seo, R. I. Hartley, and M. Pollefeys. Globally
optimal inlier set maximization with unknown rotation and
focal length. In ECCV, 2014. 1, 2

[4] A. Bj¨orck and V. Pereyra. Solution of vandermonde systems
of equations. Mathematics of Computation, 24(112):893–
903, 1970. 2

[5] F. Bogo, A. Kanazawa, C. Lassner, P. V. Gehler, J. Romero,
and M. J. Black. Keep it smpl: Automatic estimation of 3d
human pose and shape from a single image. In ECCV, 2016.
8

[6] F. Bogo, J. Romero, M. Loper, and M. J. Black. FAUST:
Dataset and evaluation for 3D mesh registration. In Proceed-
ings IEEE Conf. on Computer Vision and Pattern Recogni-
tion (CVPR), Piscataway, NJ, USA, 2014. IEEE. 8

[7] E. Brachmann, A. Krull, S. Nowozin, J. Shotton, F. Michel,
S. Gumhold, and C. Rother. Dsac-differentiable ransac for
camera localization. In CVPR, volume 3, 2017. 1, 2

[8] P. Breiding, S. K. Verovsek, B. Sturmfels, and M. Weinstein.
Learning algebraic varieties from samples. arXiv preprint
arXiv:1802.09436, 2018. 2

[9] P. Breiding, S. K. Verovsek, B. Sturmfels, and M. Weinstein.
Learning algebraic varieties from samples. arXiv preprint
arXiv:1802.09436, 2018. 2

[10] T. J. Chin, Y. H. Kee, A. Eriksson, and F. Neumann. Guaran-
teed outlier removal with mixed integer linear programs. In
CVPR, 2016. 1, 2, 7

[11] T.-J. Chin, P. Purkait, A. P. Eriksson, and D. Suter. Ef-
ﬁcient globally optimal consensus maximisation with tree
search. 2015 IEEE Conference on Computer Vision and Pat-
tern Recognition (CVPR), pages 2413–2421, 2015. 8

[12] O. D. Faugeras. What can be seen in three dimensions with
an uncalibrated stereo rig. In ECCV, pages 563–578, 1992.
1, 2

[13] M. A. Fischler and R. C. Bolles. Random sample consen-
sus: A paradigm for model ﬁtting with applications to im-
age analysis and automated cartography. Commun. ACM,
24(6):381–395, 1981. 1, 2

[14] A. Geiger, P. Lenz, and R. Urtasun. Are we ready for au-
tonomous driving?
In
Conference on Computer Vision and Pattern Recognition
(CVPR), 2012. 8

the kitti vision benchmark suite.

[15] R. I. Hartley and F. Kahl. Global optimization through rota-

tion space search. IJCV, 82(1):64–79, 2009. 1, 2

[16] R. I. Hartley and A. Zisserman. Multiple View Geometry
in Computer Vision. Cambridge University Press, ISBN:
0521540518, second edition, 2004. 1, 2

[17] J. A. Hesch and S. I. Roumeliotis. A direct least-squares
(DLS) method for PnP. In ICCV, pages 383–390, 2011. 1, 2
[18] Y. Hu, D. Zhang, J. Ye, X. Li, and X. He. Fast and accurate
matrix completion via truncated nuclear norm regularization.
IEEE Trans. Pattern Anal. Mach. Intell., 35(9):2117–2130,
2013. 3

[19] D. P. Kingma and J. Ba. Adam: A method for stochastic

optimization. CoRR, abs/1412.6980, 2014. 4

[20] L. Kneip, H. Li, and Y. Seo. Upnp: An optimal o(n) solu-
tion to the absolute pose problem with universal applicabil-
ity. In D. Fleet, T. Pajdla, B. Schiele, and T. Tuytelaars, edi-
tors, Computer Vision – ECCV 2014: 13th European Confer-
ence, Zurich, Switzerland, September 6-12, 2014, Proceed-
ings, Part I, 2014. 1, 2

[21] S. Kumar, Y. Dai, and H. Li. Monocular dense 3d recon-
struction of a complex dynamic scene from two perspective
frames. In ICCV, 2017. 5

[22] Z. L¨ahner, M. Vestner, A. Boyarski, O. Litany, R. Slossberg,
T. Remez, E. Rodol`a, A. M. Bronstein, M. M. Bronstein,
R. Kimmel, and D. Cremers. Efﬁcient deformable shape cor-
respondence via kernel matching. In 3DV, 2017. 8

[23] H. Li. Consensus set maximization with guaranteed global
optimality for robust geometry estimation. In ICCV, 2009.
1, 2

[24] J. Li, B. M. Chen, and G. H. Lee. So-net: Self-organizing
network for point cloud analysis. CoRR, abs/1803.04249,
2018. 2, 4

[25] O. Litany, T. Remez, E. Rodola, A. M. Bronstein, and M. M.
Bronstein. Deep functional maps: Structured prediction for
dense shape correspondence. In ICCV, 2017. 8

[26] H. Longuet-Higgins. A computer algorithm for reconstruct-
ing a scene from two projections. Nature, 293:133–135,
1981. 1

[27] M. Loper, N. Mahmood, J. Romero, G. Pons-Moll, and M. J.
Black. SMPL: A skinned multi-person linear model. ACM
Trans. Graphics (Proc. SIGGRAPH Asia), 34(6):248:1–
248:16, 2015. 7, 8

[28] R. A. Newcombe, D. Fox, and S. M. Seitz. Dynamicfusion:
Reconstruction and tracking of non-rigid scenes in real-time.
In CVPR, 2015. 5

[29] T. Nguyen, S. W. Chen, S. S. Shivakumar, C. J. Taylor, and
V. Kumar. Unsupervised deep homography: A fast and ro-
bust homography estimation model. IEEE Robotics and Au-
tomation Letters, 3:2346–2353, 2018. 2

[30] D. Nist´er. An efﬁcient solution to the ﬁve-point relative
IEEE Trans. Pattern Anal. Mach. Intell.,

pose problem.
26(6):756–777, 2004. 1, 2

[31] D. P. Paudel, A. Habed, C. Demonceaux, and P. Vasseur.
Robust and optimal registration of image sets and structured
scenes via sum-of-squares polynomials. International Jour-
nal of Computer Vision, 127:415–436, 2018. 2

[32] O. Poursaeed, G. Yang, A. Prakash, Q. Z. Fang, H. Jiang,
B. Hariharan, and S. Belongie. Deep fundamental matrix
estimation without correspondences. 2018. 2

937

[33] T. Probst, A. Chhatkuli, D. P. Paudel, and L. V. Gool. Model-
free consensus maximization for non-rigid shapes. CoRR,
abs/1807.01963, 2018. 1, 2, 8

[34] C. R. Qi, H. Su, K. Mo, and L. J. Guibas. Pointnet: Deep
learning on point sets for 3d classiﬁcation and segmenta-
tion. 2017 IEEE Conference on Computer Vision and Pattern
Recognition (CVPR), pages 77–85, 2017. 2, 4

[35] R. Raguram, O. Chum, M. Pollefeys, J. Matas, and J.-M.
Frahm. Usac: a universal framework for random sample con-
sensus. IEEE Trans. Pattern Anal. Mach. Intell., 35(8):2022–
2038, 2013. 1, 2, 8

[36] R. Ranftl and V. Koltun. Deep fundamental matrix estima-

tion. In ECCV, pages 284–299, 2018. 1, 2, 8

[37] P. J. Rousseeuw. Least median of squares regression. Journal
of the American statistical association, 79(388):871–880,
1984. 1, 2

[38] C. Russell, R. Yu, and L. Agapito. Video pop-up: Monocular

3d reconstruction of dynamic scenes. In ECCV, 2014. 5

[39] R. B. Rusu, N. Blodow, and M. Beetz. Fast point feature his-
tograms (fpfh) for 3d registration. 2009 IEEE International
Conference on Robotics and Automation, pages 3212–3217,
2009. 7

[40] J. L. Sch¨onberger and J.-M. Frahm. Structure-from-motion
In Conference on Computer Vision and Pattern

revisited.
Recognition (CVPR), 2016. 8

[41] S. M. Seitz, B. Curless, J. Diebel, D. Scharstein, and
R. Szeliski. A comparison and evaluation of multi-view
stereo reconstruction algorithms. 2006 IEEE Computer Soci-
ety Conference on Computer Vision and Pattern Recognition
(CVPR’06), 1:519–528, 2006. 8

[42] P. Speciale, D. P. Paudel, M. R. Oswald, T. Kroeger, L. V.
Gool, and M. Pollefeys. Consensus maximization with linear
matrix inequality constraints. In CVPR, 2017. 1, 2

[43] J. Taylor, A. D. Jepson, and K. N. Kutulakos. Non-rigid

structure from locally-rigid motion. In CVPR, 2010. 5

[44] P. H. Torr and A. Zisserman. Mlesac: A new robust estimator
with application to estimating image geometry. Computer
vision and image understanding, 78(1):138–156, 2000. 1, 2
[45] N. Verma, E. Boyer, and J. Verbeek. Feastnet: Feature-

steered graph convolutions for 3d shape analysis. 2017. 5

[46] Y. Wang, Y. Sun, Z. Liu, S. E. Sarma, M. M. Bronstein, and
J. M. Solomon. Dynamic graph cnn for learning on point
clouds. CoRR, abs/1801.07829, 2018. 2, 4

[47] Z. Wu, S. Song, A. Khosla, F. Yu, L. Zhang, X. Tang, and
J. Xiao. 3d shapenets: A deep representation for volumet-
ric shapes. 2015 IEEE Conference on Computer Vision and
Pattern Recognition (CVPR), pages 1912–1920, 2015. 6

[48] K. M. Yi, E. Trulls, Y. Ono, V. Lepetit, M. Salzmann, and
P. Fua. Learning to ﬁnd good correspondences. In CVPR,
2018. 1, 2

[49] Y. Zheng, S. Sugimoto, and M. Okutomi. Deterministically
maximizing feasible subsystem for robust model ﬁtting with
unit norm constraint. In CVPR, 2011. 1, 2

938

