Pyramidal Person Re-IDentiﬁcation via Multi-Loss Dynamic Training

Feng Zheng∗

Cheng Deng

Department of Computer Science and Engineering

School of Electronic Enigineering

Southern University of Science and Technology

Shenzhen 518055, China

Xing Sun†, Xinyang Jiang, Xiaowei Guo,

Xidian University

Xi’an 710071, China

Rongrong Ji‡

Zongqiao Yu, Feiyue Huang

School of Information Science and Engineering,

YouTu Lab Tencent, Shanghai, China

Xiamen University, Xiamen, China

Peng Cheng Laboratory, Shenzhen, China

Abstract

Most existing Re-IDentiﬁcation (Re-ID) methods are
highly dependent on precise bounding boxes that enable im-
ages to be aligned with each other. However, due to the
challenging practical scenarios, current detection models
often produce inaccurate bounding boxes, which inevitably
degenerate the performance of existing Re-ID algorithms.
In this paper, we propose a novel coarse-to-ﬁne pyramid
model to relax the need of bounding boxes, which not only
incorporates local and global information, but also inte-
grates the gradual cues between them. The pyramid model
is able to match at different scales and then search for the
correct image of the same identity, even when the image
pairs are not aligned.
In addition, in order to learn dis-
criminative identity representation, we explore a dynamic
training scheme to seamlessly unify two losses and extract
appropriate shared information between them. Experimen-
tal results clearly demonstrate that the proposed method
achieves the state-of-the-art results on three datasets. Es-
pecially, our approach exceeds the current best method by
9.5% on the most challenging CUHK03 dataset.

1. Introduction

Person Re-IDentiﬁcation (Re-ID) aims to associate the
images of the same person captured at different physical
sites, facilitating cross-camera tracking techniques used in
vision-based smart retail and security surveillance. In gen-
eral, person Re-ID is considered to be the next high-level
task after a pedestrian detection system, so the basic as-

∗Major work was done when the author worked in YouTu Lab.
†Corresponding Author: winfredsun@tencent.com
‡Corresponding Author: rrji@xmu.edu.cn

Figure 1. The examples of part-based matching at different scales,
when bounding boxes are not aligned or parts of human body have
been occluded. The red bounding box indicates that most cues in
the two parts are varied. We can see that, in a ﬁnely partitioned
way, a handful of horizontal stripes (left) cannot be well-matched
due to different cues, while those stripes (right) in a more global
view have more similar cues.

sumption of Re-ID is that the detection model can provide
precise and highly-aligned bounding boxes. Despite the re-
cent great progress, there are limited room for the perfor-
mance improvement of existing methods due to the prob-
lems with part-based models and the difﬁculties in training.

Drawbacks of part-based models: As it is well-known,
part-based models can generally achieve promising perfor-
mance in many computer vision tasks, because these mod-
els are potentially robust to some unavoidable challenges
such as occlusion and partial variations. Actually, the per-
formance of person Re-ID in the real-world applications is
severely affected by these challenges. Thus, the recent pro-
posed Part-based Convolutional Baseline (PCB) [24] can
achieve the state-of-the-art results. PCB is simple but very
effective and even can outperform other learned part mod-
els. Nevertheless, in PCB, directly partitioning the feature

8514

...…...Image…map of backbone networks into a ﬁxed number of parts
strictly limits the capacities of further improving the per-
formance. It has at least two major drawbacks, but not lim-
ited to: 1) The overall performance seriously depends on
that a powerful and robust pedestrian detection model out-
puts a precise bounding box otherwise the parts cannot be
well-aligned. However, in most cases of challenging scenes,
current detection models are insufﬁcient to do that. 2) The
global information, which is also a very signiﬁcant cue for
recognition and identiﬁcation, is completely ignored in this
model whilst global features are normally robust to the sub-
tle view changes and internal variations. Several examples
are illustrated in Fig. 1 to show that the parts of diverse
scales are equivalently important for matching.

Difﬁculties of multi-loss training: Recent studies [10,
9] demonstrate that multi-task learning has the capabilities
to achieve advanced performance by extracting appropriate
shared information between tasks. Without loss of general-
ity, the terms “loss” and “task” will be used alternatively. In
fact, many existing Re-ID methods [26] also beneﬁt from
the multi-loss scheme to improve the performance. Gener-
ally, most multi-task methods choose to weight the losses
using balancing parameters which are ﬁxed during entire
training process. 1) The performance highly relies on an
appropriate parameter but choosing an appropriate param-
eter is undoubtedly a labor-intensive and tricky work. 2)
The difﬁculties of different tasks actually change when the
models are updated gradually, resulting in really varied ap-
propriate parameters for different iterations. 3) More im-
portantly, sampling strategies for different losses are gener-
ally diverse due to the speciﬁc considerations. For example,
hard sample sampling for triplet loss would suppress the
role of another task of identiﬁcation loss.

To address above problems, in this paper, we speciﬁcally
propose a novel coarse-to-ﬁne pyramidal model based on
the feature map extracted by a backbone network for per-
son re-identiﬁcation. First, the pyramid is actually a set of
3-dimensional sub-maps with a speciﬁc coarse-to-ﬁne ar-
chitecture, in which each member captures the discrimina-
tive information of different spatial scales. Then, a convo-
lutional layer is used to reduce the dimension of features
for each separated branch in the pyramid. Third, for each
branch, the identiﬁcation loss of a softmax function is inde-
pendently applied to a fully connected layer which consid-
ers the features as the input. Furthermore, the features of all
branches will be concatenated to form an identity represen-
tation, for which a triplet loss is deﬁned to learn more dis-
criminative features. To smoothly integrate the two losses, a
dynamic training scheme with two sampling strategies is ex-
plored to optimize the parameters of deep neural networks.
Finally, the learned identity representation will be used for
person image matching, retrieval and re-identiﬁcation.

In summary, the contribution of this paper is three-fold:

1) To relax the assumption of requiring a strong detection
model, we propose a novel coarse-to-ﬁne pyramid model
that not only incorporates local and global information, but
also integrates the gradual cues between them. 2) To max-
imally take advantage of different losses, we explore a dy-
namic training scheme to seamlessly unify two losses and
extract appropriate shared information between them for
learning discriminative identity representation. 3) The pro-
posed method achieves the state-of-the-art results on the
three datasets and most signiﬁcantly, our approach exceeds
the current best method by 9.5% on dataset CUHK03.

2. Related Work

Most existing Re-ID methods either consider the local
parts of person images or explore the global information.
Some methods [13, 26] aware of that integrating the local
and global features can improve the performance but the
information between them is also ignored. We observe that
those cues in the transition process are signiﬁcant as well.

Part-based algorithms: By performing bilinear pool-
ing in a more local way, an embedding can be learned,
in which each pooling is conﬁned to a predeﬁned region
[25].
Inspired by attention models, in [16, 14, 21], the
attention-based deep neural networks are proposed to cap-
ture multiple attentions and select multi-scale attentive fea-
tures. Similarly, Zhao et al.
[31] explore a deep neural
network method to jointly model body part extraction and
representation computation, and learn model parameters.
Based on a L2 distance, [13] formulates a method for joint
learning of local and global feature selection losses partic-
ularly designed person Re-ID. In [22], a pose-driven deep
convolutional model, which leverages the human part cues
to alleviate the pose variations, is designed to learn feature
extraction and matching models. Furthermore, both the ﬁne
and coarse pose information of the person [19] are incor-
porated to learn a discriminative embedding. A part loss is
proposed in [29], which automatically detects human body
parts and computes the person classiﬁcation loss on each
part separately. Chen et al. [4] develop a CNN-based ap-
pearance model to jointly learn scale-speciﬁc features and
maximize multiscale feature fusion selections. Several part
regions are ﬁrst detected and then deep neural networks
are designed for representation learning on both the local
and global regions [27]. Part-based Convolutional Baseline
(PCB) [24] outputs a convolutional descriptor consisting of
several part-level features and then a reﬁned part pooling
method is used to re-assign outliers in the parts. Based on
PCB, Multiple Granularity Network (MGN) [26] explores a
branch for global features and two branches for local repre-
sentations for person re-identiﬁcaiton.

Non part-based methods: Recently, a completely syn-
thetic dataset [1] and some adversarially occluded samples
[8] are constructed to train the re-identiﬁcation model. In

8515

Figure 2. The architecture of our proposed pyramidal model for person re-identiﬁcation. For better layout, only the spatial proﬁle of the
member branch in the pyramid is shown, which is originally 3-dimensional tensors. We assume that the original feature map is divided into
6 basic sub-maps, while other number of sub-maps can be used as well. The branch always consists of several consecutive basic sub-maps
and the basic operation for each branch will be given in Fig. 3.

[23], singular vector decomposition is used to iteratively in-
tegrate the orthogonality constraint in CNN training for im-
age retrieval. A pedestrian alignment network [37] is built
to learn discriminative embedding and pedestrian alignment
without extra annotations. Geng et al. [6] propose a number
of deep transfer learning models to address the data sparsity
problem and transfer knowledge from auxiliary datasets. [7]
shows that a plain CNN with a triplet loss can outperform
most recent published methods by a large margin. Learn-
ing binary representation for fast matching [33, 32] is also
a promising direction of object re-identiﬁcation. In [20], A
group-shufﬂing random walk network is proposed to reﬁne
the probe-to-gallery afﬁnities based on gallery-to-gallery
afﬁnities. The “local similarity” metrics for image pairs are
learned with considering dependencies from all the images
in a group, forming “group similarities” in [3].

Multi-task learning: Self-paced learning [10] and focal
loss [15] both train models by diversely weighting the sam-
ples in different learning stages. Inspired by this, in [11],
a task-oriented regularizer is designed to jointly prioritize
both tasks and instances. The multiple loss functions [9]
are weighted by considering the uncertainty of tasks in both
classiﬁcation and regression settings. Moreover, a routing
network consisting of two components is introduced to dy-
namically select different functions in response to the input
[18]. While, Chen et al. [5] propose a gradient normaliza-
tion algorithm that automatically balances training in deep
multitask models by dynamically tuning gradient magni-
tudes. We learn the embedding for person Re-ID by simul-
taneously minimizing a list-wise metric loss and a classiﬁ-
cation loss with two types of sampling strategies.

3. The Proposed Method

3.1. Coarse to Fine Pyramidal Model

In this section, we propose a novel coarse-to-ﬁne pyra-
midal model which can moderately relax the requirement

of detection model and smoothly incorporate the global in-
formation, simultaneously. It is worth noting that, not only
local and global information is integrated but the gradual
transition process between them is also incorporated.

3.1.1 Pyramidal Branches

Given a set of images X = {I1, · · · , IN } containing per-
sons captured by cameras in surveillance systems where
N is the number of images,
the task of person Re-
IDentiﬁcation (Re-ID) is to associate the images of the same
person at different times and locations. Our model is built
on a feature map M extracted by a backbone network BN .
Thus, we have a 3-dimensional tensor M = BN (I) of the
size C × H × W , where C is the number of encoded chan-
nels and W and H are the spatial width and height of the
tensor, respectively.

First, we divide the feature map into n number of parts
according to the spatial height axis and thus each basic part
has the size of C × (H/n) × W . Suppose that H can be
divisible by n. Thus, our pyramidal model is constructed
according to the following rules: 1) In the bottom level (l =
1) of the pyramid, there are n number of branches in which
one corresponds to a basic part. 2) The branches in higher
level has one more adjacent basic part than that of previous
lower level. 3) The sliding step for all levels is set to one. It
means the number of branches in the current level is just one
less than that of previous level. 4) In the top level (l = n)
of the pyramid, there is only one branch which is just the
original feature map M . Therefore, we assume that P{l, k}
is the kth sub-map in the lth level of the pyramid model P
deﬁned as:

P =

{M (1 : C, st : ed, 1 : W ) :
st = (k − 1) ∗ H/n + 1,
ed = (k − 1) ∗ H/n + l ∗ H/n,
l = 1, · · · , n, k = 1, · · · , n − l + 1},

(1)

8516

Task 1:ID LossTask 2:Triplet LossBasic Operation for Each BranchInputBackbone NetworkFeature MapEncoded ChannelsPyramid Model1345621234561223344556122334435546where 1 : C means that all elements from index 1 to index
C are selected. Obviously, P is a set of 3-dimensional sub-
maps with a speciﬁc coarse-to-ﬁne architecture, in which
each member captures the discriminative information of dif-
ferent spatial scales. Moreover, the pyramidal model con-
tains both the global feature map M ∈ P and the part-based
model: PCB. While, it is easy to know that there are totally
Pn
l=1 l number of components in P and the lth level has
n − l + 1 number of components, where the level index
is in a ﬁne-to-coarse fashion. The details of the proposed
architecture are shown in Fig. 2.

3.1.2 Basic Operations

For each branch P{l, k} in pyramid P, ﬁrst, a global max-
imum pooling (GMP) and a global average pooling (GAP)
is separately executed to capture the statistical properties
of different channels in the sub-maps. Then, the two sta-
tistical variables are added to form a vector with the same
size of encoded channels. Third, a convolutional layer fol-
lowed by a batch normalization and a ReLU activation is
explored to reduce the dimension and produce a feature vec-
tor x(l, k) ∈ RD for the re-identiﬁcation task. Simply, we
denote x(l, k) = BO(P{l, k}). Fourth, to make the fea-
ture vector capable of sufﬁcient discriminativity, a softmax
based IDentiﬁcation loss (ID loss) will be used for a fully
connected layer which considers the feature map as the in-
put. At the same time, a triplet loss will be imposed on a
vector x = (x(1, 1)T , · · · , x(n, 1)T )T which concatenates
all the feature vectors of different branches in the pyramid
P. The basic operations for each branch will be executed
independently with respect to different components in the
pyramid. Finally, all the parameters will be learned by si-
multaneously minimizing the two losses in a dynamic way.
A branch example consisting of two consecutive basic parts
is illustrated in Fig. 3.

If assume that f (·) refers to all the operations in the em-
bedding including BN , P and BOs, we can denote the fea-
ture as x = f (I) simply.
In the inference stage, the re-
identiﬁcation task will be achieved by ranking the distances
{d(x, xi) : x = f (I), Ii ∈ G} between a query I and a
gallery G.

3.2. Multi Loss Dynamic Training

Recent studies demonstrate that multi-task learning has
the capabilities to achieve advanced performance by ex-
tracting appropriate shared information between tasks. The
potential reason is that multiple tasks can beneﬁt from each
other by exploring the relatedness, leading to boosted gen-
eralization performance.

Figure 3. The illustration of basic operations for a branch consist-
ing of two consecutive basic sub-maps, including a global max-
imum pooling, a global average pooling, a convolutional ﬁlter,
a batch normalization, a ReLu activation and a linear fully con-
nected layer. These operations for different branches will be exe-
cuted independently and the features of all branches will be ﬁnally
concatenated for the triplet loss.

3.2.1 Two Tasks

To learn the discriminative features, we adopt two related
tasks but emphasizing different aspects to learn the parame-
ters of the embedding f , including an identiﬁcation loss and
a triplet loss. The ﬁrst one is point-wise classiﬁcation loss
while the second one is for list-wise metric learning.

Identiﬁcation loss: Generally, the identiﬁcation loss is

the same as the classiﬁcation loss deﬁned as:

Lid =

=

1
Nid

1
Nid

X

X

S((W kl

c )T xi(l, k))

(2)

i

k,l

X

X

− log

i

k,l

(W kl
Pj(W kl

c )T xi(l, k)

j )T xi(l, k)

,

where Nid is the number of used images, c denotes the cor-
responding identity of the input image Ii, S is the softmax
function and W kl
is the weight matrix of the fully con-
c
nected layer for cth identity in the (l, k) branch.

Triplet loss: Given a triplet of samples (I, Ip, In) where
I and Ip are of the same identity whilst I and In are the
images for different identities, the aim of embedding is to
learn a new feature space in which the distance between the
sample pair I and Ip will be smaller than that between the
pair I and Ip. Intuitively, a triplet loss can be deﬁned as:

Ltp =

1
Ntp

X

I,Ip,In

[d(f (I), f (Ip))

(3)

−d(f (I), f (In)) + δ]+,

where δ is a margin hyper-parameter to control the dis-
tance differences, Ntp is the number of available triplets and
[·]+ = max(·, 0) is the hinge loss.

3.2.2 Dynamic Training

The above two tasks are not novel and popularly used in
various applications. While, how to integrate them is still

8517

Encoded ChannelsGMPGAP+CovBNReLUFull ConnectionFeatureAll branchesTriplet LossConcatenateID LossSoftmaxFigure 4. Dynamic training for two related tasks with two sam-
pling strategies (i.e., ID-balanced hard triplet and randomized).

an open problem. Actually, from the general perspective,
most multi-task methods normally weight the tasks using
balancing parameters and treat some tasks as the regular-
ization items. In the learning stage, the balancing parame-
ters are ﬁxed during entire training process. 1) The perfor-
mance strictly lies in an appropriate parameter but choosing
an appropriate parameter is undoubtedly a labor-intensive
and tricky work. 2) The difﬁculty of different tasks actually
changes when the models are updated gradually, resulting in
really varied appropriate parameters for different iterations.
Furthermore, from the view of the re-identiﬁcation task,
to some extent, the two tasks are also conﬂicting when they
are directly combined. On the one hand, effective triplets
are rare, if the general random mini-batch sampling is used,
making that the triplet loss contributes little in the learning
procedure. This is because the number of identities is large
but the number of images for each identity is small. On
the other hand, to avoid the problem, we propose an ID-
balanced sampling strategy to make sure triplets do exist
in the mini-batches. However, this strategy suppresses the
identiﬁcation loss since fewer identities can be used in each
mini-batch. Due to the sampling bias, it is possible that
some images cannot be used all the time. Therefore, directly
arithmetic weighting the losses would be very simple but
obviously result in many difﬁculties in optimization.

Sampling: To solve the problem, alternatively, we
choose to dynamically minimize the two losses incorporat-
ing two sampling methods accordingly: random sampling
and ID-balanced hard triplet sampling. Random sampling
is easy to be implemented while ID-balanced hard triplet
sampling is implemented according to the following steps.
To build the effective triplets, we randomly select 8 num-
ber of identities for each mini-batch, in which 8 images
of each identity are randomly chosen. Hence, this strategy
deﬁnitely enables to use the hard positive/negative mining
based on the largest intra-class (identity) distance and the
smallest inter-class distance. However, the samples for dif-
ferent identities are unbalanced and those whose number of
images is less than 8 will never be used.

Dynamic weighting: For each loss, we deﬁne a perfor-
mance measure to estimate the likelihood of a loss reduc-
tion. Suppose Lt
τ be the average loss in the current training

iteration τ for the task t ∈ {id, tp}. Thus, we can calculate
kt
τ to be an exponential moving average according to:

kt
τ = αLt

τ + (1 − α)kt

τ −1,

(4)

where α ∈ [0, 1] is a discount factor and kt
on the quantity kt
likelihood of a loss reduction as:

0. Based
τ , we deﬁned a probability to describe the

−1 = Lt

pt
τ =

τ , kt
min{kt
kt
τ −1

τ −1}

.

(5)

τ to be 1. Obviously, pt

In case of loss increasing occasionally, the function min is
used to normalize pt
τ = 1 means
the current optimization step didn’t reduce the loss yet. The
larger the value, the greater the probability that the opti-
mization of the task t steps into a local minimum. Similar
to the Focal Loss which down-weights easier samples and
concentrates on hard samples, we deﬁne a measure (F L(·))
to weight the losses:

F L(pt

τ , γ) = −(1 − pt

τ )γ log(pt

τ ),

(6)

where γ is used to control the focusing intensity. F L(pt
τ , γ)
is designed to weight tasks and choose the desire loss to be
optimized. Thus, the overall objective can be rewritten as:

L = X

F L(pt

τ , γ)Lt
τ .

t∈{id,tp}

(7)

τ , γ)/F L(pid

Due to the different sampling strategies, we opti-
2 with randomly selected
mize the ID loss in Eq.
mini-batches, when F L(pid
τ , γ) dominates the two tasks
(F L(ptp
τ , γ) < δ). Thus, we start our dynamic
optimization system from simply minimizing the ID loss.
Actually, F L(pid
τ , γ) always dominates in the early opti-
mization since each step can greatly reduce the ID loss.
Moreover, because the model is currently in an imma-
ture status, all samples are equally difﬁcult so that hard
sampling-based triplet loss cannot play essential role for our
optimization. This is similar to the scheme of self-paced
(curriculum learning) leaning [10] in which easier samples
are ﬁrst trained and hard samples are considered later while
here dynamically optimizing the two tasks plays the same
role. In this case, the both losses Lt
τ : t ∈ {id, tp} in the
objective Eq. 7 will be calculated.

When F L(ptp

τ , γ) dominates in the optimization, the
overall objective 7 considering both Eq. 2 and 3 will be
directly optimized because ID-balanced sampling will not
inﬂuence the use of ID loss. This optimization success-
fully avoids the tortuous parameter tuning and seamlessly
incorporates the ideas of both ID-balanced hard triplet sam-
pling and curriculum learning to further improve the perfor-
mance. The ﬂowchart of dynamic training is illustrated in
Fig. 4 and details of training are given in Algorithm 1.

8518

SharedLayersTask 1: ID LossTask 2: Triplet Loss  EpochTask 1LayersTask 2LayersAlgorithm 1 Multi-Loss Dynamic Training

Input: Dataset X, pretrained backbone network BN and hyper-
parameters (n, α, δ, γ, D).
Output: The embedding function x = f (I).
Initialization:
Initiate the network parameters except for the backbone.
τ = 0 and ptp
Set pid
for τ = 1, · · · , Nτ
Calculate F L(ptp
if F L(ptp

τ , γ) and F L(pid

τ , γ)/F L(pid

τ = 1.

τ , γ).

τ , γ) < δ

Perform random mini-batch sampling.
Forward though BN and construct the pyramid P.
Apply batch-normalization and calculate x = fτ (I).
Optimize the objective in Eq. 2.

else

Perform ID-balanced hard triplet sampling.
Forward though BN and construct the pyramid P.
Apply batch-normalization and calculate x = fτ (I).
Optimize the objective in Eq. 7.

end if
Backpropagate the gradients and update the parameters.

end for

4. Experiment

To verify the proposed method, we test it on three pop-
ular used person re-identiﬁcation datasets: Market-1501
[34], DukeMTMC-reID [17] and CUHK03 [12].

4.1. Experimental Setting

Implementation details: All images are resized into a
resolution of 384 × 128 which is the same as that of PCB.
The ResNet model with the pretrained parameters on Ima-
geNet is considered as the backbone network in our system.
For the feature map, the number of encoded channels is
2048 while the feature will be reduced to a 128-dimensional
vector using a convolutoinal layer. We set the number of
basic parts to 6 so there are 21 branches in the pyramid
according to construction rules. The margin in the triplet
loss is 1.4 in all our experiments. We select a mini-batch
of 64 images for each iteration. Stochastic gradient descent
(SGD) with two sampling strategies is used in our optimiza-
tion, where the momentum and the weight decay factor is
set to 0.9 and 0.0005, respectively. Totally, the proposed
model will be trained 120 epochs. As for the learning rate,
the initial learning rate is set to 0.01 while the learning rate
will be dropped by half every 10 epochs from epoch 60 to
epoch 90. While, for the dynamic training, we set the pa-
rameters δ = 0.16, α = 0.25 and γ = 2, according to the
suggestions in [15]. All the experiments in this paper will
follow the same setting.

Evaluation metrics: To compare the re-identiﬁcation
performance of the proposed method with the existing ad-
vanced methods, we adopt the Cumulative Matching Char-
acteristics (CMC) at rank-1, rank-5 and rank-10, and mean
Average Precision (mAP) on all the datasets. It is worth not-

ing that all our results are obtained in a single-query setting
and, more importantly, re-ranking algorithm is not used to
improve the mAP in all experiments.

4.2. Datasets

Market-1501: In this dataset, 32, 668 images of 1, 501
identities with annotated bounding boxes detected using
the pedestrian detector of Deformable Part Model (DPM)
are collected. View overlapping exists among different
cameras, including 5 high-resolution cameras, and a low-
resolution camera. Following the setting of PCB, we divide
the dataset into a training set with 12, 936 images of 751
persons and a testing set of 750 persons containing 3, 368
query images and 19, 732 gallery images.

DukeMTMC-reID: Following the protocol [36] of
the Market-1501 dataset, this dataset is a subset of the
DukeMTMC dataset speciﬁcally collected for person re-
In this dataset, 1, 404 identities appears in
identiﬁcation.
more than two cameras while 408 (distractor) identities ap-
pears in only one camera. We divide the dataset into a train-
ing set of 16, 522 images with 702 identities and a testing
set which consists of 2, 228 query images of the other 702
identities and 17, 661 gallery images of 702 identities plus
408 distractor identities.

CUHK03: We follow the new protocol [38] similar to
that of Market-1501, which splits the CUHK03 dataset into
training set of 767 identities and testing set of 700 identi-
ties. From each camera, one image is selected as the query
for each identity and the rest of images are used to con-
struct the gallery set. This dataset has two ways of annotat-
ing bounding box including labelled by human or detected
by a detector. The labelled dataset includes 7, 368 train-
ing, 1, 400 query and 5, 328 gallery images while detected
dataset consists of 7, 365 training, 1, 400 query and 5, 332
gallery images.

4.3. Comparison with State of the Art Methods

In this section, we compare the proposed method called
“Pyramid-ours” with 26 state-of-the-art methods, most of
which is proposed in the last year, on the three datasets
including Market-1501, DukeMTMC-reID and CUHK03.
For the comparison of each dataset, we detail the following.
Market-1501: For this dataset, we divide the compared
methods into two groups: including part-based and global
methods, and the comparisons are given in Tab. 1. The
results clearly show that local-based methods generally get
better evaluation scores than that of these methods extract-
ing global features only. The PCB is a convolutional base-
line that motivates our approach, but we have improved per-
formance by 10.8% and 3.4% on metrics mAP and rank 1,
respectively. MGN considers multiple branches as well but
ignores the gradual cues between global and local informa-
tion. Our method achieves the same result with MGN on

8519

Method

mAP

rank 1

rank 5

rank 10

Pyramid-ours
MGN [26]
PCB+RPP [24]
PCB [24]
GLAD* [27]
MultiScale [4]
PartLoss [29]
PDC* [22]
MultiLoss [13]
PAR [31]
HydraPlus [16]
MultiRegion [25]
DML [30]
Triplet Loss [7]
Transfer [6]
PAN [37]
SVDNet [23]
SOMAnet [1]

88.2
86.9
81.6
77.4
73.9
73.1
69.3
63.4
64.4
63.4

-

41.2
68.8
69.1
65.5
63.4
62.1
47.9

95.7
95.7
93.8
92.3
89.9
88.9
88.2
84.4
83.9
81.0
76.9
66.4
87.7
84.9
83.7
82.8
82.3
73.9

98.4

-

97.5
97.2

-
-
-

92.7

-

92.0
91.3
85.0

-

94.2

-
-

92.3

-

99.0

-

98.5
98.2

-
-
-

94.9

-

94.7
94.5
90.2

-
-
-
-

95.2

-

Table 1. Comparison results (%) on Market-1501 dataset at 4 eval-
uation metrics: mAP, rank 1, rank 5 and rank 10 where the bold
font denotes the best method. “*” denotes that the method needs
auxiliary part labels. We divide other compared methods into
two groups:
the methods exploring part-based features and the
methods extracting global features. Our proposed pyramid model
achieves the best results on all the 4 evaluation metrics.

Method

mAP

rank 1

Pyramid-ours
MGN [26]
SVDNet [23]
AOS [8]
HA-CNN [14]
GSRW [20]
DuATM [21]
PCB+RPP [24]
PSE+ECN [19]
DNN-CRF [3]
GP-reid [28]

79.0
78.4
56.8
62.1
63.8
66.4
64.6
69.2
75.7
69.5
72.8

89.0
88.7
76.7
79.2
80.5
80.7
81.8
83.3
84.5
84.9
85.2

Table 2. Comparison results (%) on DukeMTMC-reID dataset.
The results of our proposed pyramid model at rank 5 and rank
10 are 94.7% and 96.3%, respectively, which achieve the state-of-
the-art.

Method

Pyramid-ours
MGN [26]
PCB+RPP [24]
MLFN [2]
HA-CNN [14]
SVDNet [23]
PAN [37]
IDE [35]

Labelled

Detected

mAP

rank 1

mAP

rank 1

76.9
67.4

-

49.2
41.0
37.8
35.0
21.0

78.9
68.0

-

54.7
44.4
40.9
36.9
22.2

74.8
66.0
57.5
47.8
38.6
37.3
34
19.7

78.9
68.0
63.7
52.8
41.7
41.5
36.3
21.3

Table 3. Comparison results (%) on CUHK03 dataset using the
new protocol in [38]. For the labelled set, the results of our model
at rank 5 and rank 10 are 91.0% and 94.4%, respectively, while
they are 90.7% and 94.5% for the detected dataset. This dataset is
the most difﬁcult one by comparing the average performance of all
methods. The proposed pyramid model outperforms all the other
state-of-the-art methods with large margins.

metric rank 1 but exceeds it 1.3% on metric mAP. In com-
parison, the performances of other algorithms are similar
with each other on metric rank 10 but all of them are much
worse on metrics mAP and rank 1 than ours.

DukeMTMC-reID: From Tab. 2, we can see that our
method also achieves the best results on this dataset at both
metrics mAP and rank 1. Among the compared methods,
MGN is the closest method to our method score, but still be-
low 0.6% mAP score. PSE+ECN which is a method using
a pose-sensitive embedding and the re-ranking procedure
also performs worse than ours (75.7% vs. 79.0%). Simi-
lar to the comparison on Market-1501 dataset, our pyramid
model exceeds PCB+RPP 9.8% and 5.7% at metrics mAP
and rank 1, respectively. We provide the achievements of
our method at metrics rank 5 (94.7% ) and rank 10 (96.3%
) for comparison in the future.

CUHK03: This dataset is the most challenging dataset
under the new protocol and the bounding boxes are anno-
tated using two ways. While, from Tab. 3, we can see that
our proposed approach has achieved the most outstanding
results for these two annotation ways. On this datasst, the
pyramid model outperforms all other methods at least 8.8%
and 10.9%, respectively.

Furthermore, on Market-1501 dataset, we compare our
model with PCB using the same sampling strategy and some
retrieved examples are shown in Fig. 5. We can see that
the PCB cannot respond well to the challenge of inaccurate
bounding boxes. Taking the ﬁrst query as an example, our
model is able to ﬁnd three images of the same identity in the
top 11 results whilst PCB could not search anyone. While,
from the second query, we can see that the lower-body parts
(blue eclipse) of retrieved images match to the upper-body
part of query, due to the imprecise detection.

In summary, our proposed pyramid using the novel
multi-loss dynamic training can always be superior to all
other existing advanced methods, no matter which evalua-
tion metric is used. Through the comparative experiment on
the three datasets, it is easy to know that CUHK03 dataset
with the new protocol would be the most challenging one
because all methods make worse results on it. However, our
method can consistently outperform all other algorithms by
a large margin. Therefore, we can conclude that our method
particularly specializes in challenging problems.

4.4. Component Analysis

To further investigate every component in the pyramid
model, we conduct comprehensive ablation studies on the
performance of different sub-models. The results at the
metrics: mAP, rank 1, rank 5 and rank 10 are shown in Tab.
4 and each result is obtained with only one setting changed
and the rest being the same as the default.

First, we merely use the part of branches in the pyramid
to test the function. In the term “Pyramid-000001”, the left

8520

Model

mAP

Rank 1

Rank 5

Rank 10

Pyramid-000001
Pyramid-100000
Pyramid-001111
Pyramid-110011
Pyramid-111100
Feature-64
Feature-256
No triplet loss
Pyramid-ours
PCB+RPP [24]

82.1
84.9
86.7
87.2
87.5
86.9
87.8
86.5
88.2
81.6

92.8
93.9
94.8
95.0
94.8
94.5
95.3
93.8
95.7
93.8

97.3
97.6
98.4
98.1
98.3
97.8
98.2
97.5
98.4
97.5

98.2
98.5
98.8
98.8
98.9
98.6
98.9
98.4
99.0
98.5

Table 4. Results (%) of sub-models on Market-1501 dataset. In
the term “Pyramid-000001”, ‘0’ means the corresponding level of
pyramid is not used while ‘1’ means that is used. “Feature-64”
denotes the dimension of features for each branch is set 64. “No
triplet loss” refers to that only identiﬁcation loss is optimized.

PCB-RPP. It demonstrates the new pyramid model and the
dynamic sampling strategy contribute most for the perfor-
mance improvement.

5. Conclusion

In this paper, we construct a coarse-to-ﬁne pyramid
model for person re-identiﬁcation via a novel dynamic train-
ing scheme. Our model relaxes the requirement of detection
models and thus achieves advanced results on benchmark.
Specially, our model outperforms the existing best method
by a large margin on CUHK03 dataset which is the most
challenging dataset under the new protocol of [38].
It is
worth noting that all our results are achieved in a single-
query setting without using any re-ranking algorithms. In
the future, it will be interesting to jointly learn the detection
and re-identiﬁcation models in an integrated framework.
The two tasks are highly related and Re-ID models can be
improved by means of attention maps in the detection mod-
els. Moreover, the middle layer features in the backbone can
be incorporated into the proposed pyramid model as well to
further improve the Re-ID performance.

Acknowledgement

Our work was supported in part by the Science and
Technology Innovation Committee Foundation of Shenzhen
(Grant No. ZDSYS201703031748284), the Program for
University Key Laboratory of Guangdong Province (Grant
No. 2017KSYS008), the National Natural Science Founda-
tion of China (Grant No. 61572388 and 61703327) and the
Key R&D Program-The Key Industry Innovation Chain of
Shaanxi (Grant No. 2017ZDCXL-GY-05-04-02).

References

[1] Igor Barros Barbosa, Marco Cristani, Barbara Caputo, Alek-
sander Rognhaugen, and Theoharis Theoharis. Looking be-

8521

Query

Top 11 retrieved images

Figure 5. Examples of retrieved images by two methods: Pyramid-
ours and PCB, in case of the imprecise detection. For each query,
the images in ﬁrst row are returned by our proposed method while
the images in second row are searched by PCB. The green/red rect-
angles indicate that images have the same/different identities as the
query and the blue eclipse marks the similar contexts.

number denotes whether the branches in low level are used
or not while the rightest number is for the global branch. For
example, “Pyramid-000001” means only the global branch
in the highest level of the pyramid is used. From this table,
we can obtain: 1) The local branches in the lower levels
play more important roles than that of the global branches
(84.9% vs. 82.1%). 2) The more branches we use, the better
the performance. 3) The only global branch plus the pro-
posed dynamic training strategy can achieve better results
than that of PCA+RPP. It clearly shows the dynamic train-
ing strategy is able to improve the capacities of the model.

Second, the features of different dimensions are also an-
alyzed. Compared to the default dimension 128, the fea-
tures of dimension 64 and 256 both achieve worse results.
It shows that the redundant information plays negative inﬂu-
ence to the performance while too short feature cannot pro-
vide sufﬁcient discriminative cues. In summary, the perfor-
mance is relatively (≤ 1.3%) stable with the change of the
feature dimension. While, in the case of resource-limited
application, 64-dimensional feature is a more acceptable
choice.

Finally, we ﬁx the dynamic balance parameter to 0 and
alternately execute the two sampling strategies to train the
identiﬁcation loss. It means that the triplet loss will never be
used in this experiment. In one step, mini-batch is selected
using random sampling while ID-balance hard sampling is
adopted in the next step. We can see that the overall per-
formance is a little bit lower than that of the default setting
of our proposed model but still much higher than that of

yond appearances: Synthetic training data for deep cnns in
re-identiﬁcation. arXiv:1701.03153v1, 2017.

[2] Xiaobin Chang, Timothy M. Hospedales, and Tao Xiang.
Multi-level factorisation net for person re-identiﬁcation. In
CVPR, 2018.

[3] Dapeng Chen, Dan Xu, Hongsheng Li, Nicu Sebe, and Xi-
aogang Wang. Group consistent similarity learning via deep
crf for person re-identiﬁcation. In CVPR, 2018.

[4] Yanbei Chen, Xiatian Zhu, and Shaogang Gong. Person re-
identiﬁcation by deep learning multi-scale representations.
In ICCV Workshop, 2017.

[5] Zhao Chen, Vijay Badrinarayanan, Chen-Yu Lee, and An-
drew Rabinovich. Gradnorm: Gradient normalization for
adaptive loss balancing in deep multitask networks. In ICML,
2018.

[6] Mengyue Geng, Yaowei Wang, Tao Xiang, and Yonghong
Tian. Deep transfer learning for person re-identiﬁcation.
arXiv:1611.05244v2, 2016.

[7] Alexander Hermans, Lucas Beyer, and Bastian Leibe.

In
loss for person re-identiﬁcation.

defense of the triplet
arXiv:1703.07737v4, 2017.

[8] Houjing Huang, Dangwei Li, Zhang Zhang, Xiaotang Chen,
and Kaiqi Huang. Adversarially occluded samples for person
re-identiﬁcation. In CVPR, 2018.

[9] Alex Kendall, Yarin Gal, and Roberto Cipolla. Multi-task
learning using uncertainty to weigh losses for scene geome-
try and semantics. In CVPR, 2018.

[10] M. Pawan Kumar, Ben Packer, and Daphne Koller. Self-

paced learning for latent variable models. In NIPS, 2010.

[11] Changsheng Li, Junchi Yan, Fan Wei, Weishan Dong, Qing-
shan Liu, and Hongyuan Zha. Self-paced multi-task learn-
ing. In AAAI, 2017.

[12] Wei Li, Rui Zhao, Tong Xiao, and Xiaogang Wang. Deep-
reid: Deep ﬁlter pairing neural network for person re-
identiﬁcation. In CVPR, 2014.

[13] Wei Li, Xiatian Zhu, and Shaogang Gong.

Person re-
identiﬁcation by deep joint learning of multi-loss classiﬁca-
tion. In IJCAI, 2017.

[14] Wei Li, Xiatian Zhu, and Shaogang Gong. Harmonious at-
tention network for person re-identiﬁcation. In CVPR, 2018.
[15] Tsung-Yi Lin, Priya Goyal, Ross Girshick, Kaiming He, and
Piotr Dollar. Focal loss for dense object detection. In ICCV,
2017.

[16] Xihui Liu, Haiyu Zhao, Maoqing Tian, Lu Shengand Jing
Shao, Shuai Yiand Junjie Yan, and Xiaogang Wang.
Hydraplus-net: Attentive deep features for pedestrian anal-
ysis. In ICCV, 2017.

[17] Ergys Ristani, Francesco Solera, Roger Zou, Rita Cucchiara,
and Carlo Tomasi. Performance measures and a data set
for multi-target, multi-camera tracking. In ECCV Workshop,
2016.

[18] Clemens Rosenbaum, Tim Klinger, and Matthew Riemer.
Routing networks adaptive selection of non-linear functions
for multi-task learning. In ICLR, 2018.

[19] M. Saquib Sarfraz, Arne Schumann, Andreas Eberle, and
Rainer Stiefelhagen. A pose-sensitive embedding for per-
son re-identiﬁcation with expanded cross neighborhood re-
ranking. In CVPR, 2018.

[20] Yantao Shen, Hongsheng Li, Tong Xiao, Shuai Yi, Dapeng
Chen, and Xiaogang Wang. Deep group-shufﬂing random
walk for person re-identiﬁcation. In CVPR, 2018.

[21] Jianlou Si, Honggang Zhang, Chun-Guang Li, Jason Kuen,
Xiangfei Kong, Alex C. Kot, and Gang Wang. Dual attention
matching network for context-aware feature sequence based
person re-identiﬁcation. In CVPR, 2018.

[22] Chi Su, Jianing Li, Shiliang Zhang, Junliang Xing, Wen Gao,
and Qi Tian. Pose-driven deep convolutional model for per-
son re-identiﬁcation. In ICCV, 2017.

[23] Yifan Sun, Liang Zheng, Weijian Deng, and Shengjin Wang.

Svdnet for pedestrian retrieval. In ICCV, 2017.

[24] Yifan Sun, Liang Zheng, Yi Yang, Qi Tian, and Shengjin
Wang. Beyond part models: Person retrieval with reﬁned
part pooling. In ECCV, 2018.

[25] Evgeniya Ustinova, Yaroslav Ganin, and Victor Lempitsky.
Multiregion bilinear convolutional neural networks for per-
son re-identiﬁcation. arXiv:1512.05300v5, 2015.

[26] Guanshuo Wang, Yufeng Yuan, Xiong Chen, Jiwei Li, and Xi
Zhou. Learning discriminative features with multiple gran-
ularities for person re-identiﬁcation. arXiv:1804.01438v3,
2018.

[27] Longhui Wei, Shiliang Zhang, Hantao Yao, Wen Gao, and Qi
Tian. Glad: Global-local-alignment descriptor for pedestrian
retrieval. In ACM MM, 2017.

[28] Fu Xiong, Yang Xiao, Zhiguo Cao, Kaicheng Gong, Zhi-
wen Fang, and Joey Tianyi Zhou. Towards good prac-
tices on building effective cnn baseline model for person re-
identiﬁcation. arXiv:1807.11042v1, 2018.

[29] Hantao Yao, Shiliang Zhang, Yongdong Zhang, Jintao Li,
and Qi Tian. Deep representation learning with part loss for
person re-identiﬁcation. arXiv:1707.00798v2, 2017.

[30] Ying Zhang, Tao Xiang, Timothy M. Hospedales, and

Huchuan Lu. Deep mutual learning. In CVPR, 2018.

[31] Liming Zhao, Xi Li, Jingdong Wang, and Yueting Zhuang.
Deeply-learned part-aligned representations for person re-
identiﬁcation. In ICCV, 2017.

[32] Feng Zheng, Xin Miao, and Heng Huang. Fast vehicle iden-
tiﬁcation via ranked semantic sampling based embedding. In
IJCAI, 2018.

[33] Feng Zheng and Ling Shao. Learning cross-view binary

identities for fast person re-identiﬁcation. In IJCAI, 2016.

[34] Liang Zheng, Liyue Shen, Lu Tian, Shengjin Wang, Jing-
dong Wang, and Qi Tian. Scalable person re-identiﬁcation:
A benchmark. In ICCV, 2015.

[35] Liang Zheng, Yi Yang, and Alexander G. Hauptmann.
Pastand present and future.

Person re-identiﬁcation:
arXiv:1610.02984v1, 2016.

[36] Zhedong Zheng, Liang Zheng, and Yi Yang. Unlabeled sam-
ples generated by gan improve the person re-identiﬁcation
baseline in vitro. In ICCV, 2017.

[37] Zhedong Zheng, Liang Zheng, and Yi Yang. Pedestrian
alignment network for large-scale person re-identiﬁcation.
IEEE TCSVT, 2018.

[38] Zhun Zhong, Liang Zheng, Donglin Cao, and Shaozi Li. Re-
ranking person re-identiﬁcation with k-reciprocal encoding.
In CVPR, 2017.

8522

